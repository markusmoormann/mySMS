/*! stanzaio 2014-10-01*/!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.XMPP=e()}}(function(){var e,f,n;return function o(e,f,n){function d(t,l){if(!f[t]){if(!e[t]){var u="function"==typeof require&&require;if(!l&&u)return u(t,!0);if(i)return i(t,!0);throw new Error("Cannot find module '"+t+"'")}var p=f[t]={exports:{}};e[t][0].call(p.exports,function(f){var n=e[t][1][f];return d(n?n:f)},p,p.exports,o,e,f,n)}return f[t].exports}for(var i="function"==typeof require&&require,t=0;t<n.length;t++)d(n[t]);return d}({1:[function(e,f,n){(function(f){"use strict";n.lang=f.env.LANG,n.Stream=e("./lib/stanza/stream"),n.BOSH=e("./lib/stanza/bosh"),n.Message=e("./lib/stanza/message"),n.Presence=e("./lib/stanza/presence"),n.Iq=e("./lib/stanza/iq"),n.PubsubEvent=e("./lib/stanza/pubsubEvents").EventItem,n.PubsubItem=e("./lib/stanza/pubsub").Item,n.JID=e("xmpp-jid").JID,n.Client=e("./lib/client"),n.crypto=e("crypto"),n.jxt=e("jxt"),n.jingle=e("./lib/stanza/jingle"),n.createClient=function(f){var o=new n.Client(f);return o.use(e("./lib/plugins")),o}}).call(this,e("FWaASH"))},{"./lib/client":2,"./lib/plugins":22,"./lib/stanza/bosh":52,"./lib/stanza/iq":69,"./lib/stanza/jingle":70,"./lib/stanza/message":74,"./lib/stanza/presence":80,"./lib/stanza/pubsub":83,"./lib/stanza/pubsubEvents":85,"./lib/stanza/stream":97,FWaASH:166,crypto:154,jxt:210,"xmpp-jid":236}],2:[function(e,f){"use strict";function n(e){var f=this;d.call(this),e=e||{},this._initConfig(e),this.jid=new b,this.transports={websocket:g,bosh:P,"old-websocket":x},this.negotiatedFeatures={},this.featureOrder=["sasl","streamManagement","bind","clientStateIndication","streamManagement","caps","session"],this.features={},this.sm=new m(this),this.on("stream:data",function(e){var n=e.toJSON();if("iq"===e._name&&(n._xmlChildCount=0,o.each(e.xml.childNodes,function(e){1===e.nodeType&&(n._xmlChildCount+=1)})),f.emit(e._eventname||e._name,n),"message"===e._name||"presence"===e._name||"iq"===e._name)f.sm.handle(n),f.emit("stanza",n);else{if("smAck"===e._name)return f.sm.process(n);if("smRequest"===e._name)return f.sm.ack()}n.id&&f.emit("id:"+n.id,n)}),this.on("streamFeatures",function(e){var n=[];f.featureOrder.forEach(function(o){e[o]&&!f.negotiatedFeatures[o]&&n.push(function(n){!f.negotiatedFeatures[o]&&f.features[o]?f.features[o](e,n):n()})}),l.series(n,function(e,n){if("restart"===e)f.transport.restart();else if("disconnect"===e){var o=new r({condition:"policy-violation",text:"failed to negotiate stream features: "+n});f.emit("stream:error",o),f.disconnect()}})}),this.features.sasl=function(e,n){var d=f.SASLFactory.create(e.sasl.mechanisms);if(!d)return f.releaseGroup("sasl"),f.emit("auth:failed"),n("disconnect","authentication failed");f.on("sasl:success","sasl",function(){f.negotiatedFeatures.sasl=!0,f.releaseGroup("sasl"),f.emit("auth:success",f.config.credentials),n("restart")}),f.on("sasl:challenge","sasl",function(e){d.challenge(e.value),f.send(new y.Response({value:d.response(f.getCredentials())})),d.cache&&(o.each(d.cache,function(e,n){e&&(f.config.credentials[n]=s(e))}),f.emit("credentials:update",f.config.credentials)),n()}),f.on("sasl:failure","sasl",function(){f.releaseGroup("sasl"),f.emit("auth:failed"),n("disconnect","authentication failed")}),f.on("sasl:abort","sasl",function(){f.releaseGroup("sasl"),f.emit("auth:failed"),n("disconnect","authentication failed")});var i={mechanism:d.name};d.clientFirst&&(i.value=d.response(f.getCredentials())),f.send(new y.Auth(i))},this.features.bind=function(e,n){f.sendIq({type:"set",bind:{resource:f.config.resource}},function(o,d){if(o)return f.emit("session:error",o),n("disconnect","JID binding failed");f.negotiatedFeatures.bind=!0,f.emit("session:bound",d.bind.jid),f.jid=new b(d.bind.jid);var i=!e.session||e.session&&e.session.optional;!f.sessionStarted&&i&&(f.sessionStarted=!0,f.emit("session:started",d.bind.jid)),n()})},this.features.session=function(e,n){return e.session.optional||f.sessionStarted?(f.negotiatedFeatures.session=!0,n()):void f.sendIq({type:"set",session:{}},function(e){return e?n("disconnect","session request failed"):(f.negotiatedFeatures.session=!0,f.sessionStarted||(f.sessionStarted=!0,f.emit("session:started",f.jid)),void n())})},this.features.caps=function(e,n){f.emit("disco:caps",{from:new b(f.jid.domain),caps:e.caps}),f.negotiatedFeatures.caps=!0,n()},this.features.streamManagement=function(e,n){return f.config.useStreamManagement?(f.on("stream:management:enabled","sm",function(e){f.sm.enabled(e),f.negotiatedFeatures.streamManagement=!0,f.releaseGroup("sm"),n()}),f.on("stream:management:resumed","sm",function(e){f.sm.resumed(e),f.negotiatedFeatures.streamManagement=!0,f.negotiatedFeatures.bind=!0,f.sessionStarted=!0,f.releaseGroup("sm"),n("break")}),f.on("stream:management:failed","sm",function(){f.sm.failed(),f.emit("session:end"),f.releaseGroup("session"),f.releaseGroup("sm"),n()}),void(f.sm.id?f.sm.id&&f.sm.allowResume?f.sm.resume():n():f.negotiatedFeatures.bind?f.sm.enable():n())):n()},this.on("disconnected",function(){f.transport&&(f.transport.off("*"),delete f.transport),f.sessionStarted=!1,f.negotiatedFeatures.sasl=!1,f.negotiatedFeatures.streamManagement=!1,f.negotiatedFeatures.bind=!1,f.negotiatedFeatures.session=!1,f.releaseGroup("connection")}),this.on("iq",function(e){var n=e.type,o=e._xmlChildCount;delete e._xmlChildCount;var d=Object.keys(e);if("get"===e.type||"set"===e.type){if(1!==o)return f.sendIq(e.errorReply({error:{type:"modify",condition:"bad-request"}}));if(!d.length)return f.sendIq(e.errorReply({error:{type:"cancel",condition:"feature-not-implemented"}}));var i="iq:"+n+":"+d[0];f.callbacks[i]?f.emit(i,e):f.sendIq(e.errorReply({error:{type:"cancel",condition:"feature-not-implemented"}}))}}),this.on("message",function(e){Object.keys(e.$body||{}).length&&("chat"===e.type||"normal"===e.type?f.emit("chat",e):"groupchat"===e.type&&f.emit("groupchat",e)),"error"===e.type&&f.emit("message:error",e)}),this.on("presence",function(e){var n=e.type||"available";"error"===n&&(n="presence:error"),f.emit(n,e)})}var o=e("underscore"),d=e("wildemitter"),i=e("util"),t=e("bluebird"),l=e("async"),u=e("node-uuid"),p=e("atob"),s=e("btoa"),y=e("./stanza/sasl"),c=e("./stanza/message"),a=e("./stanza/presence"),r=e("./stanza/streamError"),w=e("./stanza/iq"),b=e("xmpp-jid").JID,m=e("./sm"),g=e("./transports/websocket"),x=e("./transports/old-websocket"),P=e("./transports/bosh"),j=e("hostmeta"),v=e("saslmechanisms"),M={external:e("sasl-external"),"scram-sha-1":e("sasl-scram-sha-1"),"digest-md5":e("alt-sasl-digest-md5"),plain:e("sasl-plain"),anonymous:e("sasl-anonymous")};e("./stanza/stream"),e("./stanza/sm"),e("./stanza/csi"),e("./stanza/error"),e("./stanza/streamFeatures"),e("./stanza/bind"),e("./stanza/session"),i.inherits(n,d),Object.defineProperty(n.prototype,"stream",{get:function(){return this.transport?this.transport.stream:void 0}}),n.prototype._initConfig=function(e){var f=this,n=this.config||{};this.config=o.extend({useStreamManagement:!0,transports:["websocket","bosh"],sasl:["external","scram-sha-1","digest-md5","plain","anonymous"]},n,e),o.isArray(this.config.sasl)||(this.config.sasl=[this.config.sasl]),this.SASLFactory=new v,this.config.sasl.forEach(function(e){if("string"==typeof e){var n=M[e.toLowerCase()];n&&f.SASLFactory.use(n)}else f.SASLFactory.use(e)}),this.config.jid=new b(this.config.jid),this.config.server||(this.config.server=this.config.jid.domain),this.config.password&&(this.config.credentials=this.config.credentials||{},this.config.credentials.password=this.config.password,delete this.config.password),this.config.transport&&(this.config.transports=[this.config.transport]),o.isArray(this.config.transports)||(this.config.transports=[this.config.transports])},n.prototype.use=function(e){e(this)},n.prototype.nextId=function(){return u.v4()},n.prototype.discoverBindings=function(e,f){j(e,function(e,n){if(e)return f(e,[]);var o={websocket:[],bosh:[]},d=n.links||[];d.forEach(function(e){e.href&&"urn:xmpp:alt-connections:websocket"===e.rel&&o.websocket.push(e.href),e.href&&"urn:xmpp:altconnect:websocket"===e.rel&&o.websocket.push(e.href),e.href&&"urn:xmpp:alt-connections:xbosh"===e.rel&&o.bosh.push(e.href),e.href&&"urn:xmpp:altconnect:bosh"===e.rel&&o.bosh.push(e.href)}),f(!1,o)})},n.prototype.getCredentials=function(){var e=this.config.credentials||{},f=new b(this.config.jid),n=e.username||f.local,d=e.server||f.domain,i={username:n,password:this.config.password,server:d,host:d,realm:d,serviceType:"xmpp",serviceName:d},t=o.extend(i,e),l=["saltedPassword","clientKey","serverKey"];return l.forEach(function(e){t[e]&&(t[e]=p(t[e]))}),t},n.prototype.connect=function(e,f){var n=this;if(this._initConfig(e),f&&f.name&&f.url){var o=n.transport=new n.transports[f.name](n.sm);return o.on("*",function(e,f){n.emit(e,f)}),o.connect(n.config)}return!f&&1===n.config.transports.length&&(f={},f.name=n.config.transports[0],("websocket"===f.name||"old-websocket"===f.name)&&(f.url=n.config.wsURL),"bosh"===f.name&&(f.url=n.config.boshURL),f.name&&f.url)?n.connect(null,f):n.discoverBindings(n.config.server,function(e,f){if(e)return n.disconnect();for(var o=0,d=n.config.transports.length;d>o;o++){var i=n.config.transports[o];console.log("Checking for %s endpoints",i);for(var t=0,l=(f[i]||[]).length;l>t;t++){var u=f[i][t];if(0===u.indexOf("wss://")||0===u.indexOf("https://"))return"websocket"===i?n.config.wsURL=u:n.config.boshURL=u,console.log("Using %s endpoint: %s",i,u),n.connect(null,{name:i,url:u});console.warn("Discovered unencrypted %s endpoint (%s). Ignoring",i,u)}}return console.warn("No endpoints found for the requested transports."),n.disconnect()})},n.prototype.disconnect=function(){this.sessionStarted&&(this.releaseGroup("session"),this.sm.started||this.emit("session:end")),this.sessionStarted=!1,this.releaseGroup("connection"),this.transport?this.transport.disconnect():this.emit("disconnected")},n.prototype.send=function(e){this.transport&&this.transport.send(e),this.sm.track(e)},n.prototype.sendMessage=function(e){e=e||{},e.id||(e.id=this.nextId());var f=new c(e);return this.emit("message:sent",f.toJSON()),this.send(f),e.id},n.prototype.sendPresence=function(e){return e=e||{},e.id||(e.id=this.nextId()),this.send(new a(e)),e.id},n.prototype.sendIq=function(e,f){var n,o,d,i,l=this;e=e||{},e.id||(e.id=this.nextId());var u=e.toJSON?e:new w(e);return"error"===e.type||"result"===e.type?void this.send(u):(i=new b(e.to),d={},d[""]=!0,d[i.full]=!0,d[i.bare]=!0,d[i.domain]=!0,d[l.jid.bare]=!0,d[l.jid.domain]=!0,o="id:"+e.id,n=new t(function(e,f){var n=function(i){d[i.from.full]&&(l.off(o,n),i.error?f(i):e(i))};l.on(o,"session",n)}),this.send(u),n.timeout(1e3*l.config.timeout||15e3).catch(t.TimeoutError,function(){throw{id:e.id,type:"error",error:{condition:"timeout"}}}).nodeify(f))},n.prototype.sendStreamError=function(e){e=e||{};var f=new r(e);this.emit("stream:error",f),this.send(f),this.disconnect()},n.prototype.JID=function(e){return new b(e)},f.exports=n},{"./sm":46,"./stanza/bind":48,"./stanza/csi":56,"./stanza/error":60,"./stanza/iq":69,"./stanza/message":74,"./stanza/presence":80,"./stanza/sasl":93,"./stanza/session":94,"./stanza/sm":96,"./stanza/stream":97,"./stanza/streamError":98,"./stanza/streamFeatures":99,"./transports/bosh":104,"./transports/old-websocket":105,"./transports/websocket":106,"alt-sasl-digest-md5":107,async:108,atob:109,bluebird:112,btoa:170,hostmeta:171,"node-uuid":221,"sasl-anonymous":223,"sasl-external":225,"sasl-plain":227,"sasl-scram-sha-1":228,saslmechanisms:233,underscore:234,util:169,wildemitter:235,"xmpp-jid":236}],3:[function(e,f){"use strict";f.exports=function(e){e.disco.addFeature("urn:xmpp:attention:0"),e.getAttention=function(f,n){n=n||{},n.to=f,n.type="headline",n.attention=!0,e.sendMessage(n)},e.on("message",function(f){f.attention&&e.emit("attention",f)})}},{}],4:[function(e,f){"use strict";e("../stanza/avatar"),f.exports=function(e){e.disco.addFeature("urn:xmpp:avatar:metadata+notify"),e.on("pubsub:event",function(f){f.event.updated&&"urn:xmpp:avatar:metadata"===f.event.updated.node&&e.emit("avatar",{jid:f.from,source:"pubsub",avatars:f.event.updated.published[0].avatars})}),e.on("presence",function(f){f.avatarId&&e.emit("avatar",{jid:f.from,source:"vcard",avatars:[{id:f.avatarId}]})}),e.publishAvatar=function(e,f,n){return this.publish("","urn:xmpp:avatar:data",{id:e,avatarData:f},n)},e.useAvatars=function(e,f){return this.publish("","urn:xmpp:avatar:metadata",{id:"current",avatars:e},f)},e.getAvatar=function(e,f,n){return this.getItem(e,"urn:xmpp:avatar:data",f,n)}}},{"../stanza/avatar":47}],5:[function(e,f){"use strict";e("../stanza/blocking"),f.exports=function(e){e.disco.addFeature("urn:xmpp:blocking"),e.block=function(f,n){return e.sendIq({type:"set",block:{jids:[f]}},n)},e.unblock=function(f,n){return e.sendIq({type:"set",unblock:{jids:[f]}},n)},e.getBlocked=function(f){return e.sendIq({type:"get",blockList:!0},f)},e.on("iq:set:block",function(f){e.emit("block",{jids:f.block.jids||[]}),e.sendIq(f.resultReply())}),e.on("iq:set:unblock",function(f){e.emit("unblock",{jids:f.unblock.jids||[]}),e.sendIq(f.resultReply())})}},{"../stanza/blocking":49}],6:[function(e,f){"use strict";e("../stanza/bob"),f.exports=function(e){e.disco.addFeature("urn:xmpp:bob"),e.getBits=function(f,n,o){return e.sendIq({to:f,type:"get",bob:{cid:n}},o)}}},{"../stanza/bob":50}],7:[function(e,f){"use strict";e("../stanza/bookmarks");var n=e("underscore"),o=e("xmpp-jid").JID;f.exports=function(e){e.getBookmarks=function(e){return this.getPrivateData({bookmarks:!0},e)},e.setBookmarks=function(e,f){return this.setPrivateData({bookmarks:e},f)},e.addBookmark=function(f,d){return f.jid=new o(f.jid),this.getBookmarks().then(function(o){var d=o.privateStorage.bookmarks.conferences||[],i=n.filter(d,function(e){return e.jid.bare===f.jid.bare});return i.length?n.extend(i[0],f):d.push(f),e.setBookmarks({conferences:d})}).nodeify(d)},e.removeBookmark=function(f,d){return f=new o(f),this.getBookmarks().then(function(o){var d=o.privateStorage.bookmarks.conferences||[];return d=n.filter(d,function(e){return f.bare!==e.jid.bare}),e.setBookmarks({conferences:d})}).nodeify(d)}}},{"../stanza/bookmarks":51,underscore:234,"xmpp-jid":236}],8:[function(e,f){"use strict";e("../stanza/carbons"),f.exports=function(e){e.disco.addFeature("urn:xmpp:carbons:2"),e.enableCarbons=function(e){return this.sendIq({type:"set",enableCarbons:!0},e)},e.disableCarbons=function(e){return this.sendIq({type:"set",disableCarbons:!0},e)},e.on("message",function(f){return f.carbonSent?e.emit("carbon:sent",f):f.carbonReceived?e.emit("carbon:received",f):void 0}),e.on("carbon:*",function(f,n){var o=f.split(":")[1];if(n.from.bare===e.jid.bare){var d,i;"received"===o?(d=n.carbonReceived.forwarded.message,i=n.carbonReceived.forwarded.delay):(d=n.carbonSent.forwarded.message,i=n.carbonSent.forwarded.delay),d.delay||(i?d.delay.stamp=i.stamp:d.delay={stamp:new Date(Date.now())}),d.carbon=!0,d.from.bare===e.jid.bare?e.emit("message:sent",d):e.emit("message",d)}})}},{"../stanza/carbons":54}],9:[function(e,f){"use strict";f.exports=function(e){e.disco.addFeature("http://jabber.org/protocol/chatstates"),e.on("message",function(f){f.chatState&&(e.emit("chat:state",{to:f.to,from:f.from,chatState:f.chatState}),e.emit("chatState",{to:f.to,from:f.from,chatState:f.chatState}))})}},{}],10:[function(e,f){"use strict";e("../stanza/command");var n="http://jabber.org/protocol/commands";f.exports=function(e){e.disco.addFeature(n),e.disco.addItem({name:"Ad-Hoc Commands",node:n}),e.getCommands=function(f,o){return e.getDiscoItems(f,n,o)}}},{"../stanza/command":55}],11:[function(e,f){"use strict";f.exports=function(e){e.disco.addFeature("urn:xmpp:message-correct:0"),e.on("message",function(f){f.replace&&(e.emit("replace",f),e.emit("replace:"+f.id,f))})}},{}],12:[function(e,f){"use strict";var n=e("../stanza/csi");f.exports=function(e){e.features.clientStateIndication=function(f,n){e.negotiatedFeatures.clientStateIndication=!0,n()},e.markActive=function(){this.negotiatedFeatures.clientStateIndication&&this.send(new n.Active)},e.markInactive=function(){this.negotiatedFeatures.clientStateIndication&&this.send(new n.Inactive)}}},{"../stanza/csi":56}],13:[function(e,f){"use strict";e("../stanza/dataforms"),f.exports=function(e){e.disco.addFeature("jabber:x:data"),e.disco.addFeature("urn:xmpp:media-element"),e.disco.addFeature("http://jabber.org/protocol/xdata-validate"),e.disco.addFeature("http://jabber.org/protocol/xdata-layout"),e.on("message",function(f){f.form&&e.emit("dataform",f)})}},{"../stanza/dataforms":57}],14:[function(e,f){"use strict";e("../stanza/delayed"),f.exports=function(e){e.disco.addFeature("urn:xmpp:delay")}},{"../stanza/delayed":58}],15:[function(e,f){(function(n){"use strict";function o(e,f){var o="",d=e.features.sort(),i=[],u={},p=[];t.forEach(e.identities,function(e){i.push([e.category||"",e.type||"",e.lang||"",e.name||""].join("/"))});var s=i.length,y=d.length;if(i=t.unique(i,!0),d=t.unique(d,!0),y!==d.length||s!==i.length)return!1;o+=i.join("<")+"<",o+=d.join("<")+"<";var c=!1;if(t.forEach(e.extensions,function(e){for(var f=e.fields,n=0,o=f.length;o>n;n++)if("FORM_TYPE"===f[n].name&&"hidden"===f[n].type){var d=f[n].value;return u[d]?void(c=!0):(u[d]=e,void p.push(d))}}),c)return!1;p.sort(),t.forEach(p,function(e){var f=u[e],n={},d=[];o+="<"+e,t.forEach(f.fields,function(e){var f=e.name;if("FORM_TYPE"!==f){var o=e.value||"";"object"!=typeof o&&(o=o.split("\n")),n[f]=o.sort(),d.push(f)}}),d.sort(),t.forEach(d,function(e){o+="<"+e,t.forEach(n[e],function(e){o+="<"+e})})});var a=l.createHash(f).update(new n(o,"utf8")).digest("base64"),r=4-a.length%4;4===r&&(r=0);for(var w=0;r>w;w++)a+="=";return a}function d(e,f,n){var d=o(e,f);return d&&d===n}function i(){this.features={},this.identities={},this.extensions={},this.items={},this.caps={}}var t=e("underscore"),l=e("iana-hashes");e("../stanza/disco"),e("../stanza/caps"),i.prototype={constructor:{value:i},addFeature:function(e,f){f=f||"",this.features[f]||(this.features[f]=[]),this.features[f].push(e)},addIdentity:function(e,f){f=f||"",this.identities[f]||(this.identities[f]=[]),this.identities[f].push(e)},addItem:function(e,f){f=f||"",this.items[f]||(this.items[f]=[]),this.items[f].push(e)},addExtension:function(e,f){f=f||"",this.extensions[f]||(this.extensions[f]=[]),this.extensions[f].push(e)}},f.exports=function(e){e.disco=new i(e),e.disco.addFeature("http://jabber.org/protocol/disco#info"),e.disco.addIdentity({category:"client",type:"web"}),e.getDiscoInfo=function(e,f,n){return this.sendIq({to:e,type:"get",discoInfo:{node:f}},n)},e.getDiscoItems=function(e,f,n){return this.sendIq({to:e,type:"get",discoItems:{node:f}},n)},e.updateCaps=function(){var f=this.config.capsNode||"https://stanza.io",n=JSON.parse(JSON.stringify({identities:this.disco.identities[""],features:this.disco.features[""],extensions:this.disco.extensions[""]})),d=o(n,"sha-1");return this.disco.caps={node:f,hash:"sha-1",ver:d},f=f+"#"+d,this.disco.features[f]=n.features,this.disco.identities[f]=n.identities,this.disco.extensions[f]=n.extensions,e.getCurrentCaps()},e.getCurrentCaps=function(){var f=e.disco.caps;if(!f.ver)return{ver:null,discoInfo:null};var n=f.node+"#"+f.ver;return{ver:f.ver,discoInfo:{identities:e.disco.identities[n],features:e.disco.features[n],extensions:e.disco.extensions[n]}}},e.on("presence",function(f){f.caps&&e.emit("disco:caps",f)}),e.on("iq:get:discoInfo",function(f){var n=f.discoInfo.node||"",o=f.discoInfo.node||"";n===e.disco.caps.node+"#"+e.disco.caps.ver&&(o=n,n=""),e.sendIq(f.resultReply({discoInfo:{node:o,identities:e.disco.identities[n]||[],features:e.disco.features[n]||[],extensions:e.disco.extensions[n]||[]}}))}),e.on("iq:get:discoItems",function(f){var n=f.discoItems.node;e.sendIq(f.resultReply({discoItems:{node:n,items:e.disco.items[n]||[]}}))}),e.verifyVerString=d,e.generateVerString=o,e.updateCaps()}}).call(this,e("buffer").Buffer)},{"../stanza/caps":53,"../stanza/disco":59,buffer:147,"iana-hashes":174,underscore:234}],16:[function(e,f){"use strict";f.exports=function(e){e.disco.addFeature("jid\\20escaping")}},{}],17:[function(e,f){"use strict";e("../stanza/extdisco"),f.exports=function(e){e.disco.addFeature("urn:xmpp:extdisco:1"),e.getServices=function(e,f,n){return this.sendIq({type:"get",to:e,services:{type:f}},n)},e.getServiceCredentials=function(e,f,n){return this.sendIq({type:"get",to:e,credentials:{service:{host:f}}},n)}}},{"../stanza/extdisco":61}],18:[function(e,f){"use strict";e("../stanza/forwarded"),f.exports=function(e){e.disco.addFeature("urn:xmpp:forward:0")}},{"../stanza/forwarded":63}],19:[function(e,f){"use strict";e("../stanza/geoloc"),f.exports=function(e){e.disco.addFeature("http://jabber.org/protocol/geoloc"),e.disco.addFeature("http://jabber.org/protocol/geoloc+notify"),e.on("pubsub:event",function(f){f.event.updated&&"http://jabber.org/protocol/geoloc"===f.event.updated.node&&e.emit("geoloc",{jid:f.from,geoloc:f.event.updated.published[0].geoloc})}),e.publishGeoLoc=function(e,f){return this.publish("","http://jabber.org/protocol/geoloc",{geoloc:e},f)}}},{"../stanza/geoloc":65}],20:[function(e,f){"use strict";var n=e("iana-hashes");f.exports=function(e){e.disco.addFeature("urn:xmpp:hashes:1");var f=n.getHashes();f.forEach(function(f){e.disco.addFeature("urn:xmpp:hash-function-text-names:"+f)})}},{"iana-hashes":174}],21:[function(e,f){"use strict";f.exports=function(e){e.disco.addFeature("urn:xmpp:idle:1")}},{}],22:[function(e,f){"use strict";f.exports=function(f){f.use(e("./disco")),f.use(e("./attention")),f.use(e("./avatar")),f.use(e("./blocking")),f.use(e("./bob")),f.use(e("./bookmarks")),f.use(e("./carbons")),f.use(e("./chatstates")),f.use(e("./command")),f.use(e("./correction")),f.use(e("./csi")),f.use(e("./dataforms")),f.use(e("./delayed")),f.use(e("./escaping")),f.use(e("./extdisco")),f.use(e("./forwarding")),f.use(e("./geoloc")),f.use(e("./hashes")),f.use(e("./idle")),f.use(e("./invisible")),f.use(e("./jingle")),f.use(e("./json")),f.use(e("./keepalive")),f.use(e("./logging")),f.use(e("./mam")),f.use(e("./muc")),f.use(e("./mood")),f.use(e("./nick")),f.use(e("./oob")),f.use(e("./ping")),f.use(e("./private")),f.use(e("./psa")),f.use(e("./pubsub")),f.use(e("./reach")),f.use(e("./receipts")),f.use(e("./register")),f.use(e("./roster")),f.use(e("./rtt")),f.use(e("./shim")),f.use(e("./time")),f.use(e("./vcard")),f.use(e("./version"))}},{"./attention":3,"./avatar":4,"./blocking":5,"./bob":6,"./bookmarks":7,"./carbons":8,"./chatstates":9,"./command":10,"./correction":11,"./csi":12,"./dataforms":13,"./delayed":14,"./disco":15,"./escaping":16,"./extdisco":17,"./forwarding":18,"./geoloc":19,"./hashes":20,"./idle":21,"./invisible":23,"./jingle":24,"./json":25,"./keepalive":26,"./logging":27,"./mam":28,"./mood":29,"./muc":30,"./nick":31,"./oob":32,"./ping":33,"./private":34,"./psa":35,"./pubsub":36,"./reach":37,"./receipts":38,"./register":39,"./roster":40,"./rtt":41,"./shim":42,"./time":43,"./vcard":44,"./version":45}],23:[function(e,f){"use strict";e("../stanza/visibility"),f.exports=function(e){e.goInvisible=function(e){return this.sendIq({type:"set",invisible:!0},e)},e.goVisible=function(e){return this.sendIq({type:"set",visible:!0},e)}}},{"../stanza/visibility":103}],24:[function(e,f){"use strict";var n=e("jingle");e("../stanza/jingle"),e("../stanza/rtp"),e("../stanza/iceUdp"),e("../stanza/file"),f.exports=function(e){var f=e.jingle=new n;f.capabilities.forEach(function(f){e.disco.addFeature(f)});var o=["outgoing","incoming","accepted","terminated","ringing","mute","unmute","hold","resumed"];o.forEach(function(n){f.on(n,function(f,o){e.emit("jingle:"+n,f,o)})}),f.on("peerStreamAdded",function(f,n){e.emit("jingle:remotestream:added",f,n)}),f.on("peerStreamRemoved",function(f,n){e.emit("jingle:remotestream:removed",f,n)}),f.on("send",function(f){e.sendIq(f,function(f){f&&e.emit("jingle:error",f)})}),e.on("iq:set:jingle",function(e){f.process(e)}),e.on("unavailable",function(e){var n=e.from.full;f.endPeerSessions(n,!0)}),e.discoverICEServers=function(f){return this.getServices(e.config.server).then(function(f){for(var n=f.services.services,o=[],d=0;d<n.length;d++){var i=n[d],t={};"stun"===i.type||"stuns"===i.type?(t.url=i.type+":"+i.host,i.port&&(t.url+=":"+i.port),o.push(t),e.jingle.addICEServer(t)):("turn"===i.type||"turns"===i.type)&&(t.url=i.type+":"+i.host,i.port&&(t.url+=":"+i.port),i.transport&&"udp"!==i.transport&&(t.url+="?transport="+i.transport),i.username&&(t.username=i.username),i.password&&(t.credential=i.password),o.push(t),e.jingle.addICEServer(t))}return o}).nodeify(f)}}},{"../stanza/file":62,"../stanza/iceUdp":68,"../stanza/jingle":70,"../stanza/rtp":91,jingle:190}],25:[function(e,f){"use strict";e("../stanza/json"),f.exports=function(e){e.disco.addFeature("urn:xmpp:json:0")}},{"../stanza/json":71}],26:[function(e,f){"use strict";function n(e,f){return new o(function(f,n){e.sm.started?(e.once("stream:management:ack",f),e.sm.request()):e.ping().then(f).catch(function(e){e.error&&"timeout"!==e.error.condition?f():n()})}).timeout(1e3*f||15e3)}var o=e("bluebird");f.exports=function(e){e.enableKeepAlive=function(f){function o(){e.sessionStarted&&n(e,f.timeout).catch(function(){e.sendStreamError({condition:"connection-timeout"})})}f=f||{},f.interval=f.interval||300,f.timeout=f.timeout||15,e._keepAliveInterval=setInterval(o,1e3*f.interval)},e.disableKeepAlive=function(){e._keepAliveInterval&&(clearInterval(e._keepAliveInterval),delete e._keepAliveInterval)},e.on("disconnected",function(){e.disableKeepAlive()})}},{bluebird:112}],27:[function(e,f){"use strict";e("../stanza/logging"),f.exports=function(e){e.disco.addFeature("","urn:xmpp:eventlog"),e.sendLog=function(f,n){e.sendMessage({to:f,type:"normal",log:n})}}},{"../stanza/logging":72}],28:[function(e,f){"use strict";e("../stanza/mam");var n=e("xmpp-jid").JID;f.exports=function(e){e.disco.addFeature("urn:xmpp:mam:tmp"),e.getHistory=function(f,o){var d=this,i=this.nextId();f=f||{},f.queryid=i;var t=f.to||"";delete f.to;var l=new n(t||e.jid.bare),u={};u[""]=!0,u[l.full]=!0,u[l.bare]=!0,u[l.domain]=!0,u[e.jid.bare]=!0,u[e.jid.domain]=!0;var p=[];return this.on("mam:"+i,"session",function(e){u[e.from.full]&&p.push(e)}),this.sendIq({type:"get",to:t,id:i,mamQuery:f}).then(function(e){return e.mamQuery.results=p,e}).finally(function(){d.off("mam:"+i)}).nodeify(o)},e.getHistoryPreferences=function(e){return this.sendIq({type:"get",mamPrefs:!0},e)},e.setHistoryPreferences=function(e,f){return this.sendIq({type:"set",mamPrefs:e},f)},e.on("message",function(f){f.mam&&e.emit("mam:"+f.mam.queryid,f)})}},{"../stanza/mam":73,"xmpp-jid":236}],29:[function(e,f){"use strict";e("../stanza/mood");var n="http://jabber.org/protocol/mood";f.exports=function(e){e.disco.addFeature(n),e.disco.addFeature(n+"+notify"),e.on("pubsub:event",function(f){f.event.updated&&f.event.updated.node===n&&e.emit("mood",{jid:f.from,mood:f.event.updated.published[0].mood})}),e.publishMood=function(e,f,o){return this.publish("",n,{mood:{value:e,text:f}},o)}}},{"../stanza/mood":75}],30:[function(e,f){"use strict";e("../stanza/muc"),e("../stanza/hats");var n=e("underscore"),o=e("xmpp-jid").JID;f.exports=function(e){function f(){n.each(e.joinedRooms,function(f,n){e.joinedRooms[n]=!1,e.joinRoom(n,f)})}e.disco.addFeature("http://jabber.org/protocol/muc"),e.disco.addFeature("jabber:x:conference"),e.disco.addFeature("urn:xmpp:hats:0"),e.joinedRooms={},e.on("session:started",f),e.on("stream:management:resumed",f),e.on("message",function(f){f.muc?(f.muc.invite&&e.emit("muc:invite",{from:f.muc.invite.from,room:f.from,reason:f.muc.invite.reason,password:f.muc.password,thread:f.muc.invite.thread,type:"mediated"}),f.muc.destroyed&&e.emit("muc:destroyed",{room:f.from,newRoom:f.muc.destroyed.jid,reason:f.muc.destroyed.reason,password:f.muc.password}),f.muc.decline&&e.emit("muc:declined",{room:f.from,from:f.muc.decline.from,reason:f.muc.decline.reason})):f.mucInvite&&e.emit("muc:invite",{from:f.from,room:f.mucInvite.jid,reason:f.mucInvite.reason,password:f.mucInvite.password,thread:f.mucInvite.thread,type:"direct"}),"groupchat"===f.type&&f.subject&&e.emit("muc:subject",f)}),e.on("presence",function(f){if(f.joinMuc&&"error"===f.type)e.emit("muc:error",f);else if(f.muc){var n=f.muc.codes&&f.muc.codes.indexOf("110")>=0;"error"===f.type?e.emit("muc:error",f):"unavailable"===f.type?(e.emit("muc:unavailable",f),n&&(e.emit("muc:leave",f),delete e.joinedRooms[f.from.bare])):(e.emit("muc:available",f),n&&!e.joinedRooms[f.from.bare]&&(e.emit("muc:join",f),e.joinedRooms[f.from.bare]=f.from.resource))}}),e.joinRoom=function(e,f,n){n=n||{},n.to=e+"/"+f,n.caps=this.disco.caps,n.joinMuc=n.joinMuc||{},this.sendPresence(n)},e.leaveRoom=function(e,f,n){n=n||{},n.to=e+"/"+f,n.type="unavailable",this.sendPresence(n)},e.ban=function(f,n,o,d){e.setRoomAffiliation(f,n,"outcast",o,d)},e.kick=function(f,n,o,d){e.setRoomRole(f,n,"none",o,d)},e.invite=function(f,n){e.sendMessage({to:f,muc:{invites:n}})},e.directInvite=function(f,n){n.jid=f,e.sendMessage({to:n.to,mucInvite:n})},e.declineInvite=function(f,n,o){e.sendMessage({to:f,muc:{decline:{to:n,reason:o}}})},e.changeNick=function(f,n){e.sendPresence({to:new o(f).bare+"/"+n})},e.setSubject=function(f,n){e.sendMessage({to:f,type:"groupchat",subject:n})},e.discoverReservedNick=function(f,n){e.getDiscoInfo(f,"x-roomuser-item",function(e,f){if(e)return n(e);var o=f.discoInfo.identities[0]||{};n(null,o.name)})},e.requestRoomVoice=function(f){e.sendMessage({to:f,form:{fields:[{name:"FORM_TYPE",value:"http://jabber.org/protocol/muc#request"},{name:"muc#role",type:"text-single",value:"participant"}]}})},e.setRoomAffiliation=function(e,f,n,o,d){return this.sendIq({type:"set",to:e,mucAdmin:{jid:f,affiliation:n,reason:o}},d)},e.setRoomRole=function(e,f,n,o,d){return this.sendIq({type:"set",to:e,mucAdmin:{nick:f,role:n,reason:o}},d)},e.getRoomMembers=function(e,f,n){return this.sendIq({type:"get",to:e,mucAdmin:f},n)},e.getRoomConfig=function(e,f){return this.sendIq({to:e,type:"get",mucOwner:!0},f)},e.configureRoom=function(e,f,n){return f.type||(f.type="submit"),this.sendIq({to:e,type:"set",mucOwner:{form:f}},n)},e.getUniqueRoomName=function(e,f){return this.sendIq({type:"get",to:e,mucUnique:!0},f)}}},{"../stanza/hats":67,"../stanza/muc":76,underscore:234,"xmpp-jid":236}],31:[function(e,f){"use strict";e("../stanza/nick");var n="http://jabber.org/protocol/nick";f.exports=function(e){e.disco.addFeature(n),e.disco.addFeature(n+"+notify"),e.on("pubsub:event",function(f){f.event.updated&&f.event.updated.node===n&&e.emit("nick",{jid:f.from,nick:f.event.updated.published[0].nick})}),e.publishNick=function(e,f){return this.publish("",n,{nick:e},f)}}},{"../stanza/nick":77}],32:[function(e,f){"use strict";e("../stanza/oob"),f.exports=function(e){e.disco.addFeature("jabber:x:oob")}},{"../stanza/oob":78}],33:[function(e,f){"use strict";e("../stanza/ping"),f.exports=function(e){e.disco.addFeature("urn:xmpp:ping"),e.on("iq:get:ping",function(f){e.sendIq(f.resultReply())}),e.ping=function(e,f){return this.sendIq({to:e,type:"get",ping:!0},f)}}},{"../stanza/ping":79}],34:[function(e,f){"use strict";e("../stanza/private"),f.exports=function(e){e.getPrivateData=function(e,f){return this.sendIq({type:"get",privateStorage:e},f)},e.setPrivateData=function(e,f){return this.sendIq({type:"set",privateStorage:e},f)}}},{"../stanza/private":81}],35:[function(e,f){"use strict";e("../stanza/psa"),f.exports=function(e){e.disco.addFeature("urn:xmpp:psa")}},{"../stanza/psa":82}],36:[function(e,f){"use strict";e("../stanza/pubsub"),e("../stanza/pubsubOwner"),e("../stanza/pubsubEvents"),e("../stanza/pubsubError"),f.exports=function(e){e.on("message",function(f){f.event&&(e.emit("pubsub:event",f),e.emit("pubsubEvent",f))}),e.subscribeToNode=function(f,n,o){return this.sendIq({type:"set",to:f,pubsub:{subscribe:{node:n.node,jid:n.jid||e.jid}}},o)
},e.unsubscribeFromNode=function(f,n,o){return this.sendIq({type:"set",to:f,pubsub:{unsubscribe:{node:n.node,jid:n.jid||e.jid.split("/")[0]}}},o)},e.publish=function(e,f,n,o){return this.sendIq({type:"set",to:e,pubsub:{publish:{node:f,item:n}}},o)},e.getItem=function(e,f,n,o){return this.sendIq({type:"get",to:e,pubsub:{retrieve:{node:f,item:n}}},o)},e.getItems=function(e,f,n,o){return n=n||{},n.node=f,this.sendIq({type:"get",to:e,pubsub:{retrieve:{node:f,max:n.max},rsm:n.rsm}},o)},e.retract=function(e,f,n,o,d){return this.sendIq({type:"set",to:e,pubsub:{retract:{node:f,notify:o,id:n}}},d)},e.purgeNode=function(e,f,n){return this.sendIq({type:"set",to:e,pubsubOwner:{purge:f}},n)},e.deleteNode=function(e,f,n){return this.sendIq({type:"set",to:e,pubsubOwner:{del:f}},n)},e.createNode=function(e,f,n,o){var d={type:"set",to:e,pubsubOwner:{create:f}};return n&&(d.pubsubOwner.config={form:n}),this.sendIq(d,o)}}},{"../stanza/pubsub":83,"../stanza/pubsubError":84,"../stanza/pubsubEvents":85,"../stanza/pubsubOwner":86}],37:[function(e,f){"use strict";e("../stanza/reach"),f.exports=function(e){e.disco.addFeature("urn:xmpp:reach:0"),e.disco.addFeature("urn:xmpp:reach:0+notify"),e.on("pubsub:event",function(f){f.event.updated&&"urn:xmpp:reach:0"===f.event.updated.node&&e.emit("reachability",{jid:f.from,addresses:f.event.updated.published[0].reach})}),e.on("presence",function(f){f.reach&&f.reach.length&&e.emit("reachability",{jid:f.from,addresses:f.reach})}),e.publishReachability=function(e,f){return this.publish("","urn:xmpp:reach:0",{reach:e},f)}}},{"../stanza/reach":87}],38:[function(e,f){"use strict";f.exports=function(e){e.disco.addFeature("urn:xmpp:receipts"),e.on("message",function(f){var n={normal:!0,chat:!0,headline:!0};n[f.type]&&f.requestReceipt&&!f.receipt&&e.sendMessage({to:f.from,receipt:f.id,id:f.id}),f.receipt&&(e.emit("receipt",f),e.emit("receipt:"+f.receipt))})}},{}],39:[function(e,f){"use strict";e("../stanza/register"),f.exports=function(e){e.getAccountInfo=function(e,f){return this.sendIq({type:"get",to:e,register:!0},f)},e.updateAccount=function(e,f,n){return this.sendIq({type:"set",to:e,register:f},n)},e.deleteAccount=function(e,f){return this.sendIq({type:"set",to:e,register:{remove:!0}},f)}}},{"../stanza/register":88}],40:[function(e,f){"use strict";e("../stanza/roster"),f.exports=function(e){e.on("iq:set:roster",function(f){var n={};return n[""]=!0,n[e.jid.bare]=!0,n[e.jid.domain]=!0,n[f.from.full]?(e.emit("roster:update",f),void e.sendIq({id:f.id,type:"result"})):e.sendIq(f.errorReply({error:{type:"cancel",condition:"service-unavailable"}}))}),e.getRoster=function(f){var n=this;return f=f||function(){},e.sendIq({type:"get",roster:{ver:n.config.rosterVer}}).then(function(e){if(e.roster){var f=e.roster.ver;f&&(n.config.rosterVer=f,n.emit("roster:ver",f))}return e}).nodeify(f)},e.updateRosterItem=function(f,n){return e.sendIq({type:"set",roster:{items:[f]}},n)},e.removeRosterItem=function(f,n){return e.updateRosterItem({jid:f,subscription:"remove"},n)},e.subscribe=function(f){e.sendPresence({type:"subscribe",to:f})},e.unsubscribe=function(f){e.sendPresence({type:"unsubscribe",to:f})},e.acceptSubscription=function(f){e.sendPresence({type:"subscribed",to:f})},e.denySubscription=function(f){e.sendPresence({type:"unsubscribed",to:f})}}},{"../stanza/roster":89}],41:[function(e,f){"use strict";e("../stanza/rtt"),f.exports=function(e){e.disco.addFeature("urn:xmpp:rtt:0"),e.on("message",function(f){f.rtt&&(e.emit("rtt",f),e.emit("rtt:"+f.rtt.event,f))})}},{"../stanza/rtt":92}],42:[function(e,f){e("../stanza/shim");var n="http://jabber.org/protocol/shim";f.exports=function(e){e.disco.addFeature(n),e.disco.addFeature(n+"#SubID",n)}},{"../stanza/shim":95}],43:[function(e,f){"use strict";e("../stanza/time"),f.exports=function(e){e.disco.addFeature("urn:xmpp:time"),e.getTime=function(e,f){return this.sendIq({to:e,type:"get",time:!0},f)},e.on("iq:get:time",function(f){var n=new Date;e.sendIq(f.resultReply({time:{utc:n,tzo:n.getTimezoneOffset()}}))})}},{"../stanza/time":100}],44:[function(e,f){"use strict";e("../stanza/vcard"),f.exports=function(e){e.disco.addFeature("vcard-temp"),e.getVCard=function(e,f){return this.sendIq({to:e,type:"get",vCardTemp:!0},f)},e.publishVCard=function(e,f){return this.sendIq({type:"set",vCardTemp:e},f)}}},{"../stanza/vcard":101}],45:[function(e,f){"use strict";e("../stanza/version"),f.exports=function(e){e.disco.addFeature("jabber:iq:version"),e.on("iq:get:version",function(f){e.sendIq(f.resultReply({version:e.config.softwareVersion||{name:"stanza.io"}}))}),e.getSoftwareVersion=function(e,f){return this.sendIq({to:e,type:"get",version:!0},f)}}},{"../stanza/version":102}],46:[function(e,f){"use strict";function n(e,f){return(e%f+f)%f}function o(e){this.client=e,this.id=!1,this.allowResume=!0,this.started=!1,this.lastAck=0,this.handled=0,this.windowSize=1,this.unacked=[],this.pendingAck=!1}var d=e("./stanza/sm"),i=Math.pow(2,32);o.prototype={constructor:{value:o},enable:function(){var e=new d.Enable;e.resume=this.allowResume,this.client.send(e),this.handled=0,this.started=!0},resume:function(){var e=new d.Resume({h:this.handled,previd:this.id});this.client.send(e),this.started=!0},enabled:function(e){this.id=e.id},resumed:function(e){this.id=e.previd,e.h&&this.process(e,!0)},failed:function(){this.started=!1,this.id=!1,this.lastAck=0,this.handled=0,this.unacked=[]},ack:function(){this.client.send(new d.Ack({h:this.handled}))},request:function(){this.pendingAck=!0,this.client.send(new d.Request)},process:function(e,f){var o=this,d=n(e.h-this.lastAck,i);this.pendingAck=!1;for(var t=0;d>t&&this.unacked.length>0;t++)this.client.emit("stanza:acked",this.unacked.shift());if(this.lastAck=e.h,f){var l=this.unacked;this.unacked=[],l.forEach(function(e){o.client.send(e)})}this.needAck()&&this.request()},track:function(e){var f=e._name,n={message:!0,presence:!0,iq:!0};this.started&&n[f]&&(this.unacked.push(e),this.needAck()&&this.request())},handle:function(){this.started&&(this.handled=n(this.handled+1,i))},needAck:function(){return!this.pendingAck&&this.unacked.length>=this.windowSize}},f.exports=o},{"./stanza/sm":96}],47:[function(e,f){"use strict";var n=e("underscore"),o=e("jxt"),d=e("./pubsub").Item,i=e("./pubsubEvents").EventItem,t=f.exports=o.define({name:"avatar",namespace:"urn:xmpp:avatar:metadata",element:"info",fields:{id:o.attribute("id"),bytes:o.attribute("bytes"),height:o.attribute("height"),width:o.attribute("width"),type:o.attribute("type","image/png"),url:o.attribute("url")}}),l={get:function(){var e=o.find(this.xml,"urn:xmpp:avatar:metadata","metadata"),f=[];if(e.length){var d=o.find(e[0],"urn:xmpp:avatar:metadata","info");n.forEach(d,function(e){f.push(new t({},e))})}return f},set:function(e){var f=o.findOrCreate(this.xml,"urn:xmpp:avatar:metadata","metadata");o.setAttribute(f,"xmlns","urn:xmpp:avatar:metadata"),n.forEach(e,function(e){var n=new t(e);f.appendChild(n.xml)})}};o.add(d,"avatars",l),o.add(i,"avatars",l),o.add(d,"avatarData",o.subText("urn:xmpp:avatar:data","data")),o.add(i,"avatarData",o.subText("urn:xmpp:avatar:data","data"))},{"./pubsub":83,"./pubsubEvents":85,jxt:210,underscore:234}],48:[function(e,f){var n=e("jxt"),o=e("./iq"),d=e("./streamFeatures"),i=e("jxt-xmpp-types"),t="urn:ietf:params:xml:ns:xmpp-bind",l=f.exports=n.define({name:"bind",namespace:t,element:"bind",fields:{resource:n.subText(t,"resource"),jid:i.jidSub(t,"jid")}});n.extend(o,l),n.extend(d,l)},{"./iq":69,"./streamFeatures":99,jxt:210,"jxt-xmpp-types":209}],49:[function(e,f,n){"use strict";var o=e("jxt"),d=e("./iq"),i=e("xmpp-jid").JID,t="urn:xmpp:blocking",l={get:function(){var e=[],f=o.find(this.xml,t,"item");return f.length?(f.forEach(function(f){e.push(new i(o.getAttribute(f,"jid","")))}),e):e},set:function(e){var f=this;e.forEach(function(e){var n=o.createElement(t,"item",t);o.setAttribute(n,"jid",e.toString()),f.xml.appendChild(n)})}};n.Block=o.define({name:"block",namespace:t,element:"block",fields:{jids:l}}),n.Unblock=o.define({name:"unblock",namespace:t,element:"unblock",fields:{jids:l}}),n.BlockList=o.define({name:"blockList",namespace:t,element:"blocklist",fields:{jids:l}}),o.extend(d,n.Block),o.extend(d,n.Unblock),o.extend(d,n.BlockList)},{"./iq":69,jxt:210,"xmpp-jid":236}],50:[function(e,f){var n=e("jxt"),o=e("./iq"),d=e("./message"),i=e("./presence"),t="urn:xmpp:bob",l=f.exports=n.define({name:"bob",namespace:t,element:"data",fields:{cid:n.attribute("cid"),maxAge:n.numberAttribute("max-age"),type:n.attribute("type"),data:n.text()}});n.extend(o,l),n.extend(d,l),n.extend(i,l)},{"./iq":69,"./message":74,"./presence":80,jxt:210}],51:[function(e,f){var n=e("jxt"),o=e("jxt-xmpp-types"),d=e("./private"),i=n.define({name:"_conference",namespace:"storage:bookmarks",element:"conference",fields:{name:n.attribute("name"),autoJoin:n.boolAttribute("autojoin"),jid:o.jidAttribute("jid"),nick:n.subText("storage:bookmarks","nick")}}),t=f.exports=n.define({name:"bookmarks",namespace:"storage:bookmarks",element:"storage"});n.extend(d,t),n.extend(t,i,"conferences")},{"./private":81,jxt:210,"jxt-xmpp-types":209}],52:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types"),d="http://jabber.org/protocol/httpbind",i="urn:xmpp:xbosh";f.exports=n.define({name:"bosh",namespace:d,element:"body",prefixes:{xmpp:i},fields:{accept:n.attribute("accept"),ack:n.numberAttribute("ack"),authid:n.attribute("authid"),charsets:n.attribute("charsets"),condition:n.attribute("condition"),content:n.attribute("content"),from:o.jidAttribute("from",!0),hold:n.numberAttribute("hold"),inactivity:n.numberAttribute("inactivity"),key:n.attribute("key"),maxpause:n.numberAttribute("maxpause"),newKey:n.attribute("newkey"),pause:n.numberAttribute("pause"),polling:n.numberAttribute("polling"),resport:n.numberAttribute("report"),requests:n.numberAttribute("requests"),rid:n.numberAttribute("rid"),sid:n.attribute("sid"),stream:n.attribute("stream"),time:n.attribute("time"),to:o.jidAttribute("to",!0),type:n.attribute("type"),ver:n.attribute("ver"),wait:n.numberAttribute("wait"),uri:n.subText(d,"uri"),lang:n.langAttribute(),version:n.attribute("xmpp:version","1.0"),restart:n.attribute("xmpp:restart"),restartLogic:n.boolAttribute("xmpp:restartLogic"),payload:{get:function(){for(var e=[],f=0,o=this.xml.childNodes.length;o>f;f++){var d=n.build(this.xml.childNodes[f]);void 0!==d&&e.push(d)}return e},set:function(e){var f=this;e.forEach(function(e){f.xml.appendChild(e.xml)})}}}})},{jxt:210,"jxt-xmpp-types":209}],53:[function(e,f){var n=e("jxt"),o=e("./presence"),d=e("./streamFeatures"),i=f.exports=n.define({name:"caps",namespace:"http://jabber.org/protocol/caps",element:"c",fields:{ver:n.attribute("ver"),node:n.attribute("node"),hash:n.attribute("hash"),ext:n.attribute("ext")}});n.extend(o,i),n.extend(d,i)},{"./presence":80,"./streamFeatures":99,jxt:210}],54:[function(e,f,n){var o=e("jxt"),d=e("./message"),i=e("./iq"),t=e("./forwarded");n.Sent=o.define({name:"carbonSent",eventName:"carbon:sent",namespace:"urn:xmpp:carbons:2",element:"sent"}),n.Received=o.define({name:"carbonReceived",eventName:"carbon:received",namespace:"urn:xmpp:carbons:2",element:"received"}),n.Private=o.define({name:"carbonPrivate",eventName:"carbon:private",namespace:"urn:xmpp:carbons:2",element:"private"}),n.Enable=o.define({name:"enableCarbons",namespace:"urn:xmpp:carbons:2",element:"enable"}),n.Disable=o.define({name:"disableCarbons",namespace:"urn:xmpp:carbons:2",element:"disable"}),o.extend(n.Sent,t),o.extend(n.Received,t),o.extend(d,n.Sent),o.extend(d,n.Received),o.extend(d,n.Private),o.extend(i,n.Enable),o.extend(i,n.Disable)},{"./forwarded":63,"./iq":69,"./message":74,jxt:210}],55:[function(e,f){"use strict";var n=e("jxt"),o=e("./dataforms").DataForm,d=e("./error"),i=e("./iq"),t="http://jabber.org/protocol/commands",l=["next","prev","complete","cancel"],u=["bad-action","bad-locale","bad-payload","bad-sessionid","malformed-action","session-expired"],p=f.exports=n.define({name:"command",namespace:t,element:"command",fields:{action:n.attribute("action"),node:n.attribute("node"),sessionid:n.attribute("sessionid"),status:n.attribute("status"),noteType:n.subAttribute(t,"note","type"),note:n.subText(t,"note"),execute:n.subAttribute(t,"actions","execute"),actions:{get:function(){var e=[],f=n.find(this.xml,t,"actions");return f.length?(l.forEach(function(o){var d=n.find(f[0],t,o);d.length&&e.push(o)}),e):[]},set:function(e){for(var f=n.findOrCreate(this.xml,t,"actions"),o=0,d=f.childNodes.length;d>o;o++)f.removeChild(f.childNodes[o]);e.forEach(function(e){f.appendChild(n.createElement(t,e.toLowerCase(),t))})}}}});n.add(d,"adhocCommandCondition",n.enumSub(t,u)),n.extend(i,p),n.extend(p,o)},{"./dataforms":57,"./error":60,"./iq":69,jxt:210}],56:[function(e,f,n){var o=e("jxt"),d=e("./streamFeatures"),i="urn:xmpp:csi";n.CSIFeature=o.define({name:"clientStateIndication",namespace:i,element:"csi"}),n.Active=o.define({name:"csiActive",eventName:"csi:active",namespace:i,element:"active",topLevel:!0}),n.Inactive=o.define({name:"csiInactive",eventName:"csi:inactive",namespace:i,element:"inactive",topLevel:!0}),o.extend(d,n.CSIFeature)},{"./streamFeatures":99,jxt:210}],57:[function(e,f,n){"use strict";var o=e("jxt"),d=e("./message"),i=e("xmpp-jid").JID,t="jabber:x:data",l="urn:xmpp:media-element",u="http://jabber.org/protocol/xdata-validate",p="http://jabber.org/protocol/xdata-layout",s=["text-single","text-private","list-single","jid-single"];n.Field=o.define({name:"_field",namespace:t,element:"field",init:function(e){this._type=(e||{}).type||this.type},fields:{type:{get:function(){return o.getAttribute(this.xml,"type","text-single")},set:function(e){this._type=e,o.setAttribute(this.xml,"type",e)}},name:o.attribute("var"),desc:o.subText(t,"desc"),required:o.boolSub(t,"required"),label:o.attribute("label"),value:{get:function(){var e=o.getMultiSubText(this.xml,t,"value");return"boolean"===this._type?"1"===e[0]||"true"===e[0]:e.length>1?"text-multi"===this._type?e.join("\n"):"jid-multi"===this._type?e.map(function(e){return new i(e)}):e:s.indexOf(this._type)>=0?"jid-single"===this._type?new i(e[0]):e[0]:e},set:function(e){if("boolean"===this._type){var f=e===!0||"true"===e||"1"===e;o.setSubText(this.xml,t,"value",f?"1":"0")}else"text-multi"===this._type&&"string"==typeof e&&(e=e.split("\n")),o.setMultiSubText(this.xml,t,"value",e)}}}}),n.Option=o.define({name:"_formoption",namespace:t,element:"option",fields:{label:o.attribute("label"),value:o.subText(t,"value")}}),n.Item=o.define({name:"_formitem",namespace:t,element:"item"}),n.Media=o.define({name:"media",element:"media",namespace:l,fields:{height:o.numberAttribute("height"),width:o.numberAttribute("width")}}),n.MediaURI=o.define({name:"_mediaURI",element:"uri",namespace:l,fields:{uri:o.text(),type:o.attribute("type")}}),n.Validation=o.define({name:"validation",element:"validate",namespace:u,fields:{dataType:o.attribute("datatype"),basic:o.boolSub(u,"basic"),open:o.boolSub(u,"open"),regex:o.subText(u,"regex")}}),n.Range=o.define({name:"range",element:"range",namespace:u,fields:{min:o.attribute("min"),max:o.attribute("max")}}),n.ListRange=o.define({name:"select",element:"list-range",namespace:u,fields:{min:o.numberAttribute("min"),max:o.numberAttribute("max")}});var y={get:function(){for(var e=[],f=0,o=this.xml.childNodes.length;o>f;f++){var d=this.xml.childNodes[f];if(d.namespaceURI===p)switch(d.localName){case"text":e.push({text:d.textContent});break;case"fieldref":e.push({field:d.getAttribute("var")});break;case"reportedref":e.push({reported:!0});break;case"section":e.push({section:new n.Section(null,d,this).toJSON()})}}return e},set:function(e){for(var f=0,d=e.length;d>f;f++){var i=e[f];if(i.text){var t=o.createElement(p,"text",p);t.textContent=i.text,this.xml.appendChild(t)}if(i.field){var l=o.createElement(p,"fieldref",p);l.setAttribute("var",i.field),this.xml.appendChild(l)}if(i.reported&&this.xml.appendChild(o.createElement(p,"reportedref",p)),i.section){var u=o.createElement(p,"section",p);this.xml.appendChild(u);var s=new n.Section(null,u);s.label=i.section.label,s.contents=i.section.contents}}}};n.Section=o.define({name:"_section",element:"section",namespace:p,fields:{label:o.attribute("label"),contents:y}}),n.Page=o.define({name:"_page",element:"page",namespace:p,fields:{label:o.attribute("label"),contents:y}}),n.DataForm=o.define({name:"form",namespace:t,element:"x",init:function(){if(this.reportedFields.length){var e={};this.reportedFields.forEach(function(f){e[f.name]=f.type}),this.items.forEach(function(f){f.fields.forEach(function(f){f.type=f._type=e[f.name]})})}},fields:{title:o.subText(t,"title"),instructions:o.multiSubText(t,"instructions"),type:o.attribute("type","form"),reportedFields:o.subMultiExtension(t,"reported",n.Field)}}),o.extend(d,n.DataForm),o.extend(n.DataForm,n.Field,"fields"),o.extend(n.DataForm,n.Item,"items"),o.extend(n.DataForm,n.Page,"layout"),o.extend(n.Field,n.Media),o.extend(n.Field,n.Validation),o.extend(n.Field,n.Option,"options"),o.extend(n.Item,n.Field,"fields"),o.extend(n.Media,n.MediaURI,"uris"),o.extend(n.Validation,n.Range),o.extend(n.Validation,n.ListRange)},{"./message":74,jxt:210,"xmpp-jid":236}],58:[function(e,f){var n=e("jxt"),o=e("./message"),d=e("./presence"),i=e("jxt-xmpp-types"),t=f.exports=n.define({name:"delay",namespace:"urn:xmpp:delay",element:"delay",fields:{from:i.jidAttribute("from"),stamp:n.dateAttribute("stamp"),reason:n.text()}});n.extend(o,t),n.extend(d,t)},{"./message":74,"./presence":80,jxt:210,"jxt-xmpp-types":209}],59:[function(e,f,n){"use strict";var o=e("jxt"),d=e("jxt-xmpp-types"),i=e("./iq"),t=e("./rsm"),l=e("./dataforms").DataForm,u="http://jabber.org/protocol/disco#info",p="http://jabber.org/protocol/disco#items";n.DiscoInfo=o.define({name:"discoInfo",namespace:u,element:"query",fields:{node:o.attribute("node"),features:o.multiSubAttribute(u,"feature","var")}});var s=o.define({name:"_discoIdentity",namespace:u,element:"identity",fields:{category:o.attribute("category"),type:o.attribute("type"),name:o.attribute("name"),lang:o.langAttribute()}});n.DiscoItems=o.define({name:"discoItems",namespace:p,element:"query",fields:{node:o.attribute("node")}});var y=o.define({name:"_discoItem",namespace:p,element:"item",fields:{jid:d.jidAttribute("jid"),node:o.attribute("node"),name:o.attribute("name")}});o.extend(i,n.DiscoInfo),o.extend(i,n.DiscoItems),o.extend(n.DiscoItems,t),o.extend(n.DiscoItems,y,"items"),o.extend(n.DiscoInfo,s,"identities"),o.extend(n.DiscoInfo,l,"extensions")},{"./dataforms":57,"./iq":69,"./rsm":90,jxt:210,"jxt-xmpp-types":209}],60:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types"),d=e("./message"),i=e("./presence"),t=e("./iq"),l="urn:ietf:params:xml:ns:xmpp-stanzas",u=["bad-request","conflict","feature-not-implemented","forbidden","gone","internal-server-error","item-not-found","jid-malformed","not-acceptable","not-allowed","not-authorized","payment-required","recipient-unavailable","redirect","registration-required","remote-server-not-found","remote-server-timeout","resource-constraint","service-unavailable","subscription-required","undefined-condition","unexpected-request"],p=f.exports=n.define({name:"error",namespace:"jabber:client",element:"error",fields:{lang:{get:function(){return(this.parent||{}).lang||""}},condition:n.enumSub(l,u),gone:{get:function(){return n.getSubText(this.xml,l,"gone")},set:function(e){this.condition="gone",n.setSubText(this.xml,l,"gone",e)}},redirect:{get:function(){return n.getSubText(this.xml,l,"redirect")},set:function(e){this.condition="redirect",n.setSubText(this.xml,l,"redirect",e)}},code:n.attribute("code"),type:n.attribute("type"),by:o.jidAttribute("by"),$text:{get:function(){return n.getSubLangText(this.xml,l,"text",this.lang)}},text:{get:function(){var e=this.$text;return e[this.lang]||""},set:function(e){n.setSubLangText(this.xml,l,"text",e,this.lang)}}}});n.extend(d,p),n.extend(i,p),n.extend(t,p)},{"./iq":69,"./message":74,"./presence":80,jxt:210,"jxt-xmpp-types":209}],61:[function(e,f,n){var o=e("jxt"),d=e("./iq"),i=e("./dataforms").DataForm,t="urn:xmpp:extdisco:1",l=n.Services=o.define({name:"services",namespace:t,element:"services",fields:{type:o.attribute("type")}}),u=n.Credentials=o.define({name:"credentials",namespace:t,element:"credentials"}),p=o.define({name:"service",namespace:t,element:"service",fields:{host:o.attribute("host"),port:o.attribute("port"),transport:o.attribute("transport"),type:o.attribute("type"),username:o.attribute("username"),password:o.attribute("password")}});o.extend(l,p,"services"),o.extend(u,p),o.extend(p,i),o.extend(d,l),o.extend(d,u)},{"./dataforms":57,"./iq":69,jxt:210}],62:[function(e,f,n){"use strict";var o=e("jxt"),d=e("./jingle"),i=e("./hash"),t="urn:xmpp:jingle:apps:file-transfer:3",l="urn:xmpp:thumbs:0";n.File=o.define({name:"_file",namespace:t,element:"file",fields:{name:o.subText(t,"name"),desc:o.subText(t,"desc"),size:o.numberSub(t,"size"),date:o.dateSub(t,"date")}}),n.Range=o.define({name:"range",namespace:t,element:"range",fields:{offset:o.numberAttribute("offset")}}),n.Thumbnail=o.define({name:"thumbnail",namespace:l,element:"thumbnail",fields:{cid:o.attribute("cid"),mimeType:o.attribute("mime-type"),width:o.numberAttribute("width"),height:o.numberAttribute("height")}}),n.FileTransfer=o.define({name:"_filetransfer",namespace:t,element:"description",fields:{descType:{value:"filetransfer"},offer:o.subExtension("offer",t,"offer",n.File),request:o.subExtension("request",t,"request",n.File)}}),d.registerDescription(n.FileTransfer),o.extend(n.File,i,"hashes"),o.extend(n.File,n.Range),o.extend(n.File,n.Thumbnail),o.extend(d.Content,n.FileTransfer)},{"./hash":66,"./jingle":70,jxt:210}],63:[function(e,f){var n=e("jxt"),o=e("./message"),d=e("./presence"),i=e("./iq"),t=e("./delayed"),l=f.exports=n.define({name:"forwarded",eventName:"forward",namespace:"urn:xmpp:forward:0",element:"forwarded"});n.extend(o,l),n.extend(l,o),n.extend(l,d),n.extend(l,i),n.extend(l,t)},{"./delayed":58,"./iq":69,"./message":74,"./presence":80,jxt:210}],64:[function(e,f,n){"use strict";var o=e("jxt"),d=e("jxt-xmpp-types"),i="urn:ietf:params:xml:ns:xmpp-framing";n.Open=o.define({name:"openStream",namespace:i,element:"open",topLevel:!0,fields:{lang:o.langAttribute(),id:o.attribute("id"),version:o.attribute("version","1.0"),to:d.jidAttribute("to",!0),from:d.jidAttribute("from",!0)}}),n.Close=o.define({name:"closeStream",namespace:i,element:"close",topLevel:!0,fields:{seeOtherURI:o.attribute("see-other-uri")}})},{jxt:210,"jxt-xmpp-types":209}],65:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types"),d=e("./pubsub").Item,i=e("./pubsubEvents").EventItem,t="http://jabber.org/protocol/geoloc",l=f.exports=n.define({name:"geoloc",namespace:t,element:"geoloc",fields:{accuracy:n.numberSub(t,"accuracy",!0),altitude:n.numberSub(t,"alt",!0),area:n.subText(t,"area"),heading:n.numberSub(t,"bearing",!0),bearing:n.numberSub(t,"bearing",!0),building:n.subText(t,"building"),country:n.subText(t,"country"),countrycode:n.subText(t,"countrycode"),datum:n.subText(t,"datum"),description:n.subText(t,"description"),error:n.numberSub(t,"error",!0),floor:n.subText(t,"floor"),latitude:n.numberSub(t,"lat",!0),locality:n.subText(t,"locality"),longitude:n.numberSub(t,"lon",!0),postalcode:n.subText(t,"postalcode"),region:n.subText(t,"region"),room:n.subText(t,"room"),speed:n.numberSub(t,"speed",!0),street:n.subText(t,"street"),text:n.subText(t,"text"),timestamp:n.dateSub(t,"timestamp"),tzo:o.tzoSub(t,"tzo"),uri:n.subText(t,"uri")}});n.extend(d,l),n.extend(i,l)},{"./pubsub":83,"./pubsubEvents":85,jxt:210,"jxt-xmpp-types":209}],66:[function(e,f){var n=e("jxt");f.exports=n.define({name:"hash",namespace:"urn:xmpp:hashes:1",element:"hash",fields:{algo:n.attribute("algo"),value:n.text()}})},{jxt:210}],67:[function(e,f){"use strict";var n=e("jxt"),o=e("./presence"),d="urn:xmpp:hats:0",i=f.exports=n.define({name:"_hat",namespace:d,element:"hat",fields:{lang:n.langAttribute(),name:n.attribute("name"),displayName:n.attribute("displayName")}});n.add(o,"hats",n.subMultiExtension(d,"hats",i))},{"./presence":80,jxt:210}],68:[function(e,f,n){var o=e("jxt"),d=e("./jingle"),i="urn:xmpp:jingle:transports:ice-udp:1";n.ICEUDP=o.define({name:"_iceUdp",namespace:i,element:"transport",fields:{transType:{value:"iceUdp"},pwd:o.attribute("pwd"),ufrag:o.attribute("ufrag")}}),n.RemoteCandidate=o.define({name:"remoteCandidate",namespace:i,element:"remote-candidate",fields:{component:o.attribute("component"),ip:o.attribute("ip"),port:o.attribute("port")}}),n.Candidate=o.define({name:"_iceUdpCandidate",namespace:i,element:"candidate",fields:{component:o.attribute("component"),foundation:o.attribute("foundation"),generation:o.attribute("generation"),id:o.attribute("id"),ip:o.attribute("ip"),network:o.attribute("network"),port:o.attribute("port"),priority:o.attribute("priority"),protocol:o.attribute("protocol"),relAddr:o.attribute("rel-addr"),relPort:o.attribute("rel-port"),tcpType:o.attribute("tcptype"),type:o.attribute("type")}}),n.Fingerprint=o.define({name:"_iceFingerprint",namespace:"urn:xmpp:jingle:apps:dtls:0",element:"fingerprint",fields:{hash:o.attribute("hash"),setup:o.attribute("setup"),value:o.text(),required:o.boolAttribute("required")}}),n.SctpMap=o.define({name:"_sctpMap",namespace:"urn:xmpp:jingle:transports:dtls-sctp:1",element:"sctpmap",fields:{number:o.attribute("number"),protocol:o.attribute("protocol"),streams:o.attribute("streams")}}),d.registerTransport(n.ICEUDP),o.extend(d.Content,n.ICEUDP),o.extend(n.ICEUDP,n.Candidate,"candidates"),o.extend(n.ICEUDP,n.RemoteCandidate),o.extend(n.ICEUDP,n.Fingerprint,"fingerprints"),o.extend(n.ICEUDP,n.SctpMap,"sctp")},{"./jingle":70,jxt:210}],69:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types"),d=f.exports=n.define({name:"iq",namespace:"jabber:client",element:"iq",topLevel:!0,fields:{lang:n.langAttribute(),id:n.attribute("id"),to:o.jidAttribute("to",!0),from:o.jidAttribute("from",!0),type:n.attribute("type")}}),i=d.prototype.toJSON;d.prototype.toJSON=function(){var e=i.call(this);return e.resultReply=this.resultReply,e.errorReply=this.errorReply,e},d.prototype.resultReply=function(e){return e=e||{},e.to=this.from,e.id=this.id,e.type="result",new d(e)},d.prototype.errorReply=function(e){return e=e||{},e.to=this.from,e.id=this.id,e.type="error",new d(e)}},{jxt:210,"jxt-xmpp-types":209}],70:[function(e,f,n){"use strict";var o=e("jxt"),d=e("./iq"),i=e("./error"),t="urn:xmpp:jingle:1",l="urn:xmpp:jingle:errors:1",u=["out-of-order","tie-break","unknown-session","unsupported-info"],p=["alternative-session","busy","cancel","connectivity-error","decline","expired","failed-application","failed-transport","general-error","gone","incompatible-parameters","media-error","security-error","success","timeout","unsupported-applications","unsupported-transports"],s={descriptions:[],transports:[]};n.registerDescription=function(e){s.descriptions.push(e.prototype._name)},n.registerTransport=function(e){s.transports.push(e.prototype._name)},n.Jingle=o.define({name:"jingle",namespace:t,element:"jingle",fields:{action:o.attribute("action"),initiator:o.attribute("initiator"),responder:o.attribute("responder"),sid:o.attribute("sid")}}),n.Content=o.define({name:"_jingleContent",namespace:t,element:"content",fields:{creator:o.attribute("creator"),disposition:o.attribute("disposition","session"),name:o.attribute("name"),senders:o.attribute("senders","both"),description:{get:function(){for(var e=s.descriptions,f=0,n=e.length;n>f;f++)if(this._extensions[e[f]])return this._extensions[e[f]]},set:function(e){var f="_"+e.descType;this[f]=e}},transport:{get:function(){for(var e=s.transports,f=0,n=e.length;n>f;f++)if(this._extensions[e[f]])return this._extensions[e[f]]},set:function(e){var f="_"+e.transType;this[f]=e}}}}),n.Reason=o.define({name:"reason",namespace:t,element:"reason",fields:{condition:o.enumSub(t,p),alternativeSession:{get:function(){return o.getSubText(this.xml,t,"alternative-session")},set:function(e){this.condition="alternative-session",o.setSubText(this.xml,t,"alternative-session",e)}},text:o.subText(t,"text")}}),o.add(i,"jingleCondition",o.enumSub(l,u)),o.extend(d,n.Jingle),o.extend(n.Jingle,n.Content,"contents"),o.extend(n.Jingle,n.Reason)},{"./error":60,"./iq":69,jxt:210}],71:[function(e,f){"use strict";var n=e("jxt"),o=e("./message"),d=e("./pubsub").Item,i=e("./pubsubEvents").EventItem,t=f.exports={get:function(){var e=n.getSubText(this.xml,"urn:xmpp:json:0","json");return e?JSON.parse(e):void 0},set:function(e){e=JSON.stringify(e),e&&n.setSubText(this.xml,"urn:xmpp:json:0","json",e)}};n.add(o,"json",t),n.add(d,"json",t),n.add(i,"json",t)},{"./message":74,"./pubsub":83,"./pubsubEvents":85,jxt:210}],72:[function(e,f,n){"use strict";var o=e("jxt"),d=e("./message"),i="urn:xmpp:eventlog";n.Log=o.define({name:"log",namespace:i,element:"log",fields:{id:o.attribute("id"),timestamp:o.dateAttribute("timestamp"),type:o.attribute("type"),level:o.attribute("level"),object:o.attribute("object"),subject:o.attribute("subject"),facility:o.attribute("facility"),module:o.attribute("module"),message:o.subText(i,"message"),stackTrace:o.subText(i,"stackTrace")}}),n.Tag=o.define({name:"_logtag",namespace:i,element:"tag",fields:{name:o.attribute("name"),value:o.attribute("value"),type:o.attribute("type")}}),o.extend(n.Log,n.Tag,"tags"),o.extend(d,n.Log)},{"./message":74,jxt:210}],73:[function(e,f,n){"use strict";var o=e("jxt"),d=e("jxt-xmpp-types"),i=e("./message"),t=e("./iq"),l=e("./forwarded"),u=e("./rsm"),p=e("xmpp-jid").JID;n.MAMQuery=o.define({name:"mamQuery",namespace:"urn:xmpp:mam:tmp",element:"query",fields:{queryid:o.attribute("queryid"),start:o.dateSub("urn:xmpp:mam:tmp","start"),end:o.dateSub("urn:xmpp:mam:tmp","end"),"with":d.jidSub("urn:xmpp:mam:tmp","with")}}),n.Result=o.define({name:"mam",eventName:"mam:result",namespace:"urn:xmpp:mam:tmp",element:"result",fields:{queryid:o.attribute("queryid"),id:o.attribute("id")}}),n.Archived=o.define({name:"_mamArchived",namespace:"urn:xmpp:mam:tmp",element:"archived",fields:{by:d.jidAttribute("by"),id:o.attribute("id")}}),n.Prefs=o.define({name:"mamPrefs",namespace:"urn:xmpp:mam:tmp",element:"prefs",fields:{defaultCondition:o.attribute("default"),always:{get:function(){var e=[],f=o.find(this.xml,this._NS,"always");if(0===f.length)return e;f=f[0];var n=o.getMultiSubText(f,this._NS,"jid");return n.forEach(function(f){e.push(new p(f.textContent))}),e},set:function(e){if(e.length>0){var f=o.find(this.xml,this._NS,"always");o.setMultiSubText(f,this._NS,"jid",e)}}},never:{get:function(){var e=[],f=o.find(this.xml,this._NS,"always");if(0===f.length)return e;f=f[0];var n=o.getMultiSubText(f,this._NS,"jid");return n.forEach(function(f){e.push(new p(f.textContent))}),e},set:function(e){if(e.length>0){var f=o.find(this.xml,this._NS,"never");o.setMultiSubText(f,this._NS,"jid",e)}}}}}),o.extend(i,n.Archived,"archived"),o.extend(t,n.MAMQuery),o.extend(t,n.Prefs),o.extend(i,n.Result),o.extend(n.Result,l),o.extend(n.MAMQuery,u)},{"./forwarded":63,"./iq":69,"./message":74,"./rsm":90,jxt:210,"jxt-xmpp-types":209,"xmpp-jid":236}],74:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types");f.exports=n.define({name:"message",namespace:"jabber:client",element:"message",topLevel:!0,fields:{lang:n.langAttribute(),id:n.attribute("id"),to:o.jidAttribute("to",!0),from:o.jidAttribute("from",!0),type:n.attribute("type","normal"),thread:n.subText("jabber:client","thread"),parentThread:n.subAttribute("jabber:client","thread","parent"),subject:n.subText("jabber:client","subject"),$body:{get:function(){return n.getSubLangText(this.xml,this._NS,"body",this.lang)}},body:{get:function(){var e=this.$body;return e[this.lang]||""},set:function(e){n.setSubLangText(this.xml,this._NS,"body",e,this.lang)}},attention:n.boolSub("urn:xmpp:attention:0","attention"),chatState:n.enumSub("http://jabber.org/protocol/chatstates",["active","composing","paused","inactive","gone"]),replace:n.subAttribute("urn:xmpp:message-correct:0","replace","id"),requestReceipt:n.boolSub("urn:xmpp:receipts","request"),receipt:n.subAttribute("urn:xmpp:receipts","received","id")}})
},{jxt:210,"jxt-xmpp-types":209}],75:[function(e,f){"use strict";var n=e("jxt"),o=e("./pubsub").Item,d=e("./pubsubEvents").EventItem,i=e("./message"),t="http://jabber.org/protocol/mood",l=["afraid","amazed","amorous","angry","annoyed","anxious","aroused","ashamed","bored","brave","calm","cautious","cold","confident","confused","contemplative","contented","cranky","crazy","creative","curious","dejected","depressed","disappointed","disgusted","dismayed","distracted","embarrassed","envious","excited","flirtatious","frustrated","grateful","grieving","grumpy","guilty","happy","hopeful","hot","humbled","humiliated","hungry","hurt","impressed","in_awe","in_love","indignant","interested","intoxicated","invincible","jealous","lonely","lucky","mean","moody","nervous","neutral","offended","outraged","playful","proud","relaxed","relieved","remorseful","restless","sad","sarcastic","serious","shocked","shy","sick","sleepy","spontaneous","stressed","strong","surprised","thankful","thirsty","tired","undefined","weak","worried"],u=f.exports=n.define({name:"mood",namespace:t,element:"mood",fields:{text:n.subText(t,"text"),value:n.enumSub(t,l)}});n.extend(o,u),n.extend(d,u),n.extend(i,u)},{"./message":74,"./pubsub":83,"./pubsubEvents":85,jxt:210}],76:[function(e,f,n){"use strict";var o=e("jxt"),d=e("./message"),i=e("./presence"),t=e("./iq"),l=e("./dataforms").DataForm,u=e("jxt-xmpp-types"),p="http://jabber.org/protocol/muc",s=p+"#user",y=p+"#admin",c=p+"#owner",a=p+"#unique",r=function(e,f){return{get:function(){return this._extensions[e]?this[e][f]:void 0},set:function(n){this[e][f]=n}}},w=o.define({name:"_mucUserItem",namespace:s,element:"item",fields:{affiliation:o.attribute("affiliation"),nick:o.attribute("nick"),jid:u.jidAttribute("jid"),role:o.attribute("role"),reason:o.subText(s,"reason")}}),b=o.define({name:"_mucUserActor",namespace:s,element:"actor",fields:{nick:o.attribute("nick"),jid:u.jidAttribute("jid")}}),m=o.define({name:"destroyed",namespace:s,element:"destroy",fields:{jid:u.jidAttribute("jid"),reason:o.subText(s,"reason")}}),g=o.define({name:"invite",namespace:s,element:"invite",fields:{to:u.jidAttribute("to"),from:u.jidAttribute("from"),reason:o.subText(s,"reason"),thread:o.subAttribute(s,"continue","thread"),"continue":o.boolSub(s,"continue")}}),x=o.define({name:"decline",namespace:s,element:"decline",fields:{to:u.jidAttribute("to"),from:u.jidAttribute("from"),reason:o.subText(s,"reason")}}),P=o.define({name:"_mucAdminItem",namespace:y,element:"item",fields:{affiliation:o.attribute("affiliation"),nick:o.attribute("nick"),jid:u.jidAttribute("jid"),role:o.attribute("role"),reason:o.subText(y,"reason")}}),j=o.define({name:"actor",namespace:s,element:"actor",fields:{nick:o.attribute("nick"),jid:u.jidAttribute("jid")}}),v=o.define({name:"destroy",namespace:c,element:"destroy",fields:{jid:u.jidAttribute("jid"),password:o.subText(c,"password"),reason:o.subText(c,"reason")}});n.MUC=o.define({name:"muc",namespace:s,element:"x",fields:{affiliation:r("_mucUserItem","affiliation"),nick:r("_mucUserItem","nick"),jid:r("_mucUserItem","jid"),role:r("_mucUserItem","role"),actor:r("_mucUserItem","_mucUserActor"),reason:r("_mucUserItem","reason"),password:o.subText(s,"password"),codes:{get:function(){return o.getMultiSubText(this.xml,s,"status",function(e){return o.getAttribute(e,"code")})},set:function(e){var f=this;o.setMultiSubText(this.xml,s,"status",e,function(e){var n=o.createElement(s,"status",s);o.setAttribute(n,"code",e),f.xml.appendChild(n)})}}}}),n.MUCAdmin=o.define({name:"mucAdmin",namespace:y,element:"query",fields:{affiliation:r("_mucAdminItem","affiliation"),nick:r("_mucAdminItem","nick"),jid:r("_mucAdminItem","jid"),role:r("_mucAdminItem","role"),actor:r("_mucAdminItem","_mucAdminActor"),reason:r("_mucAdminItem","reason")}}),n.MUCOwner=o.define({name:"mucOwner",namespace:c,element:"query"}),n.MUCJoin=o.define({name:"joinMuc",namespace:p,element:"x",fields:{password:o.subText(p,"password"),history:{get:function(){var e={},f=o.find(this.xml,this._NS,"history");if(!f.length)return{};f=f[0];var n=f.getAttribute("maxchars")||"",d=f.getAttribute("maxstanas")||"",i=f.getAttribute("seconds")||"",t=f.getAttribute("since")||"";n&&(e.maxchars=parseInt(n,10)),d&&(e.maxstanzas=parseInt(d,10)),i&&(e.seconds=parseInt(i,10)),t&&(e.since=new Date(t))},set:function(e){var f=o.find(this.xml,this._NS,"history");if(f.length)for(var n=0;n<f.length;n++)this.xml.removeChild(f[n]);var d=o.createElement(this._NS,"history",this._NS);this.xml.appendChild(d),e.maxchars&&d.setAttribute(""+e.maxchars),e.maxstanzas&&d.setAttribute(""+e.maxstanzas),e.seconds&&d.setAttribute(""+e.seconds),e.since&&d.setAttribute(e.since.toISOString())}}}}),n.DirectInvite=o.define({name:"mucInvite",namespace:"jabber:x:conference",element:"x",fields:{jid:u.jidAttribute("jid"),password:o.attribute("password"),reason:o.attribute("reason"),thread:o.attribute("thread"),"continue":o.boolAttribute("continue")}}),o.add(t,"mucUnique",o.subText(a,"unique")),o.extend(w,b),o.extend(n.MUC,w),o.extend(n.MUC,g,"invites"),o.extend(n.MUC,x),o.extend(n.MUC,m),o.extend(P,j),o.extend(n.MUCAdmin,P,"items"),o.extend(n.MUCOwner,v),o.extend(n.MUCOwner,l),o.extend(i,n.MUC),o.extend(d,n.MUC),o.extend(i,n.MUCJoin),o.extend(d,n.DirectInvite),o.extend(t,n.MUCAdmin),o.extend(t,n.MUCOwner)},{"./dataforms":57,"./iq":69,"./message":74,"./presence":80,jxt:210,"jxt-xmpp-types":209}],77:[function(e){"use strict";var f=e("jxt"),n=e("./pubsub").Item,o=e("./pubsubEvents").EventItem,d=e("./presence"),i=e("./message"),t=f.subText("http://jabber.org/protocol/nick","nick");f.add(n,"nick",t),f.add(o,"nick",t),f.add(d,"nick",t),f.add(i,"nick",t)},{"./message":74,"./presence":80,"./pubsub":83,"./pubsubEvents":85,jxt:210}],78:[function(e,f){"use strict";var n=e("jxt"),o=e("./message"),d="jabber:x:oob",i=f.exports=n.define({name:"oob",element:"x",namespace:d,fields:{url:n.subText(d,"url"),desc:n.subText(d,"desc")}});n.extend(o,i,"oobURIs")},{"./message":74,jxt:210}],79:[function(e,f){var n=e("jxt"),o=e("./iq"),d="urn:xmpp:ping",i=f.exports=n.define({name:"ping",namespace:d,element:"ping",fields:{}});n.extend(o,i)},{"./iq":69,jxt:210}],80:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types");f.exports=n.define({name:"presence",namespace:"jabber:client",element:"presence",topLevel:!0,fields:{lang:n.langAttribute(),id:n.attribute("id"),to:o.jidAttribute("to",!0),from:o.jidAttribute("from",!0),priority:n.numberSub("jabber:client","priority",!1,0),show:n.subText("jabber:client","show"),type:{get:function(){return n.getAttribute(this.xml,"type","available")},set:function(e){"available"===e&&(e=!1),n.setAttribute(this.xml,"type",e)}},$status:{get:function(){return n.getSubLangText(this.xml,this._NS,"status",this.lang)}},status:{get:function(){var e=this.$status;return e[this.lang]||""},set:function(e){n.setSubLangText(this.xml,this._NS,"status",e,this.lang)}},idleSince:n.dateSubAttribute("urn:xmpp:idle:1","idle","since"),decloak:n.subAttribute("urn:xmpp:decloak:0","decloak","reason"),avatarId:{get:function(){var e="vcard-temp:x:update",f=n.find(this.xml,e,"x");return f.length?n.getSubText(f[0],e,"photo"):""},set:function(e){var f="vcard-temp:x:update",o=n.findOrCreate(this.xml,f,"x");if(""===e)n.setBoolSub(o,f,"photo",!0);else{if(e===!0)return;e?n.setSubText(o,f,"photo",e):this.xml.removeChild(o)}}}}})},{jxt:210,"jxt-xmpp-types":209}],81:[function(e,f){var n=e("jxt"),o=e("./iq"),d=f.exports=n.define({name:"privateStorage",namespace:"jabber:iq:private",element:"query"});n.extend(o,d)},{"./iq":69,jxt:210}],82:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types"),d=e("./presence"),i="urn:xmpp:psa",t=["server-unavailable","connection-paused"],l=f.exports=n.define({name:"state",namespace:i,element:"state-annotation",fields:{from:o.jidAttribute("from"),condition:n.enumSub(i,t),description:n.subText(i,"description")}});n.extend(d,l)},{"./presence":80,jxt:210,"jxt-xmpp-types":209}],83:[function(e,f,n){"use strict";var o=e("jxt"),d=e("jxt-xmpp-types"),i=e("./iq"),t=e("./dataforms").DataForm,l=e("./rsm"),u="http://jabber.org/protocol/pubsub";n.Pubsub=o.define({name:"pubsub",namespace:"http://jabber.org/protocol/pubsub",element:"pubsub",fields:{publishOptions:{get:function(){var e=o.find(this.xml,this._NS,"publish-options");return e.length&&e[0].childNodes.length?new t({},e[0].childNodes[0]):void 0},set:function(e){var f=o.findOrCreate(this.xml,this._NS,"publish-options");if(e){var n=new t(e);f.appendChild(n.xml)}}}}}),n.Subscribe=o.define({name:"subscribe",namespace:u,element:"subscribe",fields:{node:o.attribute("node"),jid:d.jidAttribute("jid")}}),n.Subscription=o.define({name:"subscription",namespace:u,element:"subscription",fields:{node:o.attribute("node"),jid:d.jidAttribute("jid"),subid:o.attribute("subid"),type:o.attribute("subscription"),configurable:o.boolSub("subscribe-options"),configurationRequired:{get:function(){var e=o.find(this.xml,u,"subscribe-options");return e.length?o.getBoolSub(e[0],u,"required"):!1}}}}),n.SubscriptionOptions=o.define({name:"subscriptionOptions",namespace:u,element:"options",fields:{node:o.attribute("node"),jid:d.jidAttribute("jid"),subid:o.attribute("subid")}}),n.Unsubscribe=o.define({name:"unsubscribe",namespace:u,element:"unsubscribe",fields:{node:o.attribute("node"),jid:d.jidAttribute("jid")}}),n.Publish=o.define({name:"publish",namespace:u,element:"publish",fields:{node:o.attribute("node")}}),n.Retract=o.define({name:"retract",namespace:u,element:"retract",fields:{node:o.attribute("node"),notify:o.boolAttribute("notify"),id:o.subAttribute(u,"item","id")}}),n.Retrieve=o.define({name:"retrieve",namespace:u,element:"items",fields:{node:o.attribute("node"),max:o.attribute("max_items")}}),n.Item=o.define({name:"item",namespace:u,element:"item",fields:{id:o.attribute("id")}}),o.extend(n.Pubsub,n.Subscribe),o.extend(n.Pubsub,n.Unsubscribe),o.extend(n.Pubsub,n.Publish),o.extend(n.Pubsub,n.Retrieve),o.extend(n.Pubsub,n.Subscription),o.extend(n.Pubsub,n.SubscriptionOptions),o.extend(n.Pubsub,l),o.extend(n.Publish,n.Item,"items"),o.extend(n.Retrieve,n.Item,"items"),o.extend(n.SubscriptionOptions,t),o.extend(i,n.Pubsub)},{"./dataforms":57,"./iq":69,"./rsm":90,jxt:210,"jxt-xmpp-types":209}],84:[function(e){"use strict";var f=e("jxt"),n=e("./error"),o="http://jabber.org/protocol/pubsub#errors",d=["closed-node","configuration-required","invalid-jid","invalid-options","invalid-payload","invalid-subid","item-forbidden","item-required","jid-required","max-items-exceeded","max-nodes-exceeded","nodeid-required","not-in-roster-group","not-subscribed","payload-too-big","payload-required","pending-subscription","presence-subscription-required","subid-required","too-many-subscriptions","unsupported","unsupported-access-model"];f.add(n,"pubsubCondition",f.enumSub(o,d))},{"./error":60,jxt:210}],85:[function(e,f,n){"use strict";var o=e("jxt"),d=e("jxt-xmpp-types"),i=e("./message"),t=e("./dataforms").DataForm,l="http://jabber.org/protocol/pubsub#event";n.Event=o.define({name:"event",namespace:l,element:"event"}),n.EventPurge=o.define({name:"purged",namespace:l,element:"purge",fields:{node:o.attribute("node")}}),n.EventDelete=o.define({name:"deleted",namespace:l,element:"delete",fields:{node:o.attribute("node"),redirect:o.subAttribute(l,"redirect","uri")}}),n.EventSubscription=o.define({name:"subscriptionChanged",namespace:l,element:"subscription",fields:{node:o.attribute("node"),jid:d.jidAttribute("jid"),type:o.attribute("subscription"),subid:o.attribute("subid"),expiry:{get:function(){var e=o.getAttribute(this.xml,"expiry");return"presence"===e?e:e?new Date(e):void 0},set:function(e){e&&("string"!=typeof e&&(e=e.toISOString()),o.setAttribute(this.xml,"expiry",e))}}}}),n.EventConfiguration=o.define({name:"configurationChanged",namespace:l,element:"configuration",fields:{node:o.attribute("node")}}),n.EventItems=o.define({name:"updated",namespace:l,element:"items",fields:{node:o.attribute("node"),retracted:{get:function(){var e=[],f=o.find(this.xml,this._NS,"retract");return f.forEach(function(f){e.push(f.getAttribute("id"))}),e},set:function(e){var f=this;e.forEach(function(e){var n=o.createElement(f._NS,"retract",f._NS);n.setAttribute("id",e),this.xml.appendChild(n)})}}}}),n.EventItem=o.define({name:"_eventItem",namespace:l,element:"item",fields:{id:o.attribute("id"),node:o.attribute("node"),publisher:d.jidAttribute("publisher")}}),o.extend(n.EventConfiguration,t),o.extend(n.EventItems,n.EventItem,"published"),o.extend(n.Event,n.EventItems),o.extend(n.Event,n.EventSubscription),o.extend(n.Event,n.EventConfiguration),o.extend(n.Event,n.EventDelete),o.extend(n.Event,n.EventPurge),o.extend(i,n.Event)},{"./dataforms":57,"./message":74,jxt:210,"jxt-xmpp-types":209}],86:[function(e,f,n){"use strict";var o=e("jxt"),d=e("./iq"),i=e("./dataforms").DataForm,t="http://jabber.org/protocol/pubsub#owner";n.PubsubOwner=o.define({name:"pubsubOwner",namespace:t,element:"pubsub",fields:{create:o.subAttribute(t,"create","node"),purge:o.subAttribute(t,"purge","node"),del:o.subAttribute(t,"delete","node"),redirect:{get:function(){var e=o.find(this.xml,this._NS,"delete");return e.length?o.getSubAttribute(e[0],this._NS,"redirect","uri"):""},set:function(e){var f=o.findOrCreate(this.xml,this._NS,"delete");o.setSubAttribute(f,this._NS,"redirect","uri",e)}}}}),n.Configure=o.define({name:"config",namespace:t,element:"configure",fields:{node:o.attribute("node")}}),o.extend(n.Configure,i),o.extend(n.PubsubOwner,n.Configure),o.extend(d,n.PubsubOwner)},{"./dataforms":57,"./iq":69,jxt:210}],87:[function(e,f){"use strict";var n=e("underscore"),o=e("jxt"),d=e("./pubsub").Item,i=e("./pubsubEvents").EventItem,t=e("./presence"),l="urn:xmpp:reach:0",u=f.exports=o.define({name:"_reachAddr",namespace:l,element:"addr",fields:{uri:o.attribute("uri"),$desc:{get:function(){return o.getSubLangText(this.xml,l,"desc",this.lang)}},desc:{get:function(){var e=this.$desc;return e[this.lang]||""},set:function(e){o.setSubLangText(this.xml,l,"desc",e,this.lang)}}}}),p={get:function(){var e=o.find(this.xml,l,"reach"),f=[];if(e.length){var d=o.find(e[0],l,"addr");n.forEach(d,function(e){f.push(new u({},e))})}return f},set:function(e){var f=o.findOrCreate(this.xml,l,"reach");o.setAttribute(f,"xmlns",l),n.forEach(e,function(e){var n=new u(e);f.appendChild(n.xml)})}};o.add(d,"reach",p),o.add(i,"reach",p),o.add(t,"reach",p)},{"./presence":80,"./pubsub":83,"./pubsubEvents":85,jxt:210,underscore:234}],88:[function(e,f){var n=e("jxt"),o=e("./iq"),d=e("./dataforms").DataForm,i=e("./oob"),t="jabber:iq:register",l=f.exports=n.define({name:"register",namespace:t,element:"query",fields:{instructions:n.subText(t,"instructions"),registered:n.boolSub(t,"registered"),remove:n.boolSub(t,"remove"),username:n.subText(t,"username"),nick:n.subText(t,"nick"),password:n.subText(t,"password"),name:n.subText(t,"name"),first:n.subText(t,"first"),last:n.subText(t,"last"),email:n.subText(t,"email"),address:n.subText(t,"address"),city:n.subText(t,"city"),state:n.subText(t,"state"),zip:n.subText(t,"zip"),phone:n.subText(t,"phone"),url:n.subText(t,"url"),date:n.subText(t,"date"),misc:n.subText(t,"misc"),text:n.subText(t,"text"),key:n.subText(t,"key")}});n.extend(o,l),n.extend(l,d),n.extend(l,i)},{"./dataforms":57,"./iq":69,"./oob":78,jxt:210}],89:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types"),d=e("./iq"),i="jabber:iq:roster",t=f.exports=n.define({name:"roster",namespace:i,element:"query",fields:{ver:{get:function(){return n.getAttribute(this.xml,"ver")},set:function(e){var f=""===e;n.setAttribute(this.xml,"ver",e,f)}}}}),l=n.define({name:"_rosterItem",namespace:i,element:"item",fields:{jid:o.jidAttribute("jid",!0),name:n.attribute("name"),subscription:n.attribute("subscription","none"),subscriptionRequested:{get:function(){var e=n.getAttribute(this.xml,"ask");return"subscribe"===e}},preApproved:n.boolAttribute(i,"approved"),groups:n.multiSubText(i,"group")}});n.extend(d,t),n.extend(t,l,"items")},{"./iq":69,jxt:210,"jxt-xmpp-types":209}],90:[function(e,f){"use strict";var n=e("jxt"),o="http://jabber.org/protocol/rsm";f.exports=n.define({name:"rsm",namespace:o,element:"set",fields:{after:n.subText(o,"after"),before:{get:function(){return n.getSubText(this.xml,this._NS,"before")},set:function(e){e===!0?n.findOrCreate(this.xml,this._NS,"before"):n.setSubText(this.xml,this._NS,"before",e)}},count:n.numberSub(o,"count",!1,0),first:n.subText(o,"first"),firstIndex:n.subAttribute(o,"first","index"),index:n.subText(o,"index"),last:n.subText(o,"last"),max:n.subText(o,"max")}})},{jxt:210}],91:[function(e,f,n){"use strict";var o=e("jxt"),d=e("./jingle"),i="urn:xmpp:jingle:apps:rtp:1",t="urn:xmpp:jingle:apps:rtp:rtcp-fb:0",l="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",u="urn:xmpp:jingle:apps:rtp:info:1",p="urn:xmpp:jingle:apps:rtp:ssma:0",s="urn:xmpp:jingle:apps:grouping:0",y={get:function(){var e=o.find(this.xml,t,"rtcp-fb"),f=[];return e.forEach(function(e){f.push({type:o.getAttribute(e,"type"),subtype:o.getAttribute(e,"subtype")})}),e=o.find(this.xml,t,"rtcp-fb-trr-int"),e.forEach(function(e){f.push({type:o.getAttribute(e,"type"),value:o.getAttribute(e,"value")})}),f},set:function(e){var f=this,n=o.find(this.xml,t,"rtcp-fb");n.forEach(function(e){f.xml.removeChild(e)}),n=o.find(this.xml,t,"rtcp-fb-trr-int"),n.forEach(function(e){f.xml.removeChild(e)}),e.forEach(function(e){var n;"trr-int"===e.type?(n=o.createElement(t,"rtcp-fb-trr-int",i),o.setAttribute(n,"type",e.type),o.setAttribute(n,"value",e.value)):(n=o.createElement(t,"rtcp-fb",i),o.setAttribute(n,"type",e.type),o.setAttribute(n,"subtype",e.subtype)),f.xml.appendChild(n)})}};n.RTP=o.define({name:"_rtp",namespace:i,element:"description",fields:{descType:{value:"rtp"},media:o.attribute("media"),ssrc:o.attribute("ssrc"),mux:o.boolSub(i,"rtcp-mux"),encryption:{get:function(){var e=o.find(this.xml,i,"encryption");if(!e.length)return[];e=e[0];var f=this,d=o.find(e,i,"crypto"),t=[];return d.forEach(function(e){t.push(new n.Crypto({},e,f).toJSON())}),t},set:function(e){var f=o.find(this.xml,i,"encryption");if(f.length&&this.xml.removeChild(f),e.length){o.setBoolSubAttribute(this.xml,i,"encryption","required",!0),f=o.find(this.xml,i,"encryption")[0];var d=this;e.forEach(function(e){var o=new n.Crypto(e,null,d);f.appendChild(o.xml)})}}},feedback:y,headerExtensions:{get:function(){var e=o.find(this.xml,l,"rtp-hdrext"),f=[];return e.forEach(function(e){f.push({id:o.getAttribute(e,"id"),uri:o.getAttribute(e,"uri"),senders:o.getAttribute(e,"senders")})}),f},set:function(e){var f=this,n=o.find(this.xml,l,"rtp-hdrext");n.forEach(function(e){f.xml.removeChild(e)}),e.forEach(function(e){var n=o.createElement(l,"rtp-hdrext",i);o.setAttribute(n,"id",e.id),o.setAttribute(n,"uri",e.uri),o.setAttribute(n,"senders",e.senders),f.xml.appendChild(n)})}}}}),n.PayloadType=o.define({name:"_payloadType",namespace:i,element:"payload-type",fields:{channels:o.attribute("channels"),clockrate:o.attribute("clockrate"),id:o.attribute("id"),maxptime:o.attribute("maxptime"),name:o.attribute("name"),ptime:o.attribute("ptime"),feedback:y,parameters:{get:function(){var e=[],f=o.find(this.xml,i,"parameter");return f.forEach(function(f){e.push({key:o.getAttribute(f,"name"),value:o.getAttribute(f,"value")})}),e},set:function(e){var f=this;e.forEach(function(e){var n=o.createElement(i,"parameter");o.setAttribute(n,"name",e.key),o.setAttribute(n,"value",e.value),f.xml.appendChild(n)})}}}}),n.Bandwidth=o.define({name:"bandwidth",namespace:i,element:"bandwidth",fields:{type:o.attribute("type"),bandwidth:o.text()}}),n.Crypto=o.define({name:"crypto",namespace:i,element:"crypto",fields:{cipherSuite:o.attribute("crypto-suite"),keyParams:o.attribute("key-params"),sessionParams:o.attribute("session-params"),tag:o.attribute("tag")}}),n.ContentGroup=o.define({name:"_group",namespace:s,element:"group",fields:{semantics:o.attribute("semantics"),contents:o.multiSubAttribute(s,"content","name")}}),n.SourceGroup=o.define({name:"_sourceGroup",namespace:p,element:"ssrc-group",fields:{semantics:o.attribute("semantics"),sources:o.multiSubAttribute(p,"source","ssrc")}}),n.Source=o.define({name:"_source",namespace:p,element:"source",fields:{ssrc:o.attribute("ssrc"),parameters:{get:function(){var e=[],f=o.find(this.xml,p,"parameter");return f.forEach(function(f){e.push({key:o.getAttribute(f,"name"),value:o.getAttribute(f,"value")})}),e},set:function(e){var f=this;e.forEach(function(e){var n=o.createElement(p,"parameter");o.setAttribute(n,"name",e.key),o.setAttribute(n,"value",e.value),f.xml.appendChild(n)})}}}}),n.Mute=o.define({name:"mute",namespace:u,element:"mute",fields:{creator:o.attribute("creator"),name:o.attribute("name")}}),n.Unmute=o.define({name:"unmute",namespace:u,element:"unmute",fields:{creator:o.attribute("creator"),name:o.attribute("name")}}),d.registerDescription(n.RTP),o.extend(d.Content,n.RTP),o.extend(n.RTP,n.Bandwidth),o.extend(n.RTP,n.PayloadType,"payloads"),o.extend(n.RTP,n.Source,"sources"),o.extend(n.RTP,n.SourceGroup,"sourceGroups"),o.extend(d.Jingle,n.Mute),o.extend(d.Jingle,n.Unmute),o.extend(d.Jingle,n.ContentGroup,"groups"),o.add(d.Jingle,"ringing",o.boolSub(u,"ringing")),o.add(d.Jingle,"hold",o.boolSub(u,"hold")),o.add(d.Jingle,"active",o.boolSub(u,"active"))},{"./jingle":70,jxt:210}],92:[function(e,f){var n=e("jxt"),o=e("./message"),d="urn:xmpp:rtt:0",i={insert:"t",erase:"e",wait:"w"},t={t:"insert",e:"erase",w:"wait"},l=f.exports=n.define({name:"rtt",namespace:d,element:"rtt",fields:{id:n.attribute("id"),event:n.attribute("event","edit"),seq:n.numberAttribute("seq"),actions:{get:function(){for(var e=[],f=0,o=this.xml.childNodes.length;o>f;f++){var i=this.xml.childNodes[f],l=i.localName,u={};if(i.namespaceURI===d&&t[l]){u.type=t[l];var p=n.getAttribute(i,"p");p&&(u.pos=parseInt(p,10));var s=n.getAttribute(i,"n");s&&(u.num=parseInt(s,10));var y=n.getText(i);y&&"t"===l&&(u.text=y),e.push(u)}}return e},set:function(e){for(var f=this,o=0,t=this.xml.childNodes.length;t>o;o++)this.xml.removeChild(this.xml.childNodes[o]);e.forEach(function(e){if(i[e.type]){var o=n.createElement(d,i[e.type],d);void 0!==e.pos&&n.setAttribute(o,"p",e.pos.toString()),e.num&&n.setAttribute(o,"n",e.num.toString()),e.text&&n.setText(o,e.text),f.xml.appendChild(o)}})}}}});n.extend(o,l)},{"./message":74,jxt:210}],93:[function(e,f,n){"use strict";var o=e("jxt"),d=e("./streamFeatures"),i="urn:ietf:params:xml:ns:xmpp-sasl",t=["aborted","account-disabled","credentials-expired","encryption-required","incorrect-encoding","invalid-authzid","invalid-mechanism","malformed-request","mechanism-too-weak","not-authorized","temporary-auth-failure"];n.Mechanisms=o.define({name:"sasl",namespace:i,element:"mechanisms",fields:{mechanisms:o.multiSubText(i,"mechanism")}}),n.Auth=o.define({name:"saslAuth",eventName:"sasl:auth",namespace:i,element:"auth",topLevel:!0,fields:{value:o.b64Text(),mechanism:o.attribute("mechanism")}}),n.Challenge=o.define({name:"saslChallenge",eventName:"sasl:challenge",namespace:i,element:"challenge",topLevel:!0,fields:{value:o.b64Text()}}),n.Response=o.define({name:"saslResponse",eventName:"sasl:response",namespace:i,element:"response",topLevel:!0,fields:{value:o.b64Text()}}),n.Abort=o.define({name:"saslAbort",eventName:"sasl:abort",namespace:i,element:"abort",topLevel:!0}),n.Success=o.define({name:"saslSuccess",eventName:"sasl:success",namespace:i,element:"success",topLevel:!0,fields:{value:o.b64Text()}}),n.Failure=o.define({name:"saslFailure",eventName:"sasl:failure",namespace:i,element:"failure",topLevel:!0,fields:{lang:{get:function(){return this._lang||""},set:function(e){this._lang=e}},condition:o.enumSub(i,t),$text:{get:function(){return o.getSubLangText(this.xml,i,"text",this.lang)}},text:{get:function(){var e=this.$text;return e[this.lang]||""},set:function(e){o.setSubLangText(this.xml,i,"text",e,this.lang)}}}}),o.extend(d,n.Mechanisms)},{"./streamFeatures":99,jxt:210}],94:[function(e,f){var n=e("jxt"),o=e("./iq"),d=e("./streamFeatures"),i="urn:ietf:params:xml:ns:xmpp-session",t=f.exports=n.define({name:"session",namespace:i,element:"session",fields:{required:n.boolSub(i,"required"),optional:n.boolSub(i,"optional")}});n.extend(d,t),n.extend(o,t)},{"./iq":69,"./streamFeatures":99,jxt:210}],95:[function(e,f){var n=e("jxt"),o=e("./message"),d=e("./presence"),i="http://jabber.org/protocol/shim",t=f.exports={get:function(){var e=n.find(this.xml,i,"headers");return e.length?n.getMultiSubText(e[0],i,"header",function(e){var f=n.getAttribute(e,"name");return f?{name:f,value:n.getText(e)}:void 0}):[]},set:function(e){var f=n.findOrCreate(this.xml,i,"headers");n.setMultiSubText(f,i,"header",e,function(e){var o=n.createElement(i,"header",i);n.setAttribute(o,"name",e.name),n.setText(o,e.value),f.appendChild(o)})}};n.add(o,"headers",t),n.add(d,"headers",t)},{"./message":74,"./presence":80,jxt:210}],96:[function(e,f,n){var o=e("jxt"),d=e("./streamFeatures"),i="urn:xmpp:sm:3";n.SMFeature=o.define({name:"streamManagement",namespace:i,element:"sm"}),n.Enable=o.define({name:"smEnable",eventName:"stream:management:enable",namespace:i,element:"enable",topLevel:!0,fields:{resume:o.boolAttribute("resume")}}),n.Enabled=o.define({name:"smEnabled",eventName:"stream:management:enabled",namespace:i,element:"enabled",topLevel:!0,fields:{id:o.attribute("id"),resume:o.boolAttribute("resume")}}),n.Resume=o.define({name:"smResume",eventName:"stream:management:resume",namespace:i,element:"resume",topLevel:!0,fields:{h:o.numberAttribute("h",!1,0),previd:o.attribute("previd")}}),n.Resumed=o.define({name:"smResumed",eventName:"stream:management:resumed",namespace:i,element:"resumed",topLevel:!0,fields:{h:o.numberAttribute("h",!1,0),previd:o.attribute("previd")}}),n.Failed=o.define({name:"smFailed",eventName:"stream:management:failed",namespace:i,element:"failed",topLevel:!0}),n.Ack=o.define({name:"smAck",eventName:"stream:management:ack",namespace:i,element:"a",topLevel:!0,fields:{h:o.numberAttribute("h",!1,0)}}),n.Request=o.define({name:"smRequest",eventName:"stream:management:request",namespace:i,element:"r",topLevel:!0}),o.extend(d,n.SMFeature)},{"./streamFeatures":99,jxt:210}],97:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types");f.exports=n.define({name:"stream",namespace:"http://etherx.jabber.org/streams",element:"stream",fields:{lang:n.langAttribute(),id:n.attribute("id"),version:n.attribute("version","1.0"),to:o.jidAttribute("to",!0),from:o.jidAttribute("from",!0)}})},{jxt:210,"jxt-xmpp-types":209}],98:[function(e,f){"use strict";var n=e("jxt"),o="urn:ietf:params:xml:ns:xmpp-streams",d=["bad-format","bad-namespace-prefix","conflict","connection-timeout","host-gone","host-unknown","improper-addressing","internal-server-error","invalid-from","invalid-namespace","invalid-xml","not-authorized","not-well-formed","policy-violation","remote-connection-failed","reset","resource-constraint","restricted-xml","see-other-host","system-shutdown","undefined-condition","unsupported-encoding","unsupported-feature","unsupported-stanza-type","unsupported-version"];f.exports=n.define({name:"streamError",namespace:"http://etherx.jabber.org/streams",element:"error",topLevel:!0,fields:{lang:{get:function(){return this._lang||""},set:function(e){this._lang=e}},condition:n.enumSub(o,d),seeOtherHost:{get:function(){return n.getSubText(this.xml,o,"see-other-host")},set:function(e){this.condition="see-other-host",n.setSubText(this.xml,o,"see-other-host",e)}},$text:{get:function(){return n.getSubLangText(this.xml,o,"text",this.lang)}},text:{get:function(){var e=this.$text;return e[this.lang]||""},set:function(e){n.setSubLangText(this.xml,o,"text",e,this.lang)}}}})},{jxt:210}],99:[function(e,f){"use strict";var n=e("jxt"),o=f.exports=n.define({name:"streamFeatures",namespace:"http://etherx.jabber.org/streams",element:"features",topLevel:!0}),d=n.define({name:"rosterVersioning",namespace:"urn:xmpp:features:rosterver",element:"ver"}),i=n.define({name:"subscriptionPreApproval",namespace:"urn:xmpp:features:pre-approval",element:"sub"});n.extend(o,d),n.extend(o,i)},{jxt:210}],100:[function(e,f){"use strict";var n=e("jxt"),o=e("jxt-xmpp-types"),d=e("./iq"),i=f.exports=n.define({name:"time",namespace:"urn:xmpp:time",element:"time",fields:{utc:n.dateSub("urn:xmpp:time","utc"),tzo:o.tzoSub("urn:xmpp:time","tzo",0)}});n.extend(d,i)},{"./iq":69,jxt:210,"jxt-xmpp-types":209}],101:[function(e,f){"use strict";var n=e("jxt"),o=e("./iq"),d="vcard-temp",i=f.exports=n.define({name:"vCardTemp",namespace:d,element:"vCard",fields:{role:n.subText(d,"ROLE"),website:n.subText(d,"URL"),title:n.subText(d,"TITLE"),description:n.subText(d,"DESC"),fullName:n.subText(d,"FN"),birthday:n.dateSub(d,"BDAY"),nicknames:n.multiSubText(d,"NICKNAME"),jids:n.multiSubText(d,"JABBERID")}}),t=n.define({name:"_email",namespace:d,element:"EMAIL",fields:{email:n.subText(d,"USERID"),home:n.boolSub(d,"HOME"),work:n.boolSub(d,"WORK"),preferred:n.boolSub(d,"PREF")}}),l=n.define({name:"_tel",namespace:d,element:"TEL",fields:{number:n.subText(d,"NUMBER"),home:n.boolSub(d,"HOME"),work:n.boolSub(d,"WORK"),mobile:n.boolSub(d,"CELL"),preferred:n.boolSub(d,"PREF")}}),u=n.define({name:"_address",namespace:d,element:"ADR",fields:{street:n.subText(d,"STREET"),street2:n.subText(d,"EXTADD"),country:n.subText(d,"CTRY"),city:n.subText(d,"LOCALITY"),region:n.subText(d,"REGION"),postalCode:n.subText(d,"PCODE"),pobox:n.subText(d,"POBOX"),home:n.boolSub(d,"HOME"),work:n.boolSub(d,"WORK"),preferred:n.boolSub(d,"PREF")}}),p=n.define({name:"organization",namespace:d,element:"ORG",fields:{name:n.subText(d,"ORGNAME"),unit:n.subText(d,"ORGUNIT")}}),s=n.define({name:"name",namespace:d,element:"N",fields:{family:n.subText(d,"FAMILY"),given:n.subText(d,"GIVEN"),middle:n.subText(d,"MIDDLE"),prefix:n.subText(d,"PREFIX"),suffix:n.subText(d,"SUFFIX")}}),y=n.define({name:"photo",namespace:d,element:"PHOTO",fields:{type:n.subText(d,"TYPE"),data:n.subText(d,"BINVAL"),url:n.subText(d,"EXTVAL")}});n.extend(i,t,"emails"),n.extend(i,u,"addresses"),n.extend(i,l,"phoneNumbers"),n.extend(i,p),n.extend(i,s),n.extend(i,y),n.extend(o,i)},{"./iq":69,jxt:210}],102:[function(e,f){var n=e("jxt"),o=e("./iq"),d="jabber:iq:version",i=f.exports=n.define({name:"version",namespace:d,element:"query",fields:{name:n.subText(d,"name"),version:n.subText(d,"version"),os:n.subText(d,"os")}});n.extend(o,i)},{"./iq":69,jxt:210}],103:[function(e){var f=e("jxt"),n=e("./iq");f.add(n,"visible",f.boolSub("urn:xmpp:invisible:0","visible")),f.add(n,"invisible",f.boolSub("urn:xmpp:invisible:0","invisible"))},{"./iq":69,jxt:210}],104:[function(e,f){(function(n,o){"use strict";function d(){}function i(e,f,n,o){o=o||0;var t=s(e).cancellable().timeout(1e3*(f||20));return t.spread(function(e,f){if(e.statusCode<200||e.statusCode>=400)throw new d("HTTP Status Error");return f}).catch(p.TimeoutError,function(){throw new d("Dead Connection, exceeded timeout limit")}).catch(p.CancellationError,function(){}).catch(function(){if(n>o)return p.delay(100).then(function(){return i(e,f,n,o+1)});throw new d("Dead Connection, exceeded retry limit")})}function t(e){var f=this;y.call(this),f.sm=e,f.sendQueue=[],f.requests=[],f.maxRequests=2,f.sid="",f.on("raw:incoming",function(e){if(e=e.trim(),""!==e){var n,o;try{n=c.parse(e,a)}catch(d){return o=new r({condition:"invalid-xml"}),f.emit("stream:error",o,d),f.send(o),f.disconnect()}f.hasStream||(f.hasStream=!0,f.stream={id:n.sid,lang:n.lang||"en",version:n.version||"1.0",to:n.to,from:n.from},f.sid=n.sid,f.maxRequests=n.requests);var i=n.payload;i.forEach(function(e){e.lang||(e.lang=f.stream.lang),f.emit("stream:data",e)}),"terminate"===n.type&&(f.rid=void 0,f.sid=void 0,f.emit("bosh:terminate",n),f.emit("stream:end"),f.emit("disconnected",f))}})}var l=e("underscore"),u=e("util"),p=e("bluebird"),s=p.promisify(e("request")),y=e("wildemitter"),c=e("jxt"),a=e("../stanza/bosh"),r=e("../stanza/streamError");u.inherits(d,Error),u.inherits(t,y),t.prototype.connect=function(e){var f=this;f.config=l.extend({rid:Math.ceil(9999999999*Math.random()),wait:30,maxRetries:5},e),f.hasStream=!1,f.sm.started=!1,f.url=e.boshURL,f.rid=f.config.rid,f.requests=[],f.rid++,f.request(new a({version:f.config.version||"1.0",to:f.config.server,lang:f.config.lang||"en",wait:f.config.wait,ver:"1.6",hold:1}))
},t.prototype.disconnect=function(){this.hasStream?(this.rid++,this.request(new a({type:"terminate"}))):(this.requests.forEach(function(e){e.request.cancel()}),this.stream=void 0,this.sid=void 0,this.rid=void 0,this.emit("disconnected",this))},t.prototype.restart=function(){var e=this;e.rid++,e.request(new a({to:e.config.server,lang:e.config.lang||"en",restart:"true"}))},t.prototype.send=function(e){var f=this;f.hasStream&&(f.sendQueue.push(e),n.nextTick(f.longPoll.bind(f)))},t.prototype.longPoll=function(){var e=0===this.requests.length,f=this.sendQueue.length>0&&this.requests.length<this.maxRequests;if(this.sid&&(e||f)){var n=this.sendQueue;this.sendQueue=[],this.rid++,this.request(new a({payload:n}))}},t.prototype.request=function(e){var f=this,t={id:f.rid,request:null};e.rid=f.rid,e.sid=f.sid;var u=new o(e.toString(),"utf8").toString();f.emit("raw:outgoing",u),f.requests.push(t);var p=i({uri:f.url,body:u,method:"POST",strictSSL:!0},1.5*f.config.wait,this.config.maxRetries);return t.request=p,p.then(function(e){f.emit("raw:incoming",new o(e,"utf8").toString())}).catch(d,function(e){f.hasStream=!1;var n=new r({condition:"connection-timeout"});f.emit("stream:error",n,e),f.disconnect()}).catch(function(e){var n=new r({condition:"undefined-condition"});f.emit("stream:error",n,e),f.send(n),f.disconnect()}).finally(function(){f.requests=l.filter(f.requests,function(e){return e.id!==t.id}),"terminate"!==e.type&&n.nextTick(function(){n.nextTick(f.longPoll.bind(f))})})},f.exports=t}).call(this,e("FWaASH"),e("buffer").Buffer)},{"../stanza/bosh":52,"../stanza/streamError":98,FWaASH:166,bluebird:112,buffer:147,jxt:210,request:145,underscore:234,util:169,wildemitter:235}],105:[function(e,f){"use strict";function n(e){function f(e){return[n.streamStart,e,n.streamEnd].join("")}o.call(this,e);var n=this;n.on("connected",function(){n.streamStart='<stream:stream xmlns:stream="http://etherx.jabber.org/streams">',n.streamEnd="</stream:stream>"}),n.off("raw:incoming"),n.on("raw:incoming",function(e){var o,i,p;if(e=e.trim(),e=e.replace(/^(\s*<\?.*\?>\s*)*/,""),""!==e){if(e.match(n.streamEnd))return n.disconnect();if(n.hasStream)try{o=t.parse(f(e),l)}catch(s){return p=new u({condition:"invalid-xml"}),n.emit("stream:error",p,s),n.send(p),n.disconnect()}else{var y=e.match(/^<(\S+:)?(\S+) /);n.streamStart=e,n.streamEnd="</"+(y[1]||"")+y[2]+">",i=!1;try{o=t.parse(e+n.streamEnd,l)}catch(s){try{o=t.parse(e,l),i=!0}catch(c){return p=new u({condition:"invalid-xml"}),n.emit("stream:error",p,c),n.send(p),n.disconnect()}}n.hasStream=!0,n.stream=o,n.emit("stream:start",o)}d.each(o._extensions,function(e){e.lang||(e.lang=n.stream.lang),n.emit("stream:data",e)}),i&&n.emit("stream:end")}})}var o=e("./websocket"),d=e("underscore"),i=e("util"),t=e("jxt"),l=e("../stanza/stream"),u=e("../stanza/streamError");i.inherits(n,o),n.prototype.startHeader=function(){return["<stream:stream",'xmlns:stream="http://etherx.jabber.org/streams"','xmlns="jabber:client"','version="'+(this.config.version||"1.0")+'"','xml:lang="'+(this.config.lang||"en")+'"','to="'+this.config.server+'">'].join(" ")},n.prototype.closeHeader=function(){return"</stream:stream>"},f.exports=n},{"../stanza/stream":97,"../stanza/streamError":98,"./websocket":106,jxt:210,underscore:234,util:169}],106:[function(e,f){(function(n){"use strict";function o(e){var f=this;t.call(this),f.sm=e,f.closing=!1,f.sendQueue=l.queue(function(e,o){f.conn&&("string"!=typeof e&&(e=e.toString()),e=new n(e,"utf8").toString(),f.emit("raw:outgoing",e),f.conn.readyState===y&&f.conn.send(e)),o()},1),f.on("connected",function(){f.send(f.startHeader())}),f.on("raw:incoming",function(e){var n,o;if(e=e.trim(),""!==e){try{n=i.parse(e)}catch(d){return o=new p({condition:"invalid-xml"}),f.emit("stream:error",o,d),f.send(o),f.disconnect()}if("openStream"===n._name)return f.hasStream=!0,f.stream=n,f.emit("stream:start",n.toJSON());if("closeStream"===n._name)return f.emit("stream:end"),f.disconnect();n.lang||(n.lang=f.stream.lang),f.emit("stream:data",n)}})}var d=e("util"),i=e("jxt"),t=e("wildemitter"),l=e("async"),u=e("../stanza/framing"),p=e("../stanza/streamError"),s=e("faye-websocket")&&e("faye-websocket").Client?e("faye-websocket").Client:window.WebSocket,y=1;d.inherits(o,t),o.prototype.connect=function(e){var f=this;f.config=e,f.hasStream=!1,f.closing=!1,f.conn=new s(e.wsURL,"xmpp"),f.conn.onerror=function(e){e.preventDefault(),f.emit("disconnected",f)},f.conn.onclose=function(){f.emit("disconnected",f)},f.conn.onopen=function(){f.sm.started=!1,f.emit("connected",f)},f.conn.onmessage=function(e){f.emit("raw:incoming",new n(e.data,"utf8").toString())}},o.prototype.startHeader=function(){return new u.Open({version:this.config.version||"1.0",lang:this.config.lang||"en",to:this.config.server})},o.prototype.closeHeader=function(){return new u.Close},o.prototype.disconnect=function(){this.conn&&!this.closing?(this.closing=!0,this.send(this.closeHeader())):(this.hasStream=!1,this.stream=void 0,this.conn.readyState===y&&this.conn.close(),this.conn=void 0)},o.prototype.restart=function(){var e=this;e.hasStream=!1,e.send(this.startHeader())},o.prototype.send=function(e){this.sendQueue.push(e)},f.exports=o}).call(this,e("buffer").Buffer)},{"../stanza/framing":64,"../stanza/streamError":98,async:108,buffer:147,"faye-websocket":146,jxt:210,util:169,wildemitter:235}],107:[function(e,f){function n(e){for(var f={},n=e.split(/,(?=(?:[^"]|"[^"]*")*$)/),o=0,d=n.length;d>o;o++){var i=/(\w+)=["]?([^"]+)["]?$/.exec(n[o]);i&&(f[i[1]]=i[2])}return f}function o(){return i.randomBytes(16).toString("hex")}function d(e){e=e||{},this._genNonce=e.genNonce||o}var i=e("crypto");d.Mechanism=d,d.prototype.name="DIGEST-MD5",d.prototype.clientFirst=!1,d.prototype.response=function(e){if(this._completed)return void 0;var f=e.serviceType+"/"+e.host;e.serviceName&&e.host!==e.serviceName&&(f+="/"+e.serviceName);var n=e.realm||this._realm||"",o=this._genNonce(),d="00000001",t="auth",l="";l+='username="'+e.username+'"',n&&(l+=',realm="'+n+'"'),l+=',nonce="'+this._nonce+'"',l+=',cnonce="'+o+'"',l+=",nc="+d,l+=",qop="+t,l+=',digest-uri="'+f+'"';var u=i.createHash("md5").update(e.username).update(":").update(n).update(":").update(e.password).digest(),p=i.createHash("md5").update(u).update(":").update(this._nonce).update(":").update(o);e.authzid&&p.update(":").update(e.authzid),p=p.digest("hex");var s=i.createHash("md5").update("AUTHENTICATE:").update(f);("auth-int"===t||"auth-conf"===t)&&s.update(":00000000000000000000000000000000"),s=s.digest("hex");var y=i.createHash("md5").update(p).update(":").update(this._nonce).update(":").update(d).update(":").update(o).update(":").update(t).update(":").update(s).digest("hex");return l+=",response="+y,"utf-8"===this._charset&&(l+=",charset=utf-8"),e.authzid&&(l+='authzid="'+e.authzid+'"'),l},d.prototype.challenge=function(e){var f=n(e);return this._completed=!!f.rspauth,this._realm=f.realm,this._nonce=f.nonce,this._qop=(f.qop||"auth").split(","),this._stale=f.stale,this._maxbuf=parseInt(f.maxbuf)||65536,this._charset=f.charset,this._algo=f.algorithm,this._cipher=f.cipher,this._cipher&&this._cipher.split(","),this},f.exports=d},{crypto:154}],108:[function(f,n){(function(f){!function(){function o(e){var f=!1;return function(){if(f)throw new Error("Callback was already called.");f=!0,e.apply(d,arguments)}}var d,i,t={};d=this,null!=d&&(i=d.async),t.noConflict=function(){return d.async=i,t};var l=Object.prototype.toString,u=Array.isArray||function(e){return"[object Array]"===l.call(e)},p=function(e,f){if(e.forEach)return e.forEach(f);for(var n=0;n<e.length;n+=1)f(e[n],n,e)},s=function(e,f){if(e.map)return e.map(f);var n=[];return p(e,function(e,o,d){n.push(f(e,o,d))}),n},y=function(e,f,n){return e.reduce?e.reduce(f,n):(p(e,function(e,o,d){n=f(n,e,o,d)}),n)},c=function(e){if(Object.keys)return Object.keys(e);var f=[];for(var n in e)e.hasOwnProperty(n)&&f.push(n);return f};"undefined"!=typeof f&&f.nextTick?(t.nextTick=f.nextTick,t.setImmediate="undefined"!=typeof setImmediate?function(e){setImmediate(e)}:t.nextTick):"function"==typeof setImmediate?(t.nextTick=function(e){setImmediate(e)},t.setImmediate=t.nextTick):(t.nextTick=function(e){setTimeout(e,0)},t.setImmediate=t.nextTick),t.each=function(e,f,n){function d(f){f?(n(f),n=function(){}):(i+=1,i>=e.length&&n())}if(n=n||function(){},!e.length)return n();var i=0;p(e,function(e){f(e,o(d))})},t.forEach=t.each,t.eachSeries=function(e,f,n){if(n=n||function(){},!e.length)return n();var o=0,d=function(){f(e[o],function(f){f?(n(f),n=function(){}):(o+=1,o>=e.length?n():d())})};d()},t.forEachSeries=t.eachSeries,t.eachLimit=function(e,f,n,o){var d=a(f);d.apply(null,[e,n,o])},t.forEachLimit=t.eachLimit;var a=function(e){return function(f,n,o){if(o=o||function(){},!f.length||0>=e)return o();var d=0,i=0,t=0;!function l(){if(d>=f.length)return o();for(;e>t&&i<f.length;)i+=1,t+=1,n(f[i-1],function(e){e?(o(e),o=function(){}):(d+=1,t-=1,d>=f.length?o():l())})}()}},r=function(e){return function(){var f=Array.prototype.slice.call(arguments);return e.apply(null,[t.each].concat(f))}},w=function(e,f){return function(){var n=Array.prototype.slice.call(arguments);return f.apply(null,[a(e)].concat(n))}},b=function(e){return function(){var f=Array.prototype.slice.call(arguments);return e.apply(null,[t.eachSeries].concat(f))}},m=function(e,f,n,o){if(f=s(f,function(e,f){return{index:f,value:e}}),o){var d=[];e(f,function(e,f){n(e.value,function(n,o){d[e.index]=o,f(n)})},function(e){o(e,d)})}else e(f,function(e,f){n(e.value,function(e){f(e)})})};t.map=r(m),t.mapSeries=b(m),t.mapLimit=function(e,f,n,o){return g(f)(e,n,o)};var g=function(e){return w(e,m)};t.reduce=function(e,f,n,o){t.eachSeries(e,function(e,o){n(f,e,function(e,n){f=n,o(e)})},function(e){o(e,f)})},t.inject=t.reduce,t.foldl=t.reduce,t.reduceRight=function(e,f,n,o){var d=s(e,function(e){return e}).reverse();t.reduce(d,f,n,o)},t.foldr=t.reduceRight;var x=function(e,f,n,o){var d=[];f=s(f,function(e,f){return{index:f,value:e}}),e(f,function(e,f){n(e.value,function(n){n&&d.push(e),f()})},function(){o(s(d.sort(function(e,f){return e.index-f.index}),function(e){return e.value}))})};t.filter=r(x),t.filterSeries=b(x),t.select=t.filter,t.selectSeries=t.filterSeries;var P=function(e,f,n,o){var d=[];f=s(f,function(e,f){return{index:f,value:e}}),e(f,function(e,f){n(e.value,function(n){n||d.push(e),f()})},function(){o(s(d.sort(function(e,f){return e.index-f.index}),function(e){return e.value}))})};t.reject=r(P),t.rejectSeries=b(P);var j=function(e,f,n,o){e(f,function(e,f){n(e,function(n){n?(o(e),o=function(){}):f()})},function(){o()})};t.detect=r(j),t.detectSeries=b(j),t.some=function(e,f,n){t.each(e,function(e,o){f(e,function(e){e&&(n(!0),n=function(){}),o()})},function(){n(!1)})},t.any=t.some,t.every=function(e,f,n){t.each(e,function(e,o){f(e,function(e){e||(n(!1),n=function(){}),o()})},function(){n(!0)})},t.all=t.every,t.sortBy=function(e,f,n){t.map(e,function(e,n){f(e,function(f,o){f?n(f):n(null,{value:e,criteria:o})})},function(e,f){if(e)return n(e);var o=function(e,f){var n=e.criteria,o=f.criteria;return o>n?-1:n>o?1:0};n(null,s(f.sort(o),function(e){return e.value}))})},t.auto=function(e,f){f=f||function(){};var n=c(e),o=n.length;if(!o)return f();var d={},i=[],l=function(e){i.unshift(e)},s=function(e){for(var f=0;f<i.length;f+=1)if(i[f]===e)return void i.splice(f,1)},a=function(){o--,p(i.slice(0),function(e){e()})};l(function(){if(!o){var e=f;f=function(){},e(null,d)}}),p(n,function(n){var o=u(e[n])?e[n]:[e[n]],i=function(e){var o=Array.prototype.slice.call(arguments,1);if(o.length<=1&&(o=o[0]),e){var i={};p(c(d),function(e){i[e]=d[e]}),i[n]=o,f(e,i),f=function(){}}else d[n]=o,t.setImmediate(a)},r=o.slice(0,Math.abs(o.length-1))||[],w=function(){return y(r,function(e,f){return e&&d.hasOwnProperty(f)},!0)&&!d.hasOwnProperty(n)};if(w())o[o.length-1](i,d);else{var b=function(){w()&&(s(b),o[o.length-1](i,d))};l(b)}})},t.retry=function(e,f,n){var o=5,d=[];"function"==typeof e&&(n=f,f=e,e=o),e=parseInt(e,10)||o;var i=function(o,i){for(var l=function(e,f){return function(n){e(function(e,o){n(!e||f,{err:e,result:o})},i)}};e;)d.push(l(f,!(e-=1)));t.series(d,function(e,f){f=f[f.length-1],(o||n)(f.err,f.result)})};return n?i():i},t.waterfall=function(e,f){if(f=f||function(){},!u(e)){var n=new Error("First argument to waterfall must be an array of functions");return f(n)}if(!e.length)return f();var o=function(e){return function(n){if(n)f.apply(null,arguments),f=function(){};else{var d=Array.prototype.slice.call(arguments,1),i=e.next();d.push(i?o(i):f),t.setImmediate(function(){e.apply(null,d)})}}};o(t.iterator(e))()};var v=function(e,f,n){if(n=n||function(){},u(f))e.map(f,function(e,f){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),f.call(null,e,n)})},n);else{var o={};e.each(c(f),function(e,n){f[e](function(f){var d=Array.prototype.slice.call(arguments,1);d.length<=1&&(d=d[0]),o[e]=d,n(f)})},function(e){n(e,o)})}};t.parallel=function(e,f){v({map:t.map,each:t.each},e,f)},t.parallelLimit=function(e,f,n){v({map:g(f),each:a(f)},e,n)},t.series=function(e,f){if(f=f||function(){},u(e))t.mapSeries(e,function(e,f){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),f.call(null,e,n)})},f);else{var n={};t.eachSeries(c(e),function(f,o){e[f](function(e){var d=Array.prototype.slice.call(arguments,1);d.length<=1&&(d=d[0]),n[f]=d,o(e)})},function(e){f(e,n)})}},t.iterator=function(e){var f=function(n){var o=function(){return e.length&&e[n].apply(null,arguments),o.next()};return o.next=function(){return n<e.length-1?f(n+1):null},o};return f(0)},t.apply=function(e){var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,f.concat(Array.prototype.slice.call(arguments)))}};var M=function(e,f,n,o){var d=[];e(f,function(e,f){n(e,function(e,n){d=d.concat(n||[]),f(e)})},function(e){o(e,d)})};t.concat=r(M),t.concatSeries=b(M),t.whilst=function(e,f,n){e()?f(function(o){return o?n(o):void t.whilst(e,f,n)}):n()},t.doWhilst=function(e,f,n){e(function(o){if(o)return n(o);var d=Array.prototype.slice.call(arguments,1);f.apply(null,d)?t.doWhilst(e,f,n):n()})},t.until=function(e,f,n){e()?n():f(function(o){return o?n(o):void t.until(e,f,n)})},t.doUntil=function(e,f,n){e(function(o){if(o)return n(o);var d=Array.prototype.slice.call(arguments,1);f.apply(null,d)?n():t.doUntil(e,f,n)})},t.queue=function(e,f){function n(e,f,n,o){return e.started||(e.started=!0),u(f)||(f=[f]),0==f.length?t.setImmediate(function(){e.drain&&e.drain()}):void p(f,function(f){var d={data:f,callback:"function"==typeof o?o:null};n?e.tasks.unshift(d):e.tasks.push(d),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),t.setImmediate(e.process)})}void 0===f&&(f=1);var d=0,i={tasks:[],concurrency:f,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,f){n(i,e,!1,f)},kill:function(){i.drain=null,i.tasks=[]},unshift:function(e,f){n(i,e,!0,f)},process:function(){if(!i.paused&&d<i.concurrency&&i.tasks.length){var f=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),d+=1;var n=function(){d-=1,f.callback&&f.callback.apply(f,arguments),i.drain&&i.tasks.length+d===0&&i.drain(),i.process()},t=o(n);e(f.data,t)}},length:function(){return i.tasks.length},running:function(){return d},idle:function(){return i.tasks.length+d===0},pause:function(){i.paused!==!0&&(i.paused=!0,i.process())},resume:function(){i.paused!==!1&&(i.paused=!1,i.process())}};return i},t.priorityQueue=function(e,f){function n(e,f){return e.priority-f.priority}function o(e,f,n){for(var o=-1,d=e.length-1;d>o;){var i=o+(d-o+1>>>1);n(f,e[i])>=0?o=i:d=i-1}return o}function d(e,f,d,i){return e.started||(e.started=!0),u(f)||(f=[f]),0==f.length?t.setImmediate(function(){e.drain&&e.drain()}):void p(f,function(f){var l={data:f,priority:d,callback:"function"==typeof i?i:null};e.tasks.splice(o(e.tasks,l,n)+1,0,l),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),t.setImmediate(e.process)})}var i=t.queue(e,f);return i.push=function(e,f,n){d(i,e,f,n)},delete i.unshift,i},t.cargo=function(e,f){var n=!1,o=[],d={tasks:o,payload:f,saturated:null,empty:null,drain:null,drained:!0,push:function(e,n){u(e)||(e=[e]),p(e,function(e){o.push({data:e,callback:"function"==typeof n?n:null}),d.drained=!1,d.saturated&&o.length===f&&d.saturated()}),t.setImmediate(d.process)},process:function i(){if(!n){if(0===o.length)return d.drain&&!d.drained&&d.drain(),void(d.drained=!0);var t="number"==typeof f?o.splice(0,f):o.splice(0,o.length),l=s(t,function(e){return e.data});d.empty&&d.empty(),n=!0,e(l,function(){n=!1;var e=arguments;p(t,function(f){f.callback&&f.callback.apply(null,e)}),i()})}},length:function(){return o.length},running:function(){return n}};return d};var X=function(e){return function(f){var n=Array.prototype.slice.call(arguments,1);f.apply(null,n.concat([function(f){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(f?console.error&&console.error(f):console[e]&&p(n,function(f){console[e](f)}))}]))}};t.log=X("log"),t.dir=X("dir"),t.memoize=function(e,f){var n={},o={};f=f||function(e){return e};var d=function(){var d=Array.prototype.slice.call(arguments),i=d.pop(),l=f.apply(null,d);l in n?t.nextTick(function(){i.apply(null,n[l])}):l in o?o[l].push(i):(o[l]=[i],e.apply(null,d.concat([function(){n[l]=arguments;var e=o[l];delete o[l];for(var f=0,d=e.length;d>f;f++)e[f].apply(null,arguments)}])))};return d.memo=n,d.unmemoized=e,d},t.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},t.times=function(e,f,n){for(var o=[],d=0;e>d;d++)o.push(d);return t.map(o,f,n)},t.timesSeries=function(e,f,n){for(var o=[],d=0;e>d;d++)o.push(d);return t.mapSeries(o,f,n)},t.seq=function(){var e=arguments;return function(){var f=this,n=Array.prototype.slice.call(arguments),o=n.pop();t.reduce(e,n,function(e,n,o){n.apply(f,e.concat([function(){var e=arguments[0],f=Array.prototype.slice.call(arguments,1);o(e,f)}]))},function(e,n){o.apply(f,[e].concat(n))})}},t.compose=function(){return t.seq.apply(null,Array.prototype.reverse.call(arguments))};var h=function(e,f){var n=function(){var n=this,o=Array.prototype.slice.call(arguments),d=o.pop();return e(f,function(e,f){e.apply(n,o.concat([f]))},d)};if(arguments.length>2){var o=Array.prototype.slice.call(arguments,2);return n.apply(this,o)}return n};t.applyEach=r(h),t.applyEachSeries=b(h),t.forever=function(e,f){function n(o){if(o){if(f)return f(o);throw o}e(n)}n()},"undefined"!=typeof n&&n.exports?n.exports=t:"undefined"!=typeof e&&e.amd?e([],function(){return t}):d.async=t}()}).call(this,f("FWaASH"))},{FWaASH:166}],109:[function(e,f){(function(e){!function(){"use strict";function n(f){return new e(f,"base64").toString("binary")}f.exports=n}()}).call(this,e("buffer").Buffer)},{buffer:147}],110:[function(e,f){"use strict";f.exports=function(e){function f(e){var f=new n(e),o=f.promise();return o.isRejected()?o:(f.setHowMany(1),f.setUnwrap(),f.init(),o)}var n=e._SomePromiseArray;e.any=function(e){return f(e)},e.prototype.any=function(){return f(this)}}},{}],111:[function(e,f){(function(n){"use strict";function o(){this._isTickUsed=!1,this._schedule=d,this._length=0,this._lateBuffer=new i(16),this._functionBuffer=new i(65536);var e=this;this.consumeFunctionBuffer=function(){e._consumeFunctionBuffer()}}var d=e("./schedule.js"),i=e("./queue.js"),t=e("./util.js").errorObj,l=e("./util.js").tryCatch1,u="undefined"!=typeof n?n:void 0;o.prototype.haveItemsQueued=function(){return this._length>0},o.prototype.invokeLater=function(e,f,n){void 0===u||null==u.domain||e.domain||(e=u.domain.bind(e)),this._lateBuffer.push(e,f,n),this._queueTick()},o.prototype.invoke=function(e,f,n){void 0===u||null==u.domain||e.domain||(e=u.domain.bind(e));var o=this._functionBuffer;o.push(e,f,n),this._length=o.length(),this._queueTick()},o.prototype._consumeFunctionBuffer=function(){for(var e=this._functionBuffer;e.length()>0;){var f=e.shift(),n=e.shift(),o=e.shift();f.call(n,o)}this._reset(),this._consumeLateBuffer()},o.prototype._consumeLateBuffer=function(){for(var e=this._lateBuffer;e.length()>0;){var f=e.shift(),n=e.shift(),o=e.shift(),d=l(f,n,o);if(d===t){if(this._queueTick(),null==f.domain)throw d.e;f.domain.emit("error",d.e)}}},o.prototype._queueTick=function(){this._isTickUsed||(this._schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},o.prototype._reset=function(){this._isTickUsed=!1,this._length=0},f.exports=new o}).call(this,e("FWaASH"))},{"./queue.js":134,"./schedule.js":137,"./util.js":144,FWaASH:166}],112:[function(e,f){"use strict";var n=e("./promise.js")();f.exports=n},{"./promise.js":129}],113:[function(e,f){"use strict";var n=Object.create;if(n){var o=n(null),d=n(null);o[" size"]=d[" size"]=0}f.exports=function(f){function n(e){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,e))}function i(e){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",e))}function t(e,f,n){var o=n[e];if("function"!=typeof o){if(!r(e))return null;if(o=f(e),n[e]=o,n[" size"]++,n[" size"]>512){for(var d=Object.keys(n),i=0;256>i;++i)delete n[d[i]];n[" size"]=d.length-256}}return o}function l(e){return t(e,n,o)}function u(e){return t(e,i,d)}function p(e){return e[this.pop()].apply(e,this)}function s(e){return e[this]}function y(e){return e[this]}var c=e("./util.js"),a=c.canEvaluate,r=c.isIdentifier;f.prototype.call=function(e){for(var f=arguments.length,n=new Array(f-1),o=1;f>o;++o)n[o-1]=arguments[o];if(a){var d=l(e);if(null!==d)return this._then(d,void 0,void 0,n,void 0)}return n.push(e),this._then(p,void 0,void 0,n,void 0)},f.prototype.get=function(e){var f,n="number"==typeof e;if(n)f=y;else if(a){var o=u(e);f=null!==o?o:s}else f=s;return this._then(f,void 0,void 0,e,void 0)}}},{"./util.js":144}],114:[function(e,f){"use strict";f.exports=function(f,n){var o=e("./errors.js"),d=o.canAttach,i=e("./async.js"),t=o.CancellationError;f.prototype._cancel=function(e){if(!this.isCancellable())return this;for(var f,n=this;void 0!==(f=n._cancellationParent)&&f.isCancellable();)n=f;n._attachExtraTrace(e),n._rejectUnchecked(e)},f.prototype.cancel=function(e){return this.isCancellable()?(e=void 0!==e?d(e)?e:new Error(e+""):new t,i.invokeLater(this._cancel,this,e),this):this},f.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},f.prototype.uncancellable=function(){var e=new f(n);return e._propagateFrom(this,6),e._follow(this),e._unsetCancellable(),e},f.prototype.fork=function(e,f,n){var o=this._then(e,f,n,void 0,void 0);return o._setCancellable(),o._cancellationParent=void 0,o}}},{"./async.js":111,"./errors.js":119}],115:[function(e,f){"use strict";f.exports=function(){function f(e){var f;if("function"==typeof e)f="[function "+(e.name||"anonymous")+"]";else{f=e.toString();var o=/\[object [a-zA-Z0-9$_]+\]/;if(o.test(f))try{var d=JSON.stringify(e);f=d}catch(i){}0===f.length&&(f="(empty array)")}return"(<"+n(f)+">, no stack trace)"}function n(e){var f=41;return e.length<f?e:e.substr(0,f-3)+"..."}function o(e,f){this.captureStackTrace(o,f)}var d=e("./util.js").inherits,i=e("./es5.js").defineProperty,t=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|3|4|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),l=null,u=null;d(o,Error),o.prototype.captureStackTrace=function(e,f){p(this,e,f)},o.possiblyUnhandledRejection=function(e){if("object"==typeof console){var f;if("object"==typeof e||"function"==typeof e){var n=e.stack;f="Possibly unhandled "+u(n,e)}else f="Possibly unhandled "+String(e);"function"==typeof console.error||"object"==typeof console.error?console.error(f):("function"==typeof console.log||"object"==typeof console.log)&&console.log(f)}},o.combine=function(e,f){for(var n=e.length-1,o=f.length-1;o>=0;--o){var d=f[o];if(e[n]!==d)break;e.pop(),n--}e.push("From previous event:");for(var i=e.concat(f),u=[],o=0,p=i.length;p>o;++o)t.test(i[o])&&l.test(i[o])||o>0&&!l.test(i[o])&&"From previous event:"!==i[o]||u.push(i[o]);return u},o.protectErrorMessageNewlines=function(e){for(var f=0;f<e.length&&!l.test(e[f]);++f);if(!(1>=f)){for(var n=[],o=0;f>o;++o)n.push(e.shift());e.unshift(n.join("\x00"))}},o.isSupported=function(){return"function"==typeof p};var p=function s(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){l=/^\s*at\s*/,u=function(e,n){return"string"==typeof e?e:void 0!==n.name&&void 0!==n.message?n.name+". "+n.message:f(n)};var e=Error.captureStackTrace;return function(f,n){e(f,n)}}var n=new Error;if("string"==typeof n.stack&&"function"==typeof"".startsWith&&n.stack.startsWith("stackDetection@")&&"stackDetection"===s.name){i(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),l=/@/;var o=/[@\n]/;return u=function(e,n){return"string"==typeof e?n.name+". "+n.message+"\n"+e:void 0!==n.name&&void 0!==n.message?n.name+". "+n.message:f(n)},function(e){for(var f=(new Error).stack,n=f.split(o),d=n.length,i="",t=0;d>t;t+=2)i+=n[t],i+="@",i+=n[t+1],i+="\n";e.stack=i}}return u=function(e,n){return"string"==typeof e?e:"object"!=typeof n&&"function"!=typeof n||void 0===n.name||void 0===n.message?f(n):n.name+". "+n.message},null}();return o}},{"./es5.js":121,"./util.js":144}],116:[function(e,f){"use strict";f.exports=function(f){function n(e,f,n){this._instances=e,this._callback=f,this._promise=n}function o(e,f){var n={},o=t(e,n,f);if(o===l)return o;var d=u(n);return d.length?(l.e=new p("Catch filter must inherit from Error or be a simple predicate function"),l):o}var d=e("./util.js"),i=e("./errors.js"),t=d.tryCatch1,l=d.errorObj,u=e("./es5.js").keys,p=i.TypeError;return n.prototype.doFilter=function(e){for(var n=this._callback,d=this._promise,u=d._boundTo,p=0,s=this._instances.length;s>p;++p){var y=this._instances[p],c=y===Error||null!=y&&y.prototype instanceof Error;if(c&&e instanceof y){var a=t(n,u,e);return a===l?(f.e=a.e,f):a}if("function"==typeof y&&!c){var r=o(y,e);if(r===l){var w=i.canAttach(l.e)?l.e:new Error(l.e+"");this._promise._attachExtraTrace(w),e=l.e;break}if(r){var a=t(n,u,e);return a===l?(f.e=a.e,f):a}}}return f.e=e,f},n}},{"./errors.js":119,"./es5.js":121,"./util.js":144}],117:[function(e,f){"use strict";var n=e("./util.js"),o=n.isPrimitive,d=n.wrapsPrimitiveReceiver;f.exports=function(e){var f=function(){return this},n=function(){throw this},i=function(e,f){return 1===f?function(){throw e}:2===f?function(){return e}:void 0};e.prototype["return"]=e.prototype.thenReturn=function(e){return d&&o(e)?this._then(i(e,2),void 0,void 0,void 0,void 0):this._then(f,void 0,void 0,e,void 0)},e.prototype["throw"]=e.prototype.thenThrow=function(e){return d&&o(e)?this._then(i(e,1),void 0,void 0,void 0,void 0):this._then(n,void 0,void 0,e,void 0)}}},{"./util.js":144}],118:[function(e,f){"use strict";f.exports=function(e,f){var n=e.reduce;e.prototype.each=function(e){return n(this,e,null,f)},e.each=function(e,o){return n(e,o,null,f)}}},{}],119:[function(e,f){"use strict";function n(e){try{a(e,"isOperational",!0)}catch(f){}}function o(e){return null==e?!1:e instanceof l||e.isOperational===!0}function d(e){return e instanceof Error}function i(e){return d(e)}function t(e,f){function n(o){return this instanceof n?(this.message="string"==typeof o?o:f,this.name=e,void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new n(o)}return c(n,Error),n}function l(e){this.name="OperationalError",this.message=e,this.cause=e,this.isOperational=!0,e instanceof Error?(this.message=e.message,this.stack=e.stack):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var u,p,s=e("./es5.js").freeze,y=e("./util.js"),c=y.inherits,a=y.notEnumerableProp,r=t("CancellationError","cancellation error"),w=t("TimeoutError","timeout error"),b=t("AggregateError","aggregate error");try{u=TypeError,p=RangeError}catch(m){u=t("TypeError","type error"),p=t("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),x=0;x<g.length;++x)"function"==typeof Array.prototype[g[x]]&&(b.prototype[g[x]]=Array.prototype[g[x]]);b.prototype.length=0,b.prototype.isOperational=!0;var P=0;b.prototype.toString=function(){var e=Array(4*P+1).join(" "),f="\n"+e+"AggregateError of:\n";P++,e=Array(4*P+1).join(" ");for(var n=0;n<this.length;++n){for(var o=this[n]===this?"[Circular AggregateError]":this[n]+"",d=o.split("\n"),i=0;i<d.length;++i)d[i]=e+d[i];o=d.join("\n"),f+=o+"\n"}return P--,f},c(l,Error);var j="__BluebirdErrorTypes__",v=Error[j];v||(v=s({CancellationError:r,TimeoutError:w,OperationalError:l,RejectionError:l,AggregateError:b}),a(Error,j,v)),f.exports={Error:Error,TypeError:u,RangeError:p,CancellationError:v.CancellationError,OperationalError:v.OperationalError,TimeoutError:v.TimeoutError,AggregateError:v.AggregateError,originatesFromRejection:o,markAsOriginatingFromRejection:n,canAttach:i}},{"./es5.js":121,"./util.js":144}],120:[function(e,f){"use strict";f.exports=function(f){function n(e){var n=new o(e),d=f.rejected(n),i=d._peekContext();return null!=i&&i._attachExtraTrace(n),d}var o=e("./errors.js").TypeError;return n}},{"./errors.js":119}],121:[function(e,f){var n=function(){"use strict";return void 0===this}();if(n)f.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n};else{var o={}.hasOwnProperty,d={}.toString,i={}.constructor.prototype,t=function(e){var f=[];for(var n in e)o.call(e,n)&&f.push(n);return f},l=function(e,f,n){return e[f]=n.value,e},u=function(e){return e},p=function(e){try{return Object(e).constructor.prototype}catch(f){return i}},s=function(e){try{return"[object Array]"===d.call(e)}catch(f){return!1}};f.exports={isArray:s,keys:t,defineProperty:l,freeze:u,getPrototypeOf:p,isES5:n}}},{}],122:[function(e,f){"use strict";f.exports=function(e,f){var n=e.map;e.prototype.filter=function(e,o){return n(this,e,o,f)},e.filter=function(e,o,d){return n(e,o,d,f)}}},{}],123:[function(e,f){"use strict";f.exports=function(f,n,o){function d(){return this}function i(){throw this}function t(e){return function(){return e}}function l(e){return function(){throw e}}function u(e,f,n){var o;return o=c&&a(f)?n?t(f):l(f):n?d:i,e._then(o,r,void 0,f,void 0)}function p(e){var d=this.promise,i=this.handler,t=d._isBound()?i.call(d._boundTo):i();if(void 0!==t){var l=o(t,void 0);if(l instanceof f)return u(l,e,d.isFulfilled())}return d.isRejected()?(n.e=e,n):e}function s(e){var n=this.promise,d=this.handler,i=n._isBound()?d.call(n._boundTo,e):d(e);if(void 0!==i){var t=o(i,void 0);if(t instanceof f)return u(t,e,!0)}return e}var y=e("./util.js"),c=y.wrapsPrimitiveReceiver,a=y.isPrimitive,r=y.thrower;f.prototype._passThroughHandler=function(e,f){if("function"!=typeof e)return this.then();var n={promise:this,handler:e};return this._then(f?p:s,f?p:void 0,void 0,n,void 0)},f.prototype.lastly=f.prototype["finally"]=function(e){return this._passThroughHandler(e,!0)
},f.prototype.tap=function(e){return this._passThroughHandler(e,!1)}}},{"./util.js":144}],124:[function(e,f){"use strict";f.exports=function(f,n,o,d){function i(e,n){for(var o=y,t=f,l=n.length,u=0;l>u;++u){var p=c(n[u],void 0,e);if(p===o)return t.reject(o.e);var s=d(p,i);if(s instanceof t)return s}return null}function t(e,n,d){var i=this._promise=new f(o);i._setTrace(void 0),this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof d?[d].concat(a):a}var l=e("./errors.js"),u=l.TypeError,p=e("./util.js").deprecated,s=e("./util.js"),y=s.errorObj,c=s.tryCatch1,a=[];t.prototype.promise=function(){return this._promise},t.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},t.prototype._continue=function(e){if(e===y){this._generator=void 0;var n=l.canAttach(e.e)?e.e:new Error(e.e+"");return this._promise._attachExtraTrace(n),void this._promise._reject(e.e,n)}var o=e.value;if(e.done===!0)this._generator=void 0,this._promise._tryFollow(o)||this._promise._fulfill(o);else{var t=d(o,void 0);if(!(t instanceof f)&&(t=i(t,this._yieldHandlers),null===t))return void this._throw(new u("A value was yielded that could not be treated as a promise"));t._then(this._next,this._throw,void 0,this,null)}},t.prototype._throw=function(e){l.canAttach(e)&&this._promise._attachExtraTrace(e),this._continue(c(this._generator["throw"],this._generator,e))},t.prototype._next=function(e){this._continue(c(this._generator.next,this._generator,e))},f.coroutine=function(e,f){if("function"!=typeof e)throw new u("generatorFunction must be a function");var n=Object(f).yieldHandler,o=t;return function(){var f=e.apply(this,arguments),d=new o(void 0,void 0,n);return d._generator=f,d._next(void 0),d.promise()}},f.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new u("fn must be a function");a.push(e)},f.spawn=function(e){if(p("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof e)return n("generatorFunction must be a function");var o=new t(e,this),d=o.promise();return o._run(f.spawn),d}}},{"./errors.js":119,"./util.js":144}],125:[function(e,f){"use strict";f.exports=function(f,n,o,d){var i=e("./util.js"),t=i.canEvaluate,l=i.tryCatch1,u=i.errorObj;if(t){for(var p=function(e){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))},s=function(e){for(var f=[],n=1;e>=n;++n)f.push("holder.p"+n);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,f.join(", ")))},y=[],c=[void 0],a=1;5>=a;++a)y.push(p(a)),c.push(s(a));var r=function(e,f){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=f,this.total=e,this.now=0};r.prototype.callers=c,r.prototype.checkFulfillment=function(e){var f=this.now;f++;var n=this.total;if(f>=n){var o=this.callers[n],d=l(o,void 0,this);d===u?e._rejectUnchecked(d.e):e._tryFollow(d)||e._fulfillUnchecked(d)}else this.now=f}}f.join=function(){var e,i=arguments.length-1;if(i>0&&"function"==typeof arguments[i]&&(e=arguments[i],6>i&&t)){var l=new f(d);l._setTrace(void 0);for(var u=new r(i,e),p=l._reject,s=y,c=0;i>c;++c){var a=o(arguments[c],void 0);a instanceof f?a.isPending()?a._then(s[c],p,void 0,l,u):a.isFulfilled()?s[c].call(l,a._settledValue,u):(l._reject(a._settledValue),a._unsetRejectionIsUnhandled()):s[c].call(l,a,u)}return l}for(var w=arguments.length,b=new Array(w),m=0;w>m;++m)b[m]=arguments[m];var l=new n(b).promise();return void 0!==e?l.spread(e):l}}},{"./util.js":144}],126:[function(e,f){"use strict";f.exports=function(f,n,o,d,i){function t(e,f,n,o){this.constructor$(e),this._callback=f,this._preservedValues=o===i?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=n>=1?[]:c,this._init$(void 0,-2)}function l(e,f,n,o){var d="object"==typeof n&&null!==n?n.concurrency:0;return d="number"==typeof d&&isFinite(d)&&d>=1?d:0,new t(e,f,d,o)}var u=e("./util.js"),p=u.tryCatch3,s=u.errorObj,y={},c=[];u.inherits(t,n),t.prototype._init=function(){},t.prototype._promiseFulfilled=function(e,n){var o=this._values;if(null!==o){var i=this.length(),t=this._preservedValues,l=this._limit;if(o[n]===y){if(o[n]=e,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(l>=1&&this._inFlight>=l)return o[n]=e,void this._queue.push(n);null!==t&&(t[n]=e);var u=this._callback,c=this._promise._boundTo,a=p(u,c,e,n,i);if(a===s)return this._reject(a.e);var r=d(a,void 0);if(r instanceof f){if(r.isPending())return l>=1&&this._inFlight++,o[n]=y,r._proxyPromiseArray(this,n);if(!r.isFulfilled())return r._unsetRejectionIsUnhandled(),this._reject(r.reason());a=r.value()}o[n]=a}var w=++this._totalResolved;w>=i&&(null!==t?this._filter(o,t):this._resolve(o))}},t.prototype._drainQueue=function(){for(var e=this._queue,f=this._limit,n=this._values;e.length>0&&this._inFlight<f;){var o=e.pop();this._promiseFulfilled(n[o],o)}},t.prototype._filter=function(e,f){for(var n=f.length,o=new Array(n),d=0,i=0;n>i;++i)e[i]&&(o[d++]=f[i]);o.length=d,this._resolve(o)},t.prototype.preservedValues=function(){return this._preservedValues},f.prototype.map=function(e,f){return"function"!=typeof e?o("fn must be a function"):l(this,e,f,null).promise()},f.map=function(e,f,n,d){return"function"!=typeof f?o("fn must be a function"):l(e,f,n,d).promise()}}},{"./util.js":144}],127:[function(e,f){"use strict";f.exports=function(f){function n(e){throw e}function o(e,f){if(!t.isArray(e))return d(e,f);var o=t.tryCatchApply(this,[null].concat(e),f);o===s&&l.invokeLater(n,void 0,o.e)}function d(e,f){var o=this,d=void 0===e?p(o,f,null):u(o,f,null,e);d===s&&l.invokeLater(n,void 0,d.e)}function i(e,f){var o=this,d=p(o,f,e);d===s&&l.invokeLater(n,void 0,d.e)}var t=e("./util.js"),l=e("./async.js"),u=t.tryCatch2,p=t.tryCatch1,s=t.errorObj;f.prototype.nodeify=function(e,f){if("function"==typeof e){var n=d;void 0!==f&&Object(f).spread&&(n=o),this._then(n,i,void 0,e,this._boundTo)}return this}}},{"./async.js":111,"./util.js":144}],128:[function(e,f){"use strict";f.exports=function(f,n){var o=e("./util.js"),d=e("./async.js"),i=e("./errors.js"),t=o.tryCatch1,l=o.errorObj;f.prototype.progressed=function(e){return this._then(void 0,void 0,e,void 0,void 0)},f.prototype._progress=function(e){this._isFollowingOrFulfilledOrRejected()||this._progressUnchecked(e)},f.prototype._clearFirstHandlerData$Base=f.prototype._clearFirstHandlerData,f.prototype._clearFirstHandlerData=function(){this._clearFirstHandlerData$Base(),this._progressHandler0=void 0},f.prototype._progressHandlerAt=function(e){return 0===e?this._progressHandler0:this[(e<<2)+e-5+2]},f.prototype._doProgressWith=function(e){var n=e.value,o=e.handler,d=e.promise,u=e.receiver,p=t(o,u,n);if(p===l){if(null!=p.e&&"StopProgressPropagation"!==p.e.name){var s=i.canAttach(p.e)?p.e:new Error(p.e+"");d._attachExtraTrace(s),d._progress(p.e)}}else p instanceof f?p._then(d._progress,null,null,d,void 0):d._progress(p)},f.prototype._progressUnchecked=function(e){if(this.isPending())for(var o=this._length(),i=this._progress,t=0;o>t;t++){var l=this._progressHandlerAt(t),u=this._promiseAt(t);if(u instanceof f)"function"==typeof l?d.invoke(this._doProgressWith,this,{handler:l,promise:u,receiver:this._receiverAt(t),value:e}):d.invoke(i,u,e);else{var p=this._receiverAt(t);"function"==typeof l?l.call(p,e,u):p instanceof f&&p._isProxied()?p._progressUnchecked(e):p instanceof n&&p._promiseProgressed(e,u)}}}}},{"./async.js":111,"./errors.js":119,"./util.js":144}],129:[function(e,f){(function(n){"use strict";function o(e){try{Promise===e&&(Promise=d)}catch(f){}return e}var d;"undefined"!=typeof Promise&&(d=Promise),f.exports=function(){function f(e){if("function"!=typeof e)throw new v("the promise constructor requires a resolver function");if(this.constructor!==f)throw new v("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,e!==u&&this._resolveFromResolver(e)}function d(e){return e[0]}var i=e("./util.js"),t=e("./async.js"),l=e("./errors.js"),u=function(){},p={},s={e:null},y=e("./thenables.js")(f,u),c=e("./promise_array.js")(f,u,y),a=e("./captured_trace.js")(),r=e("./catch_filter.js")(s),w=e("./promise_resolver.js"),b=i.isArray,m=i.errorObj,g=i.tryCatch1,x=i.tryCatch2,P=i.tryCatchApply,j=l.RangeError,v=l.TypeError,M=l.CancellationError,X=l.TimeoutError,h=l.OperationalError,k=l.originatesFromRejection,q=l.markAsOriginatingFromRejection,z=l.canAttach,A=i.thrower,B=e("./errors_api_rejection")(f),C=function(){return new v("circular promise resolution chain")};f.prototype.bind=function(e){var n=y(e,void 0),o=new f(u);if(n instanceof f){var i=n.then(function(e){o._setBoundTo(e)}),t=f.all([this,i]).then(d);o._follow(t)}else o._follow(this),o._setBoundTo(e);return o._propagateFrom(this,3),o},f.prototype.toString=function(){return"[object Promise]"},f.prototype.caught=f.prototype["catch"]=function(e){var n=arguments.length;if(n>1){var o,d=new Array(n-1),i=0;for(o=0;n-1>o;++o){var t=arguments[o];if("function"!=typeof t){var l=new v("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(l),f.reject(l)}d[i++]=t}d.length=i,e=arguments[o],this._resetTrace();var u=new r(d,e,this);return this._then(void 0,u.doFilter,void 0,u,void 0)}return this._then(void 0,e,void 0,void 0,void 0)},f.prototype.then=function(e,f,n){return this._then(e,f,n,void 0,void 0)},f.prototype.done=function(e,f,n){var o=this._then(e,f,n,void 0,void 0);o._setIsFinal()},f.prototype.spread=function(e,f){return this._then(e,f,void 0,p,void 0)},f.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},f.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this._settledValue,e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this._settledValue,e.isRejected=!0),e},f.prototype.all=function(){return new c(this).promise()},f.is=function(e){return e instanceof f},f.all=function(e){return new c(e).promise()},f.prototype.error=function(e){return this.caught(k,e)},f.prototype._resolveFromSyncValue=function(e){if(e===m)this._cleanValues(),this._setRejected(),this._settledValue=e.e,this._ensurePossibleRejectionHandled();else{var n=y(e,void 0);n instanceof f?this._follow(n):(this._cleanValues(),this._setFulfilled(),this._settledValue=e)}},f.method=function(e){if("function"!=typeof e)throw new v("fn must be a function");return function(){var n;switch(arguments.length){case 0:n=g(e,this,void 0);break;case 1:n=g(e,this,arguments[0]);break;case 2:n=x(e,this,arguments[0],arguments[1]);break;default:for(var o=arguments.length,d=new Array(o),i=0;o>i;++i)d[i]=arguments[i];n=P(e,d,this)}var t=new f(u);return t._setTrace(void 0),t._resolveFromSyncValue(n),t}},f.attempt=f["try"]=function(e,n,o){if("function"!=typeof e)return B("fn must be a function");var d=b(n)?P(e,n,o):g(e,o,n),i=new f(u);return i._setTrace(void 0),i._resolveFromSyncValue(d),i},f.defer=f.pending=function(){var e=new f(u);return e._setTrace(void 0),new w(e)},f.bind=function(e){var n=y(e,void 0),o=new f(u);if(o._setTrace(void 0),n instanceof f){var d=n.then(function(e){o._setBoundTo(e)});o._follow(d)}else o._setBoundTo(e),o._setFulfilled();return o},f.cast=function(e){var n=y(e,void 0);if(!(n instanceof f)){var o=n;n=new f(u),n._setTrace(void 0),n._setFulfilled(),n._cleanValues(),n._settledValue=o}return n},f.resolve=f.fulfilled=f.cast,f.reject=f.rejected=function(e){var n=new f(u);if(n._setTrace(void 0),q(e),n._cleanValues(),n._setRejected(),n._settledValue=e,!z(e)){var o=new Error(e+"");n._setCarriedStackTrace(o)}return n._ensurePossibleRejectionHandled(),n},f.onPossiblyUnhandledRejection=function(e){a.possiblyUnhandledRejection="function"==typeof e?e:void 0};var D;f.onUnhandledRejectionHandled=function(e){D="function"==typeof e?e:void 0};var E=!1||!("undefined"==typeof n||"string"!=typeof n.execPath||"object"!=typeof n.env||!n.env.BLUEBIRD_DEBUG&&"development"!==n.env.NODE_ENV);f.longStackTraces=function(){if(t.haveItemsQueued()&&E===!1)throw new Error("cannot enable long stack traces after promises have been created");E=a.isSupported()},f.hasLongStackTraces=function(){return E&&a.isSupported()},f.prototype._then=function(e,n,o,d,i){var l=void 0!==i,p=l?i:new f(u);if(!l){if(E){var s=this._peekContext()===this._traceParent;p._traceParent=s?this._traceParent:this}p._propagateFrom(this,7)}var y=this._addCallbacks(e,n,o,p,d);return this.isResolved()&&t.invoke(this._queueSettleAt,this,y),p},f.prototype._length=function(){return 262143&this._bitField},f.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},f.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},f.prototype._setLength=function(e){this._bitField=-262144&this._bitField|262143&e},f.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},f.prototype._setRejected=function(){this._bitField=134217728|this._bitField},f.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},f.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},f.prototype._isFinal=function(){return(33554432&this._bitField)>0},f.prototype._cancellable=function(){return(67108864&this._bitField)>0},f.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},f.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},f.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},f.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},f.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},f.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},f.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},f.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},f.prototype._setCarriedStackTrace=function(e){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=e},f.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},f.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},f.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},f.prototype._receiverAt=function(e){var f=0===e?this._receiver0:this[(e<<2)+e-5+4];return this._isBound()&&void 0===f?this._boundTo:f},f.prototype._promiseAt=function(e){return 0===e?this._promise0:this[(e<<2)+e-5+3]},f.prototype._fulfillmentHandlerAt=function(e){return 0===e?this._fulfillmentHandler0:this[(e<<2)+e-5+0]},f.prototype._rejectionHandlerAt=function(e){return 0===e?this._rejectionHandler0:this[(e<<2)+e-5+1]},f.prototype._addCallbacks=function(e,f,n,o,d){var i=this._length();if(i>=262138&&(i=0,this._setLength(0)),0===i)this._promise0=o,void 0!==d&&(this._receiver0=d),"function"!=typeof e||this._isCarryingStackTrace()||(this._fulfillmentHandler0=e),"function"==typeof f&&(this._rejectionHandler0=f),"function"==typeof n&&(this._progressHandler0=n);else{var t=(i<<2)+i-5;this[t+3]=o,this[t+4]=d,this[t+0]="function"==typeof e?e:void 0,this[t+1]="function"==typeof f?f:void 0,this[t+2]="function"==typeof n?n:void 0}return this._setLength(i+1),i},f.prototype._setProxyHandlers=function(e,f){var n=this._length();if(n>=262138&&(n=0,this._setLength(0)),0===n)this._promise0=f,this._receiver0=e;else{var o=(n<<2)+n-5;this[o+3]=f,this[o+4]=e,this[o+0]=this[o+1]=this[o+2]=void 0}this._setLength(n+1)},f.prototype._proxyPromiseArray=function(e,f){this._setProxyHandlers(e,f)},f.prototype._proxyPromise=function(e){e._setProxied(),this._setProxyHandlers(e,-15)},f.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=8388608|this._bitField,this._boundTo=e):this._bitField=-8388609&this._bitField},f.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},f.prototype._resolveFromResolver=function(e){function f(e){o._tryFollow(e)||o._fulfill(e)}function n(e){var f=z(e)?e:new Error(e+"");o._attachExtraTrace(f),q(e),o._reject(e,f===e?void 0:f)}var o=this;this._setTrace(void 0),this._pushContext();var d=x(e,void 0,f,n);if(this._popContext(),void 0!==d&&d===m){var i=d.e,t=z(i)?i:new Error(i+"");o._reject(i,t)}},f.prototype._spreadSlowCase=function(e,f,n,o){var d=new c(n).promise(),i=d._then(function(){return e.apply(o,arguments)},void 0,void 0,p,void 0);f._follow(i)},f.prototype._callSpread=function(e,n,o){var d=this._boundTo;if(b(o))for(var i=0,t=o.length;t>i;++i)if(y(o[i],void 0)instanceof f)return void this._spreadSlowCase(e,n,o,d);return n._pushContext(),P(e,o,d)},f.prototype._callHandler=function(e,f,n,o){var d;return f!==p||this.isRejected()?(n._pushContext(),d=g(e,f,o)):d=this._callSpread(e,n,o),n._popContext(),d},f.prototype._settlePromiseFromHandler=function(e,n,o,d){if(!(d instanceof f))return void e.call(n,o,d);var i=this._callHandler(e,n,d,o);if(!d._isFollowing())if(i===m||i===d||i===s){var t=i===d?C():i.e,l=z(t)?t:new Error(t+"");i!==s&&d._attachExtraTrace(l),d._rejectUnchecked(t,l)}else{var u=y(i,d);if(u instanceof f){if(u.isRejected()&&!u._isCarryingStackTrace()&&!z(u._settledValue)){var l=new Error(u._settledValue+"");d._attachExtraTrace(l),u._setCarriedStackTrace(l)}d._follow(u),d._propagateFrom(u,1)}else d._fulfillUnchecked(i)}},f.prototype._follow=function(e){this._setFollowing(),e.isPending()?(this._propagateFrom(e,1),e._proxyPromise(this)):e.isFulfilled()?this._fulfillUnchecked(e._settledValue):this._rejectUnchecked(e._settledValue,e._getCarriedStackTrace()),e._isRejectionUnhandled()&&e._unsetRejectionIsUnhandled(),E&&null==e._traceParent&&(e._traceParent=this)},f.prototype._tryFollow=function(e){if(this._isFollowingOrFulfilledOrRejected()||e===this)return!1;var n=y(e,void 0);return n instanceof f?(this._follow(n),!0):!1},f.prototype._resetTrace=function(){E&&(this._trace=new a(void 0===this._peekContext()))},f.prototype._setTrace=function(e){if(E){var f=this._peekContext();this._traceParent=f;var n=void 0===f;this._trace=void 0!==e&&e._traceParent===f?e._trace:new a(n)}return this},f.prototype._attachExtraTrace=function(e){if(E){var f=this,n=e.stack;n="string"==typeof n?n.split("\n"):[],a.protectErrorMessageNewlines(n);for(var o=1,d=1;null!=f&&null!=f._trace;)n=a.combine(n,f._trace.stack.split("\n")),f=f._traceParent,d++;var i=Error.stackTraceLimit||10,t=(i+o)*d,l=n.length;l>t&&(n.length=t),l>0&&(n[0]=n[0].split("\x00").join("\n")),e.stack=n.length<=o?"(No stack trace)":n.join("\n")}},f.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},f.prototype._propagateFrom=function(e,f){(1&f)>0&&e._cancellable()&&(this._setCancellable(),this._cancellationParent=e),(4&f)>0&&this._setBoundTo(e._boundTo),(2&f)>0&&this._setTrace(e)},f.prototype._fulfill=function(e){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(e)},f.prototype._reject=function(e,f){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(e,f)},f.prototype._settlePromiseAt=function(e){var n=this.isFulfilled()?this._fulfillmentHandlerAt(e):this._rejectionHandlerAt(e),o=this._settledValue,d=this._receiverAt(e),i=this._promiseAt(e);if("function"==typeof n)this._settlePromiseFromHandler(n,d,o,i);else{var t=!1,l=this.isFulfilled();void 0!==d&&(d instanceof f&&d._isProxied()?(d._unsetProxied(),l?d._fulfillUnchecked(o):d._rejectUnchecked(o,this._getCarriedStackTrace()),t=!0):d instanceof c&&(l?d._promiseFulfilled(o,i):d._promiseRejected(o,i),t=!0)),t||(l?i._fulfill(o):i._reject(o,this._getCarriedStackTrace()))}e>=4&&this._queueGC()},f.prototype._isProxied=function(){return 4194304===(4194304&this._bitField)},f.prototype._setProxied=function(){this._bitField=4194304|this._bitField},f.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},f.prototype._isGcQueued=function(){return-1073741824===(-1073741824&this._bitField)},f.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},f.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},f.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),t.invokeLater(this._gc,this,void 0))},f.prototype._gc=function(){for(var e=5*this._length()-5,f=0;e>f;f++)delete this[f];this._clearFirstHandlerData(),this._setLength(0),this._unsetGcQueued()},f.prototype._clearFirstHandlerData=function(){this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0},f.prototype._queueSettleAt=function(e){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),t.invoke(this._settlePromiseAt,this,e)},f.prototype._fulfillUnchecked=function(e){if(this.isPending()){if(e===this){var f=C();return this._attachExtraTrace(f),this._rejectUnchecked(f,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=e;var n=this._length();n>0&&t.invoke(this._settlePromises,this,n)}},f.prototype._rejectUncheckedCheckError=function(e){var f=z(e)?e:new Error(e+"");this._rejectUnchecked(e,f===e?void 0:f)},f.prototype._rejectUnchecked=function(e,f){if(this.isPending()){if(e===this){var n=C();return this._attachExtraTrace(n),this._rejectUnchecked(n)}if(this._cleanValues(),this._setRejected(),this._settledValue=e,this._isFinal())return void t.invokeLater(A,void 0,void 0===f?e:f);var o=this._length();void 0!==f&&this._setCarriedStackTrace(f),o>0?t.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},f.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},f.prototype._settlePromises=function(){for(var e=this._length(),f=0;e>f;f++)this._settlePromiseAt(f)},f.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==a.possiblyUnhandledRejection&&t.invokeLater(this._notifyUnhandledRejection,this,void 0)},f.prototype._notifyUnhandledRejectionIsHandled=function(){"function"==typeof D&&t.invokeLater(D,void 0,this)},f.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue,f=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),void 0!==f&&(this._unsetCarriedStackTrace(),e=f),"function"==typeof a.possiblyUnhandledRejection&&a.possiblyUnhandledRejection(e,this)}};var F=[];return f.prototype._peekContext=function(){var e=F.length-1;return e>=0?F[e]:void 0},f.prototype._pushContext=function(){E&&F.push(this)},f.prototype._popContext=function(){E&&F.pop()},f.noConflict=function(){return o(f)},f.setScheduler=function(e){if("function"!=typeof e)throw new v("fn must be a function");t._schedule=e},a.isSupported()||(f.longStackTraces=function(){},E=!1),f._makeSelfResolutionError=C,e("./finally.js")(f,s,y),e("./direct_resolve.js")(f),e("./synchronous_inspection.js")(f),e("./join.js")(f,c,y,u),f.RangeError=j,f.CancellationError=M,f.TimeoutError=X,f.TypeError=v,f.OperationalError=h,f.RejectionError=h,f.AggregateError=l.AggregateError,i.toFastProperties(f),i.toFastProperties(f.prototype),f.Promise=f,e("./timers.js")(f,u,y),e("./race.js")(f,u,y),e("./call_get.js")(f),e("./generators.js")(f,B,u,y),e("./map.js")(f,c,B,y,u),e("./nodeify.js")(f),e("./promisify.js")(f,u),e("./props.js")(f,c,y),e("./reduce.js")(f,c,B,y,u),e("./settle.js")(f,c),e("./some.js")(f,c,B),e("./progress.js")(f,c),e("./cancel.js")(f,u),e("./filter.js")(f,u),e("./any.js")(f,c),e("./each.js")(f,u),e("./using.js")(f,B,y),f.prototype=f.prototype,f}}).call(this,e("FWaASH"))},{"./any.js":110,"./async.js":111,"./call_get.js":113,"./cancel.js":114,"./captured_trace.js":115,"./catch_filter.js":116,"./direct_resolve.js":117,"./each.js":118,"./errors.js":119,"./errors_api_rejection":120,"./filter.js":122,"./finally.js":123,"./generators.js":124,"./join.js":125,"./map.js":126,"./nodeify.js":127,"./progress.js":128,"./promise_array.js":130,"./promise_resolver.js":131,"./promisify.js":132,"./props.js":133,"./race.js":135,"./reduce.js":136,"./settle.js":138,"./some.js":139,"./synchronous_inspection.js":140,"./thenables.js":141,"./timers.js":142,"./using.js":143,"./util.js":144,FWaASH:166}],130:[function(e,f){"use strict";f.exports=function(f,n,o){function d(e){switch(e){case-1:return void 0;case-2:return[];case-3:return{}}}function i(e){var o=this._promise=new f(n),d=void 0;e instanceof f&&(d=e,o._propagateFrom(d,5)),o._setTrace(d),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var t=e("./errors.js").canAttach,l=e("./util.js"),u=l.isArray;return i.prototype.length=function(){return this._length},i.prototype.promise=function(){return this._promise},i.prototype._init=function p(e,n){var i=o(this._values,void 0);if(i instanceof f){if(this._values=i,i._setBoundTo(this._promise._boundTo),!i.isFulfilled())return i.isPending()?void i._then(p,this._reject,void 0,this,n):(i._unsetRejectionIsUnhandled(),void this._reject(i._settledValue));if(i=i._settledValue,!u(i)){var t=new f.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(t)}}else if(!u(i)){var t=new f.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(t)}if(0===i.length)return void(-5===n?this._resolveEmptyArray():this._resolve(d(n)));for(var l=this.getActualLength(i.length),s=l,y=this.shouldCopyValues()?new Array(l):this._values,c=!1,a=0;l>a;++a){var r=o(i[a],void 0);r instanceof f?r.isPending()?r._proxyPromiseArray(this,a):(r._unsetRejectionIsUnhandled(),c=!0):c=!0,y[a]=r}this._values=y,this._length=s,c&&this._scanDirectValues(l)},i.prototype._settlePromiseAt=function(e){var n=this._values[e];n instanceof f?n.isFulfilled()?this._promiseFulfilled(n._settledValue,e):n.isRejected()&&this._promiseRejected(n._settledValue,e):this._promiseFulfilled(n,e)},i.prototype._scanDirectValues=function(e){for(var f=0;e>f&&!this._isResolved();++f)this._settlePromiseAt(f)},i.prototype._isResolved=function(){return null===this._values},i.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},i.prototype.__hardReject__=i.prototype._reject=function(e){this._values=null;var f=t(e)?e:new Error(e+"");this._promise._attachExtraTrace(f),this._promise._reject(e,f)},i.prototype._promiseProgressed=function(e,f){this._isResolved()||this._promise._progress({index:f,value:e})},i.prototype._promiseFulfilled=function(e,f){if(!this._isResolved()){this._values[f]=e;var n=++this._totalResolved;n>=this._length&&this._resolve(this._values)}},i.prototype._promiseRejected=function(e){this._isResolved()||(this._totalResolved++,this._reject(e))},i.prototype.shouldCopyValues=function(){return!0},i.prototype.getActualLength=function(e){return e},i}},{"./errors.js":119,"./util.js":144}],131:[function(e,f){"use strict";function n(e){return e instanceof Error&&a.getPrototypeOf(e)===Error.prototype}function o(e){var f;return f=n(e)?new s(e):e,u.markAsOriginatingFromRejection(f),f}function d(e){function f(f,n){if(null!==e){if(f){var d=o(l(f));e._attachExtraTrace(d),e._reject(d)}else if(arguments.length>2){for(var i=arguments.length,t=new Array(i-1),u=1;i>u;++u)t[u-1]=arguments[u];e._fulfill(t)}else e._fulfill(n);e=null}}return f}var i,t=e("./util.js"),l=t.maybeWrapAsError,u=e("./errors.js"),p=u.TimeoutError,s=u.OperationalError,y=e("./async.js"),c=t.haveGetters,a=e("./es5.js");if(i=c?function(e){this.promise=e}:function(e){this.promise=e,this.asCallback=d(e),this.callback=this.asCallback},c){var r={get:function(){return d(this.promise)}};a.defineProperty(i.prototype,"asCallback",r),a.defineProperty(i.prototype,"callback",r)}i._nodebackForPromise=d,i.prototype.toString=function(){return"[object PromiseResolver]"},i.prototype.resolve=i.prototype.fulfill=function(e){if(!(this instanceof i))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var f=this.promise;f._tryFollow(e)||y.invoke(f._fulfill,f,e)},i.prototype.reject=function(e){if(!(this instanceof i))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var f=this.promise;u.markAsOriginatingFromRejection(e);var n=u.canAttach(e)?e:new Error(e+"");f._attachExtraTrace(n),y.invoke(f._reject,f,e),n!==e&&y.invoke(this._setCarriedStackTrace,this,n)},i.prototype.progress=function(e){if(!(this instanceof i))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");y.invoke(this.promise._progress,this.promise,e)},i.prototype.cancel=function(){y.invoke(this.promise.cancel,this.promise,void 0)},i.prototype.timeout=function(){this.reject(new p("timeout"))},i.prototype.isResolved=function(){return this.promise.isResolved()},i.prototype.toJSON=function(){return this.promise.toJSON()},i.prototype._setCarriedStackTrace=function(e){this.promise.isRejected()&&this.promise._setCarriedStackTrace(e)},f.exports=i},{"./async.js":111,"./errors.js":119,"./es5.js":121,"./util.js":144}],132:[function(e,f){"use strict";f.exports=function(f,n){function o(e){return e.replace(/([$])/,"\\$")}function d(e){try{return e.__isPromisified__===!0}catch(f){return!1}}function i(e,f,n){var o=g.getDataPropertyOrDefault(e,f+n,k);return o?d(o):!1}function t(e,f,n){for(var o=0;o<e.length;o+=2){var d=e[o];if(n.test(d))for(var i=d.replace(n,""),t=0;t<e.length;t+=2)if(e[t]===i)throw new M("Cannot promisify an API that has normal methods with '"+f+"'-suffix")}}function l(e,f,n,o){for(var l=g.inheritedDataKeys(e),u=[],p=0;p<l.length;++p){var s=l[p],y=e[s];"function"!=typeof y||d(y)||i(e,s,f)||!o(s,y,e)||u.push(s,y)}return t(u,f,n),u}function u(e){for(var f=[e],n=Math.max(0,e-1-5),o=e-1;o>=n;--o)o!==e&&f.push(o);for(var o=e+1;5>=o;++o)f.push(o);return f}function p(e){return g.filledRange(e,"arguments[","]")}function s(e){return g.filledRange(e,"_arg","")}function y(e){return"number"==typeof e.length?Math.max(Math.min(e.length,1024),0):0}function c(e){return g.isIdentifier(e)?"."+e:"['"+e.replace(/(['\\])/g,"\\$1")+"']"}function a(e,o,d,i,t){function l(f){var n,d=p(f).join(", "),i=f>0?", ":"";return n="string"==typeof e?"                                                          \n                this.method(args, fn);                                       \n                break;                                                       \n            ".replace(".method",c(e)):o===m?"                                                         \n                callback.call(this, args, fn);                               \n                break;                                                       \n            ":void 0!==o?"                                                         \n                callback.call(receiver, args, fn);                           \n                break;                                                       \n            ":"                                                         \n                callback(args, fn);                                          \n                break;                                                       \n            ",n.replace("args",d).replace(", ",i)
}function a(){for(var f="",n=0;n<w.length;++n)f+="case "+w[n]+":"+l(w[n]);var d;return d="string"==typeof e?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",c(e)):o===m?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",f+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",d)}var r=Math.max(0,y(i)-1),w=u(r),b="string"==typeof d&&g.isIdentifier(d)?d+t:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function FunctionName(Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._setTrace(void 0);                                       \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",b).replace("Parameters",s(r)).replace("[CodeForSwitchCase]",a()))(f,e,o,P,j,x,n)}function r(e,o){function d(){var d=o;o===m&&(d=this),"string"==typeof e&&(e=d[e]);var i=new f(n);i._setTrace(void 0);var t=x(i);try{e.apply(d,P(arguments,t))}catch(l){var u=j(l);i._attachExtraTrace(u),i._reject(u)}return i}return d.__isPromisified__=!0,d}function w(e,f,n,d){for(var i=new RegExp(o(f)+"$"),t=l(e,f,i,n),u=0,p=t.length;p>u;u+=2){var s=t[u],y=t[u+1],c=s+f;e[c]=d===q?q(s,m,s,y,f):d(y)}return g.toFastProperties(e),e}function b(e,f){return q(e,f,void 0,e)}var m={},g=e("./util.js"),x=e("./promise_resolver.js")._nodebackForPromise,P=g.withAppended,j=g.maybeWrapAsError,v=g.canEvaluate,M=e("./errors").TypeError,X="Async",h=function(e,f){return g.isIdentifier(e)&&"_"!==e.charAt(0)&&!g.isClass(f)},k={__isPromisified__:!0},q=v?a:r;f.promisify=function(e,f){if("function"!=typeof e)throw new M("fn must be a function");return d(e)?e:b(e,arguments.length<2?m:f)},f.promisifyAll=function(e,f){if("function"!=typeof e&&"object"!=typeof e)throw new M("the target of promisifyAll must be an object or a function");f=Object(f);var n=f.suffix;"string"!=typeof n&&(n=X);var o=f.filter;"function"!=typeof o&&(o=h);var d=f.promisifier;if("function"!=typeof d&&(d=q),!g.isIdentifier(n))throw new RangeError("suffix must be a valid identifier");for(var i=g.inheritedDataKeys(e,{includeHidden:!0}),t=0;t<i.length;++t){var l=e[i[t]];"constructor"!==i[t]&&g.isClass(l)&&(w(l.prototype,n,o,d),w(l,n,o,d))}return w(e,n,o,d)}}},{"./errors":119,"./promise_resolver.js":131,"./util.js":144}],133:[function(e,f){"use strict";f.exports=function(f,n,o){function d(e){for(var f=p.keys(e),n=f.length,o=new Array(2*n),d=0;n>d;++d){var i=f[d];o[d]=e[i],o[d+n]=i}this.constructor$(o)}function i(e){var n,i=o(e,void 0);return u(i)?(n=i instanceof f?i._then(f.props,void 0,void 0,void 0,void 0):new d(i).promise(),i instanceof f&&n._propagateFrom(i,4),n):l("cannot await properties of a non-object")}var t=e("./util.js"),l=e("./errors_api_rejection")(f),u=t.isObject,p=e("./es5.js");t.inherits(d,n),d.prototype._init=function(){this._init$(void 0,-3)},d.prototype._promiseFulfilled=function(e,f){if(!this._isResolved()){this._values[f]=e;var n=++this._totalResolved;if(n>=this._length){for(var o={},d=this.length(),i=0,t=this.length();t>i;++i)o[this._values[i+d]]=this._values[i];this._resolve(o)}}},d.prototype._promiseProgressed=function(e,f){this._isResolved()||this._promise._progress({key:this._values[f+this.length()],value:e})},d.prototype.shouldCopyValues=function(){return!1},d.prototype.getActualLength=function(e){return e>>1},f.prototype.props=function(){return i(this)},f.props=function(e){return i(e)}}},{"./errors_api_rejection":120,"./es5.js":121,"./util.js":144}],134:[function(e,f){"use strict";function n(e,f,n,o,d){for(var i=0;d>i;++i)n[i+o]=e[i+f]}function o(e){this._capacity=e,this._length=0,this._front=0,this._makeCapacity()}o.prototype._willBeOverCapacity=function(e){return this._capacity<e},o.prototype._pushOne=function(e){var f=this.length();this._checkCapacity(f+1);var n=this._front+f&this._capacity-1;this[n]=e,this._length=f+1},o.prototype.push=function(e,f,n){var o=this.length()+3;if(this._willBeOverCapacity(o))return this._pushOne(e),this._pushOne(f),void this._pushOne(n);var d=this._front+o-3;this._checkCapacity(o);var i=this._capacity-1;this[d+0&i]=e,this[d+1&i]=f,this[d+2&i]=n,this._length=o},o.prototype.shift=function(){var e=this._front,f=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,f},o.prototype.length=function(){return this._length},o.prototype._makeCapacity=function(){for(var e=this._capacity,f=0;e>f;++f)this[f]=void 0},o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<3)},o.prototype._resizeTo=function(e){var f=this._front,o=this._capacity,d=new Array(o),i=this.length();if(n(this,0,d,0,o),this._capacity=e,this._makeCapacity(),this._front=0,o>=f+i)n(d,f,this,0,i);else{var t=i-(f+i&o-1);n(d,f,this,0,t),n(d,0,this,t,i-t)}},f.exports=o},{}],135:[function(e,f){"use strict";f.exports=function(f,n,o){function d(e,d){var p=o(e,void 0);if(p instanceof f)return l(p);if(!t(e))return i("expecting an array, a promise or a thenable");var s=new f(n);void 0!==d?s._propagateFrom(d,7):s._setTrace(void 0);for(var y=s._fulfill,c=s._reject,a=0,r=e.length;r>a;++a){var w=e[a];(void 0!==w||u.call(e,a))&&f.cast(w)._then(y,c,void 0,s,null)}return s}var i=e("./errors_api_rejection.js")(f),t=e("./util.js").isArray,l=function(e){return e.then(function(f){return d(f,e)})},u={}.hasOwnProperty;f.race=function(e){return d(e,void 0)},f.prototype.race=function(){return d(this,void 0)}}},{"./errors_api_rejection.js":120,"./util.js":144}],136:[function(e,f){"use strict";f.exports=function(f,n,o,d,i){function t(e,n,o,t){this.constructor$(e),this._preservedValues=t===i?[]:null,this._zerothIsAccum=void 0===o,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var l=d(o,void 0),u=!1,p=l instanceof f;p&&(l.isPending()?l._proxyPromiseArray(this,-1):l.isFulfilled()?(o=l.value(),this._gotAccum=!0):(l._unsetRejectionIsUnhandled(),this._reject(l.reason()),u=!0)),p||this._zerothIsAccum||(this._gotAccum=!0),this._callback=n,this._accum=o,u||this._init$(void 0,-5)}function l(e,f,n,d){if("function"!=typeof f)return o("fn must be a function");var i=new t(e,f,n,d);return i.promise()}var u=e("./util.js"),p=u.tryCatch4,s=u.tryCatch3,y=u.errorObj;u.inherits(t,n),t.prototype._init=function(){},t.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},t.prototype._promiseFulfilled=function(e,n){var o=this._values;if(null!==o){var i,t=this.length(),l=this._preservedValues,u=null!==l,c=this._gotAccum,a=this._valuesPhase;if(!a)for(a=this._valuesPhase=Array(t),i=0;t>i;++i)a[i]=0;if(i=a[n],0===n&&this._zerothIsAccum?(c||(this._accum=e,this._gotAccum=c=!0),a[n]=0===i?1:2):-1===n?c||(this._accum=e,this._gotAccum=c=!0):0===i?a[n]=1:(a[n]=2,c&&(this._accum=e)),c){for(var r,w=this._callback,b=this._promise._boundTo,m=this._reducingIndex;t>m;++m)if(i=a[m],2!==i){if(1!==i)return;if(e=o[m],e instanceof f){if(!e.isFulfilled())return e.isPending()?void 0:(e._unsetRejectionIsUnhandled(),this._reject(e.reason()));e=e._settledValue}if(u?(l.push(e),r=s(w,b,e,m,t)):r=p(w,b,this._accum,e,m,t),r===y)return this._reject(r.e);var g=d(r,void 0);if(g instanceof f){if(g.isPending())return a[m]=4,g._proxyPromiseArray(this,m);if(!g.isFulfilled())return g._unsetRejectionIsUnhandled(),this._reject(g.reason());r=g.value()}this._reducingIndex=m+1,this._accum=r}else this._reducingIndex=m+1;this._reducingIndex<t||this._resolve(u?l:this._accum)}}},f.prototype.reduce=function(e,f){return l(this,e,f,null)},f.reduce=function(e,f,n,o){return l(e,f,n,o)}}},{"./util.js":144}],137:[function(e,f){(function(e){"use strict";var n,o;if("object"==typeof e&&"string"==typeof e.version)n=function(f){e.nextTick(f)};else if("undefined"!=typeof MutationObserver&&(o=MutationObserver)||"undefined"!=typeof WebKitMutationObserver&&(o=WebKitMutationObserver))n=function(){var e=document.createElement("div"),f=void 0,n=new o(function(){var e=f;f=void 0,e()});return n.observe(e,{attributes:!0}),function(n){f=n,e.classList.toggle("foo")}}();else{if("undefined"==typeof setTimeout)throw new Error("no async scheduler available");n=function(e){setTimeout(e,0)}}f.exports=n}).call(this,e("FWaASH"))},{FWaASH:166}],138:[function(e,f){"use strict";f.exports=function(f,n){function o(e){this.constructor$(e)}var d=f.PromiseInspection,i=e("./util.js");i.inherits(o,n),o.prototype._promiseResolved=function(e,f){this._values[e]=f;var n=++this._totalResolved;n>=this._length&&this._resolve(this._values)},o.prototype._promiseFulfilled=function(e,f){if(!this._isResolved()){var n=new d;n._bitField=268435456,n._settledValue=e,this._promiseResolved(f,n)}},o.prototype._promiseRejected=function(e,f){if(!this._isResolved()){var n=new d;n._bitField=134217728,n._settledValue=e,this._promiseResolved(f,n)}},f.settle=function(e){return new o(e).promise()},f.prototype.settle=function(){return new o(this).promise()}}},{"./util.js":144}],139:[function(e,f){"use strict";f.exports=function(f,n,o){function d(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function i(e,f){if((0|f)!==f||0>f)return o("expecting a positive integer");var n=new d(e),i=n.promise();return i.isRejected()?i:(n.setHowMany(f),n.init(),i)}var t=e("./util.js"),l=e("./errors.js").RangeError,u=e("./errors.js").AggregateError,p=t.isArray;t.inherits(d,n),d.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=p(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},d.prototype.init=function(){this._initialized=!0,this._init()},d.prototype.setUnwrap=function(){this._unwrap=!0},d.prototype.howMany=function(){return this._howMany},d.prototype.setHowMany=function(e){this._isResolved()||(this._howMany=e)},d.prototype._promiseFulfilled=function(e){this._isResolved()||(this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values)))},d.prototype._promiseRejected=function(e){if(!this._isResolved()&&(this._addRejected(e),this.howMany()>this._canPossiblyFulfill())){for(var f=new u,n=this.length();n<this._values.length;++n)f.push(this._values[n]);this._reject(f)}},d.prototype._fulfilled=function(){return this._totalResolved},d.prototype._rejected=function(){return this._values.length-this.length()},d.prototype._addRejected=function(e){this._values.push(e)},d.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},d.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},d.prototype._getRangeError=function(e){var f="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new l(f)},d.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},f.some=function(e,f){return i(e,f)},f.prototype.some=function(e){return i(this,e)},f._SomePromiseArray=d}},{"./errors.js":119,"./util.js":144}],140:[function(e,f){"use strict";f.exports=function(e){function f(e){void 0!==e?(this._bitField=e._bitField,this._settledValue=e.isResolved()?e._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}f.prototype.isFulfilled=e.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},f.prototype.isRejected=e.prototype.isRejected=function(){return(134217728&this._bitField)>0},f.prototype.isPending=e.prototype.isPending=function(){return 0===(402653184&this._bitField)},f.prototype.value=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},f.prototype.error=f.prototype.reason=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},f.prototype.isResolved=e.prototype.isResolved=function(){return(402653184&this._bitField)>0},e.PromiseInspection=f}},{}],141:[function(e,f){"use strict";f.exports=function(f,n){function o(e){try{return e.then}catch(f){return p.e=f,p}}function d(e,d){if(s(e)){if(e instanceof f)return e;if(i(e)){var l=new f(n);return l._setTrace(void 0),e._then(l._fulfillUnchecked,l._rejectUncheckedCheckError,l._progressUnchecked,l,null),l._setFollowing(),l}var y=o(e);if(y===p)return void 0!==d&&u(y.e)&&d._attachExtraTrace(y.e),f.reject(y.e);if("function"==typeof y)return t(e,y,d)}return e}function i(e){return y.call(e,"_promise0")}function t(e,n,o){function d(n){if(!p){if(p=!0,e===n){var d=f._makeSelfResolutionError();return void 0!==o&&o._attachExtraTrace(d),void l.promise._reject(d,void 0)}l.resolve(n)}}function i(e){if(!p){p=!0;var f=u(e)?e:new Error(e+"");void 0!==o&&o._attachExtraTrace(f),l.promise._reject(e,f)}}function t(e){if(!p){var f=l.promise;"function"==typeof f._progress&&f._progress(e)}}var l=f.defer(),p=!1;try{n.call(e,d,i,t)}catch(s){if(!p){p=!0;var y=u(s)?s:new Error(s+"");void 0!==o&&o._attachExtraTrace(y),l.promise._reject(s,y)}}return l.promise}var l=e("./util.js"),u=e("./errors.js").canAttach,p=l.errorObj,s=l.isObject,y={}.hasOwnProperty;return d}},{"./errors.js":119,"./util.js":144}],142:[function(e,f){"use strict";var n=function(e,f){var n=arguments.length,o=arguments[2],d=arguments[3],i=n>=5?arguments[4]:void 0;setTimeout(function(){e(o,d,i)},0|f)};f.exports=function(f,o,d){var i=(e("./util.js"),e("./errors.js")),t=(e("./errors_api_rejection")(f),f.TimeoutError),l=function(e,f,n){if(e.isPending()){"string"!=typeof f&&(f="operation timed out after "+n+" ms");var o=new t(f);i.markAsOriginatingFromRejection(o),e._attachExtraTrace(o),e._cancel(o)}},u=function(e,f){f._fulfill(e)},p=f.delay=function(e,i){void 0===i&&(i=e,e=void 0),i=+i;var t=d(e,void 0),l=new f(o);return t instanceof f?(l._propagateFrom(t,7),l._follow(t),l.then(function(e){return f.delay(e,i)})):(l._setTrace(void 0),n(u,i,e,l),l)};f.prototype.delay=function(e){return p(this,e)},f.prototype.timeout=function(e,d){e=+e;var i=new f(o);return i._propagateFrom(this,7),i._follow(this),n(l,e,i,d,e),i.cancellable()}}},{"./errors.js":119,"./errors_api_rejection":120,"./util.js":144}],143:[function(e,f){"use strict";f.exports=function(f,n,o){function d(e){for(var n=e.length,o=0;n>o;++o){var d=e[o];if(d.isRejected())return f.reject(d.error());e[o]=d.value()}return e}function i(e){setTimeout(function(){throw e},0)}function t(e){var f=o(e,void 0);return f!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&f._setDisposable(e._getDisposer()),f}function l(e,n){function d(){if(l>=u)return p.resolve();var s=t(e[l++]);if(s instanceof f&&s._isDisposable()){try{s=o(s._getDisposer().tryDispose(n),void 0)}catch(y){return i(y)}if(s instanceof f)return s._then(d,i,null,null,null)}d()}var l=0,u=e.length,p=f.defer();return d(),p.promise}function u(e){var f=new r;return f._settledValue=e,f._bitField=268435456,l(this,f).thenReturn(e)}function p(e){var f=new r;return f._settledValue=e,f._bitField=134217728,l(this,f).thenThrow(e)}function s(e,f){this._data=e,this._promise=f}function y(e,f){this.constructor$(e,f)}var c=e("./errors.js").TypeError,a=e("./util.js").inherits,r=f.PromiseInspection;s.prototype.data=function(){return this._data},s.prototype.promise=function(){return this._promise},s.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},s.prototype.tryDispose=function(e){var f=this.resource(),n=null!==f?this.doDispose(f,e):null;return this._promise._unsetDisposable(),this._data=this._promise=null,n},s.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},a(y,s),y.prototype.doDispose=function(e,f){var n=this.data();return n.call(e,e,f)},f.using=function(){var e=arguments.length;if(2>e)return n("you must pass at least 2 arguments to Promise.using");var o=arguments[e-1];if("function"!=typeof o)return n("fn must be a function");e--;for(var i=new Array(e),t=0;e>t;++t){var l=arguments[t];if(s.isDisposer(l)){var y=l;l=l.promise(),l._setDisposable(y)}i[t]=l}return f.settle(i).then(d).spread(o)._then(u,p,void 0,i,void 0)},f.prototype._setDisposable=function(e){this._bitField=262144|this._bitField,this._disposer=e},f.prototype._isDisposable=function(){return(262144&this._bitField)>0},f.prototype._getDisposer=function(){return this._disposer},f.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},f.prototype.disposer=function(e){if("function"==typeof e)return new y(e,this);throw new c}}},{"./errors.js":119,"./util.js":144}],144:[function(e,f,n){"use strict";function o(e,f,n){try{return e.call(f,n)}catch(o){return M.e=o,M}}function d(e,f,n,o){try{return e.call(f,n,o)}catch(d){return M.e=d,M}}function i(e,f,n,o,d){try{return e.call(f,n,o,d)}catch(i){return M.e=i,M}}function t(e,f,n,o,d,i){try{return e.call(f,n,o,d,i)}catch(t){return M.e=t,M}}function l(e,f,n){try{return e.apply(n,f)}catch(o){return M.e=o,M}}function u(e){return"string"==typeof e?e:""+e}function p(e){return null==e||e===!0||e===!1||"string"==typeof e||"number"==typeof e}function s(e){return!p(e)}function y(e){return p(e)?new Error(u(e)):e}function c(e,f){var n,o=e.length,d=new Array(o+1);for(n=0;o>n;++n)d[n]=e[n];return d[n]=f,d}function a(e,f,n){if(!P.isES5)return{}.hasOwnProperty.call(e,f)?e[f]:void 0;var o=Object.getOwnPropertyDescriptor(e,f);return null!=o?null==o.get&&null==o.set?o.value:n:void 0}function r(e,f,n){if(p(e))return e;var o={value:n,configurable:!0,enumerable:!1,writable:!0};return P.defineProperty(e,f,o),e}function w(e){throw e}function b(e){try{if("function"==typeof e){var f=P.keys(e.prototype);return f.length>0&&!(1===f.length&&"constructor"===f[0])}return!1}catch(n){return!1}}function m(e){function f(){}return f.prototype=e,f}function g(e){return q.test(e)}function x(e,f,n){for(var o=new Array(e),d=0;e>d;++d)o[d]=f+d+n;return o}var P=e("./es5.js"),j=function(){try{var e={};return P.defineProperty(e,"f",{get:function(){return 3}}),3===e.f}catch(f){return!1}}(),v="undefined"==typeof navigator,M={e:{}},X=function(e,f){function n(){this.constructor=e,this.constructor$=f;for(var n in f.prototype)o.call(f.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=f.prototype[n])}var o={}.hasOwnProperty;return n.prototype=f.prototype,e.prototype=new n,e.prototype},h=function(){return"string"!==this}.call("string"),k=function(){return P.isES5?function(e,f){for(var n=[],o=Object.create(null),d=Object(f).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=e;){var i;try{i=d(e)}catch(t){return n}for(var l=0;l<i.length;++l){var u=i[l];if(!o[u]){o[u]=!0;var p=Object.getOwnPropertyDescriptor(e,u);null!=p&&null==p.get&&null==p.set&&n.push(u)}}e=P.getPrototypeOf(e)}return n}:function(e){var f=[];for(var n in e)f.push(n);return f}}(),q=/^[a-z$_][a-z$_0-9]*$/i,z={isClass:b,isIdentifier:g,inheritedDataKeys:k,getDataPropertyOrDefault:a,thrower:w,isArray:P.isArray,haveGetters:j,notEnumerableProp:r,isPrimitive:p,isObject:s,canEvaluate:v,errorObj:M,tryCatch1:o,tryCatch2:d,tryCatch3:i,tryCatch4:t,tryCatchApply:l,inherits:X,withAppended:c,asString:u,maybeWrapAsError:y,wrapsPrimitiveReceiver:h,toFastProperties:m,filledRange:x};f.exports=z},{"./es5.js":121}],145:[function(e,f){function n(e,f){if("function"!=typeof f)throw new Error("Bad callback given: "+f);if(!e)throw new Error("No options given");var t=e.onResponse;if(e="string"==typeof e?{uri:e}:JSON.parse(JSON.stringify(e)),e.onResponse=t,e.verbose&&(n.log=i()),e.url&&(e.uri=e.url,delete e.url),!e.uri&&""!==e.uri)throw new Error("options.uri is a required argument");if("string"!=typeof e.uri)throw new Error("options.uri must be a string");for(var l=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],p=0;p<l.length;p++)if(e[l[p]])throw new Error("options."+l[p]+" is not supported");if(e.callback=f,e.method=e.method||"GET",e.headers=e.headers||{},e.body=e.body||null,e.timeout=e.timeout||n.DEFAULT_TIMEOUT,e.headers.host)throw new Error("Options.headers.host is not supported");e.json&&(e.headers.accept=e.headers.accept||"application/json","GET"!==e.method&&(e.headers["content-type"]="application/json"),"boolean"!=typeof e.json?e.body=JSON.stringify(e.json):"string"!=typeof e.body&&(e.body=JSON.stringify(e.body)));var s=function(e){var f=[];for(var n in e)e.hasOwnProperty(n)&&f.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return f.join("&")};if(e.qs){var y="string"==typeof e.qs?e.qs:s(e.qs);e.uri=-1!==e.uri.indexOf("?")?e.uri+"&"+y:e.uri+"?"+y}var c=function(e){var f={};f.boundry="-------------------------------"+Math.floor(1e9*Math.random());var n=[];for(var o in e)e.hasOwnProperty(o)&&n.push("--"+f.boundry+'\nContent-Disposition: form-data; name="'+o+'"\n\n'+e[o]+"\n");return n.push("--"+f.boundry+"--"),f.body=n.join(""),f.length=f.body.length,f.type="multipart/form-data; boundary="+f.boundry,f};if(e.form){if("string"==typeof e.form)throw"form name unsupported";if("POST"===e.method){var a=(e.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(e.headers["content-type"]=a,a){case"application/x-www-form-urlencoded":e.body=s(e.form).replace(/%20/g,"+");break;case"multipart/form-data":var r=c(e.form);e.body=r.body,e.headers["content-type"]=r.type;break;default:throw new Error("unsupported encoding:"+a)}}}return e.onResponse=e.onResponse||d,e.onResponse===!0&&(e.onResponse=f,e.callback=d),!e.headers.authorization&&e.auth&&(e.headers.authorization="Basic "+u(e.auth.username+":"+e.auth.password)),o(e)}function o(e){function f(){s=!0;var f=new Error("ETIMEDOUT");return f.code="ETIMEDOUT",f.duration=e.timeout,n.log.error("Timeout",{id:u._id,milliseconds:e.timeout}),e.callback(f,u)}function o(){if(s)return n.log.debug("Ignoring timed out state change",{state:u.readyState,id:u.id});if(n.log.debug("State change",{state:u.readyState,id:u.id,timed_out:s}),u.readyState===p.OPENED){n.log.debug("Request started",{id:u.id});for(var f in e.headers)u.setRequestHeader(f,e.headers[f])}else u.readyState===p.HEADERS_RECEIVED?d():u.readyState===p.LOADING?(d(),i()):u.readyState===p.DONE&&(d(),i(),t())}function d(){if(!w.response){if(w.response=!0,n.log.debug("Got response",{id:u.id,status:u.status}),clearTimeout(u.timeoutTimer),u.statusCode=u.status,c&&0==u.statusCode){var f=new Error("CORS request rejected: "+e.uri);return f.cors="rejected",w.loading=!0,w.end=!0,e.callback(f,u)}e.onResponse(null,u)}}function i(){w.loading||(w.loading=!0,n.log.debug("Response body loading",{id:u.id}))}function t(){if(!w.end){if(w.end=!0,n.log.debug("Request done",{id:u.id}),u.body=u.responseText,e.json)try{u.body=JSON.parse(u.responseText)}catch(f){return e.callback(f,u)}e.callback(null,u,u.body)}}var u=new p,s=!1,c=l(e.uri),a="withCredentials"in u;if(y+=1,u.seq_id=y,u.id=y+": "+e.method+" "+e.uri,u._id=u.id,c&&!a){var r=new Error("Browser does not support cross-origin request: "+e.uri);return r.cors="unsupported",e.callback(r,u)}u.timeoutTimer=setTimeout(f,e.timeout);var w={response:!1,loading:!1,end:!1};return u.onreadystatechange=o,u.open(e.method,e.uri,!0),c&&(u.withCredentials=!!e.withCredentials),u.send(e.body),u}function d(){}function i(){var e,f,n={},o=["trace","debug","info","warn","error"];for(f=0;f<o.length;f++)e=o[f],n[e]=d,"undefined"!=typeof console&&console&&console[e]&&(n[e]=t(console,e));return n}function t(e,f){function n(n,o){return"object"==typeof o&&(n+=" "+JSON.stringify(o)),e[f].call(e,n)}return n}function l(e){var f,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{f=location.href}catch(o){f=document.createElement("a"),f.href="",f=f.href}var d=n.exec(f.toLowerCase())||[],i=n.exec(e.toLowerCase()),t=!(!i||i[1]==d[1]&&i[2]==d[2]&&(i[3]||("http:"===i[1]?80:443))==(d[3]||("http:"===d[1]?80:443)));return t}function u(e){var f,n,o,d,i,t,l,u,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,y=0,c="",a=[];if(!e)return e;do f=e.charCodeAt(s++),n=e.charCodeAt(s++),o=e.charCodeAt(s++),u=f<<16|n<<8|o,d=u>>18&63,i=u>>12&63,t=u>>6&63,l=63&u,a[y++]=p.charAt(d)+p.charAt(i)+p.charAt(t)+p.charAt(l);while(s<e.length);switch(c=a.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}var p=XMLHttpRequest;if(!p)throw new Error("missing XMLHttpRequest");n.log={trace:d,debug:d,info:d,warn:d,error:d};var s=18e4,y=0;n.withCredentials=!1,n.DEFAULT_TIMEOUT=s,n.defaults=function(e){var f=function(f){var n=function(n,o){n="string"==typeof n?{uri:n}:JSON.parse(JSON.stringify(n));for(var d in e)void 0===n[d]&&(n[d]=e[d]);return f(n,o)};return n},o=f(n);return o.get=f(n.get),o.post=f(n.post),o.put=f(n.put),o.head=f(n.head),o};var c=["get","put","post","head"];c.forEach(function(e){var f=e.toUpperCase(),o=e.toLowerCase();n[o]=function(e){"string"==typeof e?e={method:f,uri:e}:(e=JSON.parse(JSON.stringify(e)),e.method=f);var o=[e].concat(Array.prototype.slice.apply(arguments,[1]));return n.apply(this,o)}}),n.couch=function(e,f){function o(e,n,o){if(e)return f(e,n,o);if((n.statusCode<200||n.statusCode>299)&&o.error){e=new Error("CouchDB error: "+(o.error.reason||o.error.error));for(var d in o)e[d]=o[d];return f(e,n,o)}return f(e,n,o)}"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,f=f||d;var i=n(e,o);return i},f.exports=n},{}],146:[function(){},{}],147:[function(e,f,n){function o(e,f,n){if(!(this instanceof o))return new o(e,f,n);var d,i=typeof e;if("number"===i)d=e>0?e>>>0:0;else if("string"===i)"base64"===f&&(e=M(e)),d=o.byteLength(e,f);else{if("object"!==i||null===e)throw new TypeError("must start with number, buffer, array or string");"Buffer"===e.type&&G(e.data)&&(e=e.data),d=+e.length>0?Math.floor(+e.length):0}if(this.length>H)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+H.toString(16)+" bytes");var t;o.TYPED_ARRAY_SUPPORT?t=o._augment(new Uint8Array(d)):(t=this,t.length=d,t._isBuffer=!0);var l;if(o.TYPED_ARRAY_SUPPORT&&"number"==typeof e.byteLength)t._set(e);else if(h(e))if(o.isBuffer(e))for(l=0;d>l;l++)t[l]=e.readUInt8(l);else for(l=0;d>l;l++)t[l]=(e[l]%256+256)%256;else if("string"===i)t.write(e,0,f);else if("number"===i&&!o.TYPED_ARRAY_SUPPORT&&!n)for(l=0;d>l;l++)t[l]=0;return t}function d(e,f,n,o){n=Number(n)||0;var d=e.length-n;o?(o=Number(o),o>d&&(o=d)):o=d;var i=f.length;if(i%2!==0)throw new Error("Invalid hex string");o>i/2&&(o=i/2);for(var t=0;o>t;t++){var l=parseInt(f.substr(2*t,2),16);if(isNaN(l))throw new Error("Invalid hex string");e[n+t]=l}return t}function i(e,f,n,o){var d=C(q(f),e,n,o);return d}function t(e,f,n,o){var d=C(z(f),e,n,o);return d}function l(e,f,n,o){return t(e,f,n,o)}function u(e,f,n,o){var d=C(B(f),e,n,o);return d}function p(e,f,n,o){var d=C(A(f),e,n,o);return d}function s(e,f,n){return E.fromByteArray(0===f&&n===e.length?e:e.slice(f,n))}function y(e,f,n){var o="",d="";n=Math.min(e.length,n);for(var i=f;n>i;i++)e[i]<=127?(o+=D(d)+String.fromCharCode(e[i]),d=""):d+="%"+e[i].toString(16);return o+D(d)}function c(e,f,n){var o="";n=Math.min(e.length,n);for(var d=f;n>d;d++)o+=String.fromCharCode(e[d]);return o}function a(e,f,n){return c(e,f,n)}function r(e,f,n){var o=e.length;(!f||0>f)&&(f=0),(!n||0>n||n>o)&&(n=o);for(var d="",i=f;n>i;i++)d+=k(e[i]);return d}function w(e,f,n){for(var o=e.slice(f,n),d="",i=0;i<o.length;i+=2)d+=String.fromCharCode(o[i]+256*o[i+1]);return d}function b(e,f,n){if(e%1!==0||0>e)throw new RangeError("offset is not uint");if(e+f>n)throw new RangeError("Trying to access beyond buffer length")}function m(e,f,n,d,i,t){if(!o.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(f>i||t>f)throw new TypeError("value is out of bounds");if(n+d>e.length)throw new TypeError("index out of range")}function g(e,f,n,o){0>f&&(f=65535+f+1);for(var d=0,i=Math.min(e.length-n,2);i>d;d++)e[n+d]=(f&255<<8*(o?d:1-d))>>>8*(o?d:1-d)}function x(e,f,n,o){0>f&&(f=4294967295+f+1);for(var d=0,i=Math.min(e.length-n,4);i>d;d++)e[n+d]=f>>>8*(o?d:3-d)&255}function P(e,f,n,o,d,i){if(f>d||i>f)throw new TypeError("value is out of bounds");if(n+o>e.length)throw new TypeError("index out of range")}function j(e,f,n,o,d){return d||P(e,f,n,4,3.4028234663852886e38,-3.4028234663852886e38),F.write(e,f,n,o,23,4),n+4}function v(e,f,n,o,d){return d||P(e,f,n,8,1.7976931348623157e308,-1.7976931348623157e308),F.write(e,f,n,o,52,8),n+8}function M(e){for(e=X(e).replace(J,"");e.length%4!==0;)e+="=";return e}function X(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function h(e){return G(e)||o.isBuffer(e)||e&&"object"==typeof e&&"number"==typeof e.length}function k(e){return 16>e?"0"+e.toString(16):e.toString(16)}function q(e){for(var f=[],n=0;n<e.length;n++){var o=e.charCodeAt(n);if(127>=o)f.push(o);else{var d=n;o>=55296&&57343>=o&&n++;for(var i=encodeURIComponent(e.slice(d,n+1)).substr(1).split("%"),t=0;t<i.length;t++)f.push(parseInt(i[t],16))}}return f}function z(e){for(var f=[],n=0;n<e.length;n++)f.push(255&e.charCodeAt(n));return f}function A(e){for(var f,n,o,d=[],i=0;i<e.length;i++)f=e.charCodeAt(i),n=f>>8,o=f%256,d.push(o),d.push(n);return d}function B(e){return E.toByteArray(e)}function C(e,f,n,o){for(var d=0;o>d&&!(d+n>=f.length||d>=e.length);d++)f[d+n]=e[d];return d}function D(e){try{return decodeURIComponent(e)}catch(f){return String.fromCharCode(65533)}}var E=e("base64-js"),F=e("ieee754"),G=e("is-array");n.Buffer=o,n.SlowBuffer=o,n.INSPECT_MAX_BYTES=50,o.poolSize=8192;var H=1073741823;o.TYPED_ARRAY_SUPPORT=function(){try{var e=new ArrayBuffer(0),f=new Uint8Array(e);return f.foo=function(){return 42},42===f.foo()&&"function"==typeof f.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength
}catch(n){return!1}}(),o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,f){if(!o.isBuffer(e)||!o.isBuffer(f))throw new TypeError("Arguments must be Buffers");for(var n=e.length,d=f.length,i=0,t=Math.min(n,d);t>i&&e[i]===f[i];i++);return i!==t&&(n=e[i],d=f[i]),d>n?-1:n>d?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,f){if(!G(e))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===e.length)return new o(0);if(1===e.length)return e[0];var n;if(void 0===f)for(f=0,n=0;n<e.length;n++)f+=e[n].length;var d=new o(f),i=0;for(n=0;n<e.length;n++){var t=e[n];t.copy(d,i),i+=t.length}return d},o.byteLength=function(e,f){var n;switch(e+="",f||"utf8"){case"ascii":case"binary":case"raw":n=e.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*e.length;break;case"hex":n=e.length>>>1;break;case"utf8":case"utf-8":n=q(e).length;break;case"base64":n=B(e).length;break;default:n=e.length}return n},o.prototype.length=void 0,o.prototype.parent=void 0,o.prototype.toString=function(e,f,n){var o=!1;if(f>>>=0,n=void 0===n||1/0===n?this.length:n>>>0,e||(e="utf8"),0>f&&(f=0),n>this.length&&(n=this.length),f>=n)return"";for(;;)switch(e){case"hex":return r(this,f,n);case"utf8":case"utf-8":return y(this,f,n);case"ascii":return c(this,f,n);case"binary":return a(this,f,n);case"base64":return s(this,f,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,f,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return 0===o.compare(this,e)},o.prototype.inspect=function(){var e="",f=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,f).match(/.{2}/g).join(" "),this.length>f&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return o.compare(this,e)},o.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},o.prototype.set=function(e,f){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,f)},o.prototype.write=function(e,f,n,o){if(isFinite(f))isFinite(n)||(o=n,n=void 0);else{var s=o;o=f,f=n,n=s}f=Number(f)||0;var y=this.length-f;n?(n=Number(n),n>y&&(n=y)):n=y,o=String(o||"utf8").toLowerCase();var c;switch(o){case"hex":c=d(this,e,f,n);break;case"utf8":case"utf-8":c=i(this,e,f,n);break;case"ascii":c=t(this,e,f,n);break;case"binary":c=l(this,e,f,n);break;case"base64":c=u(this,e,f,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":c=p(this,e,f,n);break;default:throw new TypeError("Unknown encoding: "+o)}return c},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,f){var n=this.length;if(e=~~e,f=void 0===f?n:~~f,0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),0>f?(f+=n,0>f&&(f=0)):f>n&&(f=n),e>f&&(f=e),o.TYPED_ARRAY_SUPPORT)return o._augment(this.subarray(e,f));for(var d=f-e,i=new o(d,void 0,!0),t=0;d>t;t++)i[t]=this[t+e];return i},o.prototype.readUInt8=function(e,f){return f||b(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,f){return f||b(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,f){return f||b(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,f){return f||b(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,f){return f||b(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readInt8=function(e,f){return f||b(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,f){f||b(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,f){f||b(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,f){return f||b(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,f){return f||b(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,f){return f||b(e,4,this.length),F.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,f){return f||b(e,4,this.length),F.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,f){return f||b(e,8,this.length),F.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,f){return f||b(e,8,this.length),F.read(this,e,!1,52,8)},o.prototype.writeUInt8=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[f]=e,f+1},o.prototype.writeUInt16LE=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[f]=e,this[f+1]=e>>>8):g(this,e,f,!0),f+2},o.prototype.writeUInt16BE=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[f]=e>>>8,this[f+1]=e):g(this,e,f,!1),f+2},o.prototype.writeUInt32LE=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[f+3]=e>>>24,this[f+2]=e>>>16,this[f+1]=e>>>8,this[f]=e):x(this,e,f,!0),f+4},o.prototype.writeUInt32BE=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[f]=e>>>24,this[f+1]=e>>>16,this[f+2]=e>>>8,this[f+3]=e):x(this,e,f,!1),f+4},o.prototype.writeInt8=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),0>e&&(e=255+e+1),this[f]=e,f+1},o.prototype.writeInt16LE=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[f]=e,this[f+1]=e>>>8):g(this,e,f,!0),f+2},o.prototype.writeInt16BE=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[f]=e>>>8,this[f+1]=e):g(this,e,f,!1),f+2},o.prototype.writeInt32LE=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[f]=e,this[f+1]=e>>>8,this[f+2]=e>>>16,this[f+3]=e>>>24):x(this,e,f,!0),f+4},o.prototype.writeInt32BE=function(e,f,n){return e=+e,f>>>=0,n||m(this,e,f,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[f]=e>>>24,this[f+1]=e>>>16,this[f+2]=e>>>8,this[f+3]=e):x(this,e,f,!1),f+4},o.prototype.writeFloatLE=function(e,f,n){return j(this,e,f,!0,n)},o.prototype.writeFloatBE=function(e,f,n){return j(this,e,f,!1,n)},o.prototype.writeDoubleLE=function(e,f,n){return v(this,e,f,!0,n)},o.prototype.writeDoubleBE=function(e,f,n){return v(this,e,f,!1,n)},o.prototype.copy=function(e,f,n,d){var i=this;if(n||(n=0),d||0===d||(d=this.length),f||(f=0),d!==n&&0!==e.length&&0!==i.length){if(n>d)throw new TypeError("sourceEnd < sourceStart");if(0>f||f>=e.length)throw new TypeError("targetStart out of bounds");if(0>n||n>=i.length)throw new TypeError("sourceStart out of bounds");if(0>d||d>i.length)throw new TypeError("sourceEnd out of bounds");d>this.length&&(d=this.length),e.length-f<d-n&&(d=e.length-f+n);var t=d-n;if(100>t||!o.TYPED_ARRAY_SUPPORT)for(var l=0;t>l;l++)e[l+f]=this[l+n];else e._set(this.subarray(n,n+t),f)}},o.prototype.fill=function(e,f,n){if(e||(e=0),f||(f=0),n||(n=this.length),f>n)throw new TypeError("end < start");if(n!==f&&0!==this.length){if(0>f||f>=this.length)throw new TypeError("start out of bounds");if(0>n||n>this.length)throw new TypeError("end out of bounds");var o;if("number"==typeof e)for(o=f;n>o;o++)this[o]=e;else{var d=q(e.toString()),i=d.length;for(o=f;n>o;o++)this[o]=d[o%i]}return this}},o.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(o.TYPED_ARRAY_SUPPORT)return new o(this).buffer;for(var e=new Uint8Array(this.length),f=0,n=e.length;n>f;f+=1)e[f]=this[f];return e.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var I=o.prototype;o._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=I.get,e.set=I.set,e.write=I.write,e.toString=I.toString,e.toLocaleString=I.toString,e.toJSON=I.toJSON,e.equals=I.equals,e.compare=I.compare,e.copy=I.copy,e.slice=I.slice,e.readUInt8=I.readUInt8,e.readUInt16LE=I.readUInt16LE,e.readUInt16BE=I.readUInt16BE,e.readUInt32LE=I.readUInt32LE,e.readUInt32BE=I.readUInt32BE,e.readInt8=I.readInt8,e.readInt16LE=I.readInt16LE,e.readInt16BE=I.readInt16BE,e.readInt32LE=I.readInt32LE,e.readInt32BE=I.readInt32BE,e.readFloatLE=I.readFloatLE,e.readFloatBE=I.readFloatBE,e.readDoubleLE=I.readDoubleLE,e.readDoubleBE=I.readDoubleBE,e.writeUInt8=I.writeUInt8,e.writeUInt16LE=I.writeUInt16LE,e.writeUInt16BE=I.writeUInt16BE,e.writeUInt32LE=I.writeUInt32LE,e.writeUInt32BE=I.writeUInt32BE,e.writeInt8=I.writeInt8,e.writeInt16LE=I.writeInt16LE,e.writeInt16BE=I.writeInt16BE,e.writeInt32LE=I.writeInt32LE,e.writeInt32BE=I.writeInt32BE,e.writeFloatLE=I.writeFloatLE,e.writeFloatBE=I.writeFloatBE,e.writeDoubleLE=I.writeDoubleLE,e.writeDoubleBE=I.writeDoubleBE,e.fill=I.fill,e.inspect=I.inspect,e.toArrayBuffer=I.toArrayBuffer,e};var J=/[^+\/0-9A-z]/g},{"base64-js":148,ieee754:149,"is-array":150}],148:[function(e,f,n){var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(e){"use strict";function f(e){var f=e.charCodeAt(0);return f===t?62:f===l?63:u>f?-1:u+10>f?f-u+26+26:s+26>f?f-s:p+26>f?f-p+26:void 0}function n(e){function n(e){p[y++]=e}var o,d,t,l,u,p;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=e.length;u="="===e.charAt(s-2)?2:"="===e.charAt(s-1)?1:0,p=new i(3*e.length/4-u),t=u>0?e.length-4:e.length;var y=0;for(o=0,d=0;t>o;o+=4,d+=3)l=f(e.charAt(o))<<18|f(e.charAt(o+1))<<12|f(e.charAt(o+2))<<6|f(e.charAt(o+3)),n((16711680&l)>>16),n((65280&l)>>8),n(255&l);return 2===u?(l=f(e.charAt(o))<<2|f(e.charAt(o+1))>>4,n(255&l)):1===u&&(l=f(e.charAt(o))<<10|f(e.charAt(o+1))<<4|f(e.charAt(o+2))>>2,n(l>>8&255),n(255&l)),p}function d(e){function f(e){return o.charAt(e)}function n(e){return f(e>>18&63)+f(e>>12&63)+f(e>>6&63)+f(63&e)}var d,i,t,l=e.length%3,u="";for(d=0,t=e.length-l;t>d;d+=3)i=(e[d]<<16)+(e[d+1]<<8)+e[d+2],u+=n(i);switch(l){case 1:i=e[e.length-1],u+=f(i>>2),u+=f(i<<4&63),u+="==";break;case 2:i=(e[e.length-2]<<8)+e[e.length-1],u+=f(i>>10),u+=f(i>>4&63),u+=f(i<<2&63),u+="="}return u}var i="undefined"!=typeof Uint8Array?Uint8Array:Array,t="+".charCodeAt(0),l="/".charCodeAt(0),u="0".charCodeAt(0),p="a".charCodeAt(0),s="A".charCodeAt(0);e.toByteArray=n,e.fromByteArray=d}("undefined"==typeof n?this.base64js={}:n)},{}],149:[function(e,f,n){n.read=function(e,f,n,o,d){var i,t,l=8*d-o-1,u=(1<<l)-1,p=u>>1,s=-7,y=n?d-1:0,c=n?-1:1,a=e[f+y];for(y+=c,i=a&(1<<-s)-1,a>>=-s,s+=l;s>0;i=256*i+e[f+y],y+=c,s-=8);for(t=i&(1<<-s)-1,i>>=-s,s+=o;s>0;t=256*t+e[f+y],y+=c,s-=8);if(0===i)i=1-p;else{if(i===u)return t?0/0:1/0*(a?-1:1);t+=Math.pow(2,o),i-=p}return(a?-1:1)*t*Math.pow(2,i-o)},n.write=function(e,f,n,o,d,i){var t,l,u,p=8*i-d-1,s=(1<<p)-1,y=s>>1,c=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,a=o?0:i-1,r=o?1:-1,w=0>f||0===f&&0>1/f?1:0;for(f=Math.abs(f),isNaN(f)||1/0===f?(l=isNaN(f)?1:0,t=s):(t=Math.floor(Math.log(f)/Math.LN2),f*(u=Math.pow(2,-t))<1&&(t--,u*=2),f+=t+y>=1?c/u:c*Math.pow(2,1-y),f*u>=2&&(t++,u/=2),t+y>=s?(l=0,t=s):t+y>=1?(l=(f*u-1)*Math.pow(2,d),t+=y):(l=f*Math.pow(2,y-1)*Math.pow(2,d),t=0));d>=8;e[n+a]=255&l,a+=r,l/=256,d-=8);for(t=t<<d|l,p+=d;p>0;e[n+a]=255&t,a+=r,t/=256,p-=8);e[n+a-r]|=128*w}},{}],150:[function(e,f){var n=Array.isArray,o=Object.prototype.toString;f.exports=n||function(e){return!!e&&"[object Array]"==o.call(e)}},{}],151:[function(e,f){(function(n){function o(e){return function(){var f=[],o={update:function(e,o){return n.isBuffer(e)||(e=new n(e,o)),f.push(e),this},digest:function(o){var d=n.concat(f),i=e(d);return f=null,o?i.toString(o):i}};return o}}var d=e("sha.js"),i=o(e("./md5")),t=o(e("ripemd160"));f.exports=function(e){return"md5"===e?new i:"rmd160"===e?new t:d(e)}}).call(this,e("buffer").Buffer)},{"./md5":155,buffer:147,ripemd160:156,"sha.js":158}],152:[function(e,f){(function(n){function o(e,f){if(!(this instanceof o))return new o(e,f);this._opad=u,this._alg=e,f=this._key=n.isBuffer(f)?f:new n(f),f.length>i?f=d(e).update(f).digest():f.length<i&&(f=n.concat([f,t],i));for(var l=this._ipad=new n(i),u=this._opad=new n(i),p=0;i>p;p++)l[p]=54^f[p],u[p]=92^f[p];this._hash=d(e).update(l)}var d=e("./create-hash"),i=64,t=new n(i);t.fill(0),f.exports=o,o.prototype.update=function(e,f){return this._hash.update(e,f),this},o.prototype.digest=function(e){var f=this._hash.digest();return d(this._alg).update(this._opad).update(f).digest(e)}}).call(this,e("buffer").Buffer)},{"./create-hash":151,buffer:147}],153:[function(e,f){(function(e){function n(f,n){if(f.length%i!==0){var o=f.length+(i-f.length%i);f=e.concat([f,t],o)}for(var d=[],l=n?f.readInt32BE:f.readInt32LE,u=0;u<f.length;u+=i)d.push(l.call(f,u));return d}function o(f,n,o){for(var d=new e(n),i=o?d.writeInt32BE:d.writeInt32LE,t=0;t<f.length;t++)i.call(d,f[t],4*t,!0);return d}function d(f,d,i,t){e.isBuffer(f)||(f=new e(f));var u=d(n(f,t),f.length*l);return o(u,i,t)}var i=4,t=new e(i);t.fill(0);var l=8;f.exports={hash:d}}).call(this,e("buffer").Buffer)},{buffer:147}],154:[function(e,f,n){(function(f){function o(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}function d(e,f){for(var n in e)f(e[n],n)}var i=e("./rng");n.createHash=e("./create-hash"),n.createHmac=e("./create-hmac"),n.randomBytes=function(e,n){if(!n||!n.call)return new f(i(e));try{n.call(this,void 0,new f(i(e)))}catch(o){n(o)}},n.getHashes=function(){return["sha1","sha256","md5","rmd160"]};var t=e("./pbkdf2")(n.createHmac);n.pbkdf2=t.pbkdf2,n.pbkdf2Sync=t.pbkdf2Sync,d(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman"],function(e){n[e]=function(){o("sorry,",e,"is not implemented yet")}})}).call(this,e("buffer").Buffer)},{"./create-hash":151,"./create-hmac":152,"./pbkdf2":162,"./rng":163,buffer:147}],155:[function(e,f){function n(e,f){e[f>>5]|=128<<f%32,e[(f+64>>>9<<4)+14]=f;for(var n=1732584193,o=-271733879,p=-1732584194,s=271733878,y=0;y<e.length;y+=16){var c=n,a=o,r=p,w=s;n=d(n,o,p,s,e[y+0],7,-680876936),s=d(s,n,o,p,e[y+1],12,-389564586),p=d(p,s,n,o,e[y+2],17,606105819),o=d(o,p,s,n,e[y+3],22,-1044525330),n=d(n,o,p,s,e[y+4],7,-176418897),s=d(s,n,o,p,e[y+5],12,1200080426),p=d(p,s,n,o,e[y+6],17,-1473231341),o=d(o,p,s,n,e[y+7],22,-45705983),n=d(n,o,p,s,e[y+8],7,1770035416),s=d(s,n,o,p,e[y+9],12,-1958414417),p=d(p,s,n,o,e[y+10],17,-42063),o=d(o,p,s,n,e[y+11],22,-1990404162),n=d(n,o,p,s,e[y+12],7,1804603682),s=d(s,n,o,p,e[y+13],12,-40341101),p=d(p,s,n,o,e[y+14],17,-1502002290),o=d(o,p,s,n,e[y+15],22,1236535329),n=i(n,o,p,s,e[y+1],5,-165796510),s=i(s,n,o,p,e[y+6],9,-1069501632),p=i(p,s,n,o,e[y+11],14,643717713),o=i(o,p,s,n,e[y+0],20,-373897302),n=i(n,o,p,s,e[y+5],5,-701558691),s=i(s,n,o,p,e[y+10],9,38016083),p=i(p,s,n,o,e[y+15],14,-660478335),o=i(o,p,s,n,e[y+4],20,-405537848),n=i(n,o,p,s,e[y+9],5,568446438),s=i(s,n,o,p,e[y+14],9,-1019803690),p=i(p,s,n,o,e[y+3],14,-187363961),o=i(o,p,s,n,e[y+8],20,1163531501),n=i(n,o,p,s,e[y+13],5,-1444681467),s=i(s,n,o,p,e[y+2],9,-51403784),p=i(p,s,n,o,e[y+7],14,1735328473),o=i(o,p,s,n,e[y+12],20,-1926607734),n=t(n,o,p,s,e[y+5],4,-378558),s=t(s,n,o,p,e[y+8],11,-2022574463),p=t(p,s,n,o,e[y+11],16,1839030562),o=t(o,p,s,n,e[y+14],23,-35309556),n=t(n,o,p,s,e[y+1],4,-1530992060),s=t(s,n,o,p,e[y+4],11,1272893353),p=t(p,s,n,o,e[y+7],16,-155497632),o=t(o,p,s,n,e[y+10],23,-1094730640),n=t(n,o,p,s,e[y+13],4,681279174),s=t(s,n,o,p,e[y+0],11,-358537222),p=t(p,s,n,o,e[y+3],16,-722521979),o=t(o,p,s,n,e[y+6],23,76029189),n=t(n,o,p,s,e[y+9],4,-640364487),s=t(s,n,o,p,e[y+12],11,-421815835),p=t(p,s,n,o,e[y+15],16,530742520),o=t(o,p,s,n,e[y+2],23,-995338651),n=l(n,o,p,s,e[y+0],6,-198630844),s=l(s,n,o,p,e[y+7],10,1126891415),p=l(p,s,n,o,e[y+14],15,-1416354905),o=l(o,p,s,n,e[y+5],21,-57434055),n=l(n,o,p,s,e[y+12],6,1700485571),s=l(s,n,o,p,e[y+3],10,-1894986606),p=l(p,s,n,o,e[y+10],15,-1051523),o=l(o,p,s,n,e[y+1],21,-2054922799),n=l(n,o,p,s,e[y+8],6,1873313359),s=l(s,n,o,p,e[y+15],10,-30611744),p=l(p,s,n,o,e[y+6],15,-1560198380),o=l(o,p,s,n,e[y+13],21,1309151649),n=l(n,o,p,s,e[y+4],6,-145523070),s=l(s,n,o,p,e[y+11],10,-1120210379),p=l(p,s,n,o,e[y+2],15,718787259),o=l(o,p,s,n,e[y+9],21,-343485551),n=u(n,c),o=u(o,a),p=u(p,r),s=u(s,w)}return Array(n,o,p,s)}function o(e,f,n,o,d,i){return u(p(u(u(f,e),u(o,i)),d),n)}function d(e,f,n,d,i,t,l){return o(f&n|~f&d,e,f,i,t,l)}function i(e,f,n,d,i,t,l){return o(f&d|n&~d,e,f,i,t,l)}function t(e,f,n,d,i,t,l){return o(f^n^d,e,f,i,t,l)}function l(e,f,n,d,i,t,l){return o(n^(f|~d),e,f,i,t,l)}function u(e,f){var n=(65535&e)+(65535&f),o=(e>>16)+(f>>16)+(n>>16);return o<<16|65535&n}function p(e,f){return e<<f|e>>>32-f}var s=e("./helpers");f.exports=function(e){return s.hash(e,n,16)}},{"./helpers":153}],156:[function(e,f){(function(e){function n(e,f,n){return e^f^n}function o(e,f,n){return e&f|~e&n}function d(e,f,n){return(e|~f)^n}function i(e,f,n){return e&n|f&~n}function t(e,f,n){return e^(f|~n)}function l(e,f){return e<<f|e>>>32-f}function u(f){var n=[1732584193,4023233417,2562383102,271733878,3285377520];"string"==typeof f&&(f=new e(f,"utf8"));var o=w(f),d=8*f.length,i=8*f.length;o[d>>>5]|=128<<24-d%32,o[(d+64>>>9<<4)+14]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);for(var t=0;t<o.length;t+=16)m(n,o,t);for(var t=0;5>t;t++){var l=n[t];n[t]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var u=b(n);return new e(u)}f.exports=u;var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],s=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],y=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],c=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],a=[0,1518500249,1859775393,2400959708,2840853838],r=[1352829926,1548603684,1836072691,2053994217,0],w=function(e){for(var f=[],n=0,o=0;n<e.length;n++,o+=8)f[o>>>5]|=e[n]<<24-o%32;return f},b=function(e){for(var f=[],n=0;n<32*e.length;n+=8)f.push(e[n>>>5]>>>24-n%32&255);return f},m=function(e,f,u){for(var w=0;16>w;w++){var b=u+w,m=f[b];f[b]=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8)}var g,x,P,j,v,M,X,h,k,q;M=g=e[0],X=x=e[1],h=P=e[2],k=j=e[3],q=v=e[4];for(var z,w=0;80>w;w+=1)z=g+f[u+p[w]]|0,z+=16>w?n(x,P,j)+a[0]:32>w?o(x,P,j)+a[1]:48>w?d(x,P,j)+a[2]:64>w?i(x,P,j)+a[3]:t(x,P,j)+a[4],z=0|z,z=l(z,y[w]),z=z+v|0,g=v,v=j,j=l(P,10),P=x,x=z,z=M+f[u+s[w]]|0,z+=16>w?t(X,h,k)+r[0]:32>w?i(X,h,k)+r[1]:48>w?d(X,h,k)+r[2]:64>w?o(X,h,k)+r[3]:n(X,h,k)+r[4],z=0|z,z=l(z,c[w]),z=z+q|0,M=q,q=k,k=l(h,10),h=X,X=z;z=e[1]+P+k|0,e[1]=e[2]+j+q|0,e[2]=e[3]+v+M|0,e[3]=e[4]+g+X|0,e[4]=e[0]+x+h|0,e[0]=z}}).call(this,e("buffer").Buffer)},{buffer:147}],157:[function(e,f){var n=e("./util"),o=n.write,d=n.zeroFill;f.exports=function(e){function f(f,n){this._block=new e(f),this._finalSize=n,this._blockSize=f,this._len=0,this._s=0}function i(e,f){return null==f?e.byteLength||e.length:"ascii"==f||"binary"==f?e.length:"hex"==f?e.length/2:"base64"==f?e.length/3:void 0}return f.prototype.init=function(){this._s=0,this._len=0},f.prototype.update=function(f,n){var d,t=this._blockSize;n||"string"!=typeof f||(n="utf8"),n?("utf-8"===n&&(n="utf8"),("base64"===n||"utf8"===n)&&(f=new e(f,n),n=null),d=i(f,n)):d=f.byteLength||f.length;for(var l=this._len+=d,u=this._s=this._s||0,p=0,s=this._block;l>u;){var y=Math.min(d,p+t);o(s,f,n,u%t,p,y);var c=y-p;u+=c,p+=c,u%t||this._update(s)}return this._s=u,this},f.prototype.digest=function(e){var f=this._blockSize,o=this._finalSize,i=8*this._len,t=this._block,l=i%(8*f);t[this._len%f]=128,d(this._block,this._len%f+1),l>=8*o&&(this._update(this._block),n.zeroFill(this._block,0)),t.writeInt32BE(i,o+4);var u=this._update(this._block)||this._hash();return null==e?u:u.toString(e)},f.prototype._update=function(){throw new Error("_update must be implemented by subclass")},f}},{"./util":161}],158:[function(e,f,n){var n=f.exports=function(e){var f=n[e];if(!f)throw new Error(e+" is not supported (we accept pull requests)");return new f},o=e("buffer").Buffer,d=e("./hash")(o);n.sha=n.sha1=e("./sha1")(o,d),n.sha256=e("./sha256")(o,d)},{"./hash":157,"./sha1":159,"./sha256":160,buffer:147}],159:[function(e,f){f.exports=function(f,n){function o(){return w.length?w.pop().init():this instanceof o?(this._w=r,n.call(this,64,56),this._h=null,void this.init()):new o}function d(e,f,n,o){return 20>e?f&n|~f&o:40>e?f^n^o:60>e?f&n|f&o|n&o:f^n^o}function i(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function t(e,f){return e+f|0}function l(e,f){return e<<f|e>>>32-f}var u=e("util").inherits;u(o,n);var p=0,s=4,y=8,c=12,a=16,r=new Int32Array(80),w=[];o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,n.prototype.init.call(this),this},o.prototype._POOL=w;new f(1)instanceof DataView;return o.prototype._update=function(){{var e,f,n,o,u,p,s,y,c,a,r=this._block;this._h}e=p=this._a,f=s=this._b,n=y=this._c,o=c=this._d,u=a=this._e;for(var w=this._w,b=0;80>b;b++){var m=w[b]=16>b?r.readInt32BE(4*b):l(w[b-3]^w[b-8]^w[b-14]^w[b-16],1),g=t(t(l(e,5),d(b,f,n,o)),t(t(u,m),i(b)));u=o,o=n,n=l(f,30),f=e,e=g}this._a=t(e,p),this._b=t(f,s),this._c=t(n,y),this._d=t(o,c),this._e=t(u,a)},o.prototype._hash=function(){w.length<100&&w.push(this);var e=new f(20);return e.writeInt32BE(0|this._a,p),e.writeInt32BE(0|this._b,s),e.writeInt32BE(0|this._c,y),e.writeInt32BE(0|this._d,c),e.writeInt32BE(0|this._e,a),e},o}},{util:169}],160:[function(e,f){{var n=e("util").inherits;e("./util")}f.exports=function(e,f){function o(){r.length,this.init(),this._w=a,f.call(this,64,56)}function d(e,f){return e>>>f|e<<32-f}function i(e,f){return e>>>f}function t(e,f,n){return e&f^~e&n}function l(e,f,n){return e&f^e&n^f&n}function u(e){return d(e,2)^d(e,13)^d(e,22)}function p(e){return d(e,6)^d(e,11)^d(e,25)}function s(e){return d(e,7)^d(e,18)^i(e,3)}function y(e){return d(e,17)^d(e,19)^i(e,10)}var c=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];n(o,f);var a=new Array(64),r=[];o.prototype.init=function(){return this._a=1779033703,this._b=-1150833019,this._c=1013904242,this._d=-1521486534,this._e=1359893119,this._f=-1694144372,this._g=528734635,this._h=1541459225,this._len=this._s=0,this};return o.prototype._update=function(){var e,f,n,o,d,i,a,r,w,b,m=this._block,g=this._w;e=0|this._a,f=0|this._b,n=0|this._c,o=0|this._d,d=0|this._e,i=0|this._f,a=0|this._g,r=0|this._h;for(var x=0;64>x;x++){var P=g[x]=16>x?m.readInt32BE(4*x):y(g[x-2])+g[x-7]+s(g[x-15])+g[x-16];w=r+p(d)+t(d,i,a)+c[x]+P,b=u(e)+l(e,f,n),r=a,a=i,i=d,d=o+w,o=n,n=f,f=e,e=w+b}this._a=e+this._a|0,this._b=f+this._b|0,this._c=n+this._c|0,this._d=o+this._d|0,this._e=d+this._e|0,this._f=i+this._f|0,this._g=a+this._g|0,this._h=r+this._h|0},o.prototype._hash=function(){r.length<10&&r.push(this);var f=new e(32);return f.writeInt32BE(this._a,0),f.writeInt32BE(this._b,4),f.writeInt32BE(this._c,8),f.writeInt32BE(this._d,12),f.writeInt32BE(this._e,16),f.writeInt32BE(this._f,20),f.writeInt32BE(this._g,24),f.writeInt32BE(this._h,28),f},o}},{"./util":161,util:169}],161:[function(e,f,n){function o(e,f,n,o,d,i){var t=i-d;if("ascii"===n||"binary"===n)for(var l=0;t>l;l++)e[o+l]=f.charCodeAt(l+d);else if(null==n)for(var l=0;t>l;l++)e[o+l]=f[l+d];else{if("hex"!==n)throw new Error("base64"===n?"base64 encoding not yet supported":n+" encoding not yet supported");for(var l=0;t>l;l++){var u=d+l;e[o+l]=parseInt(f[2*u]+f[2*u+1],16)}}}function d(e,f){for(var n=f;n<e.length;n++)e[n]=0}n.write=o,n.zeroFill=d,n.toString=toString},{}],162:[function(e,f){(function(e){var n=64,o=new e(n);o.fill(0),f.exports=function(f,d){return d=d||{},d.pbkdf2=function(e,f,n,o,i){if("function"!=typeof i)throw new Error("No callback provided to pbkdf2");setTimeout(function(){i(null,d.pbkdf2Sync(e,f,n,o))})},d.pbkdf2Sync=function(d,i,t,l){if("number"!=typeof t)throw new TypeError("Iterations not a number");if(0>t)throw new TypeError("Bad iterations");if("number"!=typeof l)throw new TypeError("Key length not a number");if(0>l)throw new TypeError("Bad key length");var d=e.isBuffer(d)?d:new e(d);d.length>n?d=createHash(alg).update(d).digest():d.length<n&&(d=e.concat([d,o],n));var u,p,s,y=0,c=1,a=new e(4),r=new e(l);for(r.fill(0);l;){p=l>20?20:l,a[0]=c>>24&255,a[1]=c>>16&255,a[2]=c>>8&255,a[3]=255&c,u=f("sha1",d),u.update(i),u.update(a),s=u.digest(),s.copy(r,y,0,p);for(var w=1;t>w;w++){u=f("sha1",d),u.update(s),s=u.digest();for(var b=0;p>b;b++)r[b]^=s[b]}l-=p,c++,y+=p}return r},d}}).call(this,e("buffer").Buffer)},{buffer:147}],163:[function(e,f){(function(e){!function(){var n,o,d=this;n=function(f){for(var n,n,o=new e(f),d=0;f>d;d++)0==(3&d)&&(n=4294967296*Math.random()),o[d]=n>>>((3&d)<<3)&255;return o},d.crypto&&crypto.getRandomValues&&(o=function(f){var n=new e(f);return crypto.getRandomValues(n),n}),f.exports=o||n}()}).call(this,e("buffer").Buffer)},{buffer:147}],164:[function(e,f){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function d(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function t(e){return void 0===e}f.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!d(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var f,n,d,l,u,p;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(f=arguments[1],f instanceof Error)throw f;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],t(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,l=new Array(d-1),u=1;d>u;u++)l[u-1]=arguments[u];n.apply(this,l)}else if(i(n)){for(d=arguments.length,l=new Array(d-1),u=1;d>u;u++)l[u-1]=arguments[u];for(p=n.slice(),d=p.length,u=0;d>u;u++)p[u].apply(this,l)}return!0},n.prototype.addListener=function(e,f){var d;if(!o(f))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(f.listener)?f.listener:f),this._events[e]?i(this._events[e])?this._events[e].push(f):this._events[e]=[this._events[e],f]:this._events[e]=f,i(this._events[e])&&!this._events[e].warned){var d;d=t(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,d&&d>0&&this._events[e].length>d&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,f){function n(){this.removeListener(e,n),d||(d=!0,f.apply(this,arguments))}if(!o(f))throw TypeError("listener must be a function");var d=!1;return n.listener=f,this.on(e,n),this},n.prototype.removeListener=function(e,f){var n,d,t,l;if(!o(f))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],t=n.length,d=-1,n===f||o(n.listener)&&n.listener===f)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,f);else if(i(n)){for(l=t;l-->0;)if(n[l]===f||n[l].listener&&n[l].listener===f){d=l;break}if(0>d)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(d,1),this._events.removeListener&&this.emit("removeListener",e,f)}return this},n.prototype.removeAllListeners=function(e){var f,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(f in this._events)"removeListener"!==f&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],o(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var f;return f=this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,f){var n;return n=e._events&&e._events[f]?o(e._events[f])?1:e._events[f].length:0}},{}],165:[function(e,f){f.exports="function"==typeof Object.create?function(e,f){e.super_=f,e.prototype=Object.create(f.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,f){e.super_=f;var n=function(){};n.prototype=f.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],166:[function(e,f){function n(){}var o=f.exports={};o.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,f="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(f){var n=[];return window.addEventListener("message",function(e){var f=e.source;if((f===window||null===f)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var o=n.shift();o()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=n,o.addListener=n,o.once=n,o.off=n,o.removeListener=n,o.removeAllListeners=n,o.emit=n,o.binding=function(){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(){throw new Error("process.chdir is not supported")}},{}],167:[function(f,n,o){(function(f){!function(d){function i(e){throw RangeError(F[e])}function t(e,f){for(var n=e.length;n--;)e[n]=f(e[n]);return e}function l(e,f){return t(e.split(E),f).join(".")}function u(e){for(var f,n,o=[],d=0,i=e.length;i>d;)f=e.charCodeAt(d++),f>=55296&&56319>=f&&i>d?(n=e.charCodeAt(d++),56320==(64512&n)?o.push(((1023&f)<<10)+(1023&n)+65536):(o.push(f),d--)):o.push(f);return o}function p(e){return t(e,function(e){var f="";return e>65535&&(e-=65536,f+=I(e>>>10&1023|55296),e=56320|1023&e),f+=I(e)}).join("")}function s(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:M}function y(e,f){return e+22+75*(26>e)-((0!=f)<<5)}function c(e,f,n){var o=0;for(e=n?H(e/q):e>>1,e+=H(e/f);e>G*h>>1;o+=M)e=H(e/G);return H(o+(G+1)*e/(e+k))}function a(e){var f,n,o,d,t,l,u,y,a,r,w=[],b=e.length,m=0,g=A,x=z;for(n=e.lastIndexOf(B),0>n&&(n=0),o=0;n>o;++o)e.charCodeAt(o)>=128&&i("not-basic"),w.push(e.charCodeAt(o));for(d=n>0?n+1:0;b>d;){for(t=m,l=1,u=M;d>=b&&i("invalid-input"),y=s(e.charCodeAt(d++)),(y>=M||y>H((v-m)/l))&&i("overflow"),m+=y*l,a=x>=u?X:u>=x+h?h:u-x,!(a>y);u+=M)r=M-a,l>H(v/r)&&i("overflow"),l*=r;
f=w.length+1,x=c(m-t,f,0==t),H(m/f)>v-g&&i("overflow"),g+=H(m/f),m%=f,w.splice(m++,0,g)}return p(w)}function r(e){var f,n,o,d,t,l,p,s,a,r,w,b,m,g,x,P=[];for(e=u(e),b=e.length,f=A,n=0,t=z,l=0;b>l;++l)w=e[l],128>w&&P.push(I(w));for(o=d=P.length,d&&P.push(B);b>o;){for(p=v,l=0;b>l;++l)w=e[l],w>=f&&p>w&&(p=w);for(m=o+1,p-f>H((v-n)/m)&&i("overflow"),n+=(p-f)*m,f=p,l=0;b>l;++l)if(w=e[l],f>w&&++n>v&&i("overflow"),w==f){for(s=n,a=M;r=t>=a?X:a>=t+h?h:a-t,!(r>s);a+=M)x=s-r,g=M-r,P.push(I(y(r+x%g,0))),s=H(x/g);P.push(I(y(s,0))),t=c(n,m,o==d),n=0,++o}++n,++f}return P.join("")}function w(e){return l(e,function(e){return C.test(e)?a(e.slice(4).toLowerCase()):e})}function b(e){return l(e,function(e){return D.test(e)?"xn--"+r(e):e})}var m="object"==typeof o&&o,g="object"==typeof n&&n&&n.exports==m&&n,x="object"==typeof f&&f;(x.global===x||x.window===x)&&(d=x);var P,j,v=2147483647,M=36,X=1,h=26,k=38,q=700,z=72,A=128,B="-",C=/^xn--/,D=/[^ -~]/,E=/\x2E|\u3002|\uFF0E|\uFF61/g,F={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},G=M-X,H=Math.floor,I=String.fromCharCode;if(P={version:"1.2.4",ucs2:{decode:u,encode:p},decode:a,encode:r,toASCII:b,toUnicode:w},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return P});else if(m&&!m.nodeType)if(g)g.exports=P;else for(j in P)P.hasOwnProperty(j)&&(m[j]=P[j]);else d.punycode=P}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],168:[function(e,f){f.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],169:[function(e,f,n){(function(f,o){function d(e,f){var o={seen:[],stylize:t};return arguments.length>=3&&(o.depth=arguments[2]),arguments.length>=4&&(o.colors=arguments[3]),w(f)?o.showHidden=f:f&&n._extend(o,f),j(o.showHidden)&&(o.showHidden=!1),j(o.depth)&&(o.depth=2),j(o.colors)&&(o.colors=!1),j(o.customInspect)&&(o.customInspect=!0),o.colors&&(o.stylize=i),u(o,e,o.depth)}function i(e,f){var n=d.styles[f];return n?"["+d.colors[n][0]+"m"+e+"["+d.colors[n][1]+"m":e}function t(e){return e}function l(e){var f={};return e.forEach(function(e){f[e]=!0}),f}function u(e,f,o){if(e.customInspect&&f&&k(f.inspect)&&f.inspect!==n.inspect&&(!f.constructor||f.constructor.prototype!==f)){var d=f.inspect(o,e);return x(d)||(d=u(e,d,o)),d}var i=p(e,f);if(i)return i;var t=Object.keys(f),w=l(t);if(e.showHidden&&(t=Object.getOwnPropertyNames(f)),h(f)&&(t.indexOf("message")>=0||t.indexOf("description")>=0))return s(f);if(0===t.length){if(k(f)){var b=f.name?": "+f.name:"";return e.stylize("[Function"+b+"]","special")}if(v(f))return e.stylize(RegExp.prototype.toString.call(f),"regexp");if(X(f))return e.stylize(Date.prototype.toString.call(f),"date");if(h(f))return s(f)}var m="",g=!1,P=["{","}"];if(r(f)&&(g=!0,P=["[","]"]),k(f)){var j=f.name?": "+f.name:"";m=" [Function"+j+"]"}if(v(f)&&(m=" "+RegExp.prototype.toString.call(f)),X(f)&&(m=" "+Date.prototype.toUTCString.call(f)),h(f)&&(m=" "+s(f)),0===t.length&&(!g||0==f.length))return P[0]+m+P[1];if(0>o)return v(f)?e.stylize(RegExp.prototype.toString.call(f),"regexp"):e.stylize("[Object]","special");e.seen.push(f);var M;return M=g?y(e,f,o,w,t):t.map(function(n){return c(e,f,o,w,n,g)}),e.seen.pop(),a(M,m,P)}function p(e,f){if(j(f))return e.stylize("undefined","undefined");if(x(f)){var n="'"+JSON.stringify(f).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(f)?e.stylize(""+f,"number"):w(f)?e.stylize(""+f,"boolean"):b(f)?e.stylize("null","null"):void 0}function s(e){return"["+Error.prototype.toString.call(e)+"]"}function y(e,f,n,o,d){for(var i=[],t=0,l=f.length;l>t;++t)i.push(C(f,String(t))?c(e,f,n,o,String(t),!0):"");return d.forEach(function(d){d.match(/^\d+$/)||i.push(c(e,f,n,o,d,!0))}),i}function c(e,f,n,o,d,i){var t,l,p;if(p=Object.getOwnPropertyDescriptor(f,d)||{value:f[d]},p.get?l=p.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):p.set&&(l=e.stylize("[Setter]","special")),C(o,d)||(t="["+d+"]"),l||(e.seen.indexOf(p.value)<0?(l=b(n)?u(e,p.value,null):u(e,p.value,n-1),l.indexOf("\n")>-1&&(l=i?l.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+l.split("\n").map(function(e){return"   "+e}).join("\n"))):l=e.stylize("[Circular]","special")),j(t)){if(i&&d.match(/^\d+$/))return l;t=JSON.stringify(""+d),t.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(t=t.substr(1,t.length-2),t=e.stylize(t,"name")):(t=t.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t=e.stylize(t,"string"))}return t+": "+l}function a(e,f,n){var o=0,d=e.reduce(function(e,f){return o++,f.indexOf("\n")>=0&&o++,e+f.replace(/\u001b\[\d\d?m/g,"").length+1},0);return d>60?n[0]+(""===f?"":f+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+f+" "+e.join(", ")+" "+n[1]}function r(e){return Array.isArray(e)}function w(e){return"boolean"==typeof e}function b(e){return null===e}function m(e){return null==e}function g(e){return"number"==typeof e}function x(e){return"string"==typeof e}function P(e){return"symbol"==typeof e}function j(e){return void 0===e}function v(e){return M(e)&&"[object RegExp]"===z(e)}function M(e){return"object"==typeof e&&null!==e}function X(e){return M(e)&&"[object Date]"===z(e)}function h(e){return M(e)&&("[object Error]"===z(e)||e instanceof Error)}function k(e){return"function"==typeof e}function q(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function z(e){return Object.prototype.toString.call(e)}function A(e){return 10>e?"0"+e.toString(10):e.toString(10)}function B(){var e=new Date,f=[A(e.getHours()),A(e.getMinutes()),A(e.getSeconds())].join(":");return[e.getDate(),G[e.getMonth()],f].join(" ")}function C(e,f){return Object.prototype.hasOwnProperty.call(e,f)}var D=/%[sdj%]/g;n.format=function(e){if(!x(e)){for(var f=[],n=0;n<arguments.length;n++)f.push(d(arguments[n]));return f.join(" ")}for(var n=1,o=arguments,i=o.length,t=String(e).replace(D,function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":try{return JSON.stringify(o[n++])}catch(f){return"[Circular]"}default:return e}}),l=o[n];i>n;l=o[++n])t+=b(l)||!M(l)?" "+l:" "+d(l);return t},n.deprecate=function(e,d){function i(){if(!t){if(f.throwDeprecation)throw new Error(d);f.traceDeprecation?console.trace(d):console.error(d),t=!0}return e.apply(this,arguments)}if(j(o.process))return function(){return n.deprecate(e,d).apply(this,arguments)};if(f.noDeprecation===!0)return e;var t=!1;return i};var E,F={};n.debuglog=function(e){if(j(E)&&(E=f.env.NODE_DEBUG||""),e=e.toUpperCase(),!F[e])if(new RegExp("\\b"+e+"\\b","i").test(E)){var o=f.pid;F[e]=function(){var f=n.format.apply(n,arguments);console.error("%s %d: %s",e,o,f)}}else F[e]=function(){};return F[e]},n.inspect=d,d.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=r,n.isBoolean=w,n.isNull=b,n.isNullOrUndefined=m,n.isNumber=g,n.isString=x,n.isSymbol=P,n.isUndefined=j,n.isRegExp=v,n.isObject=M,n.isDate=X,n.isError=h,n.isFunction=k,n.isPrimitive=q,n.isBuffer=e("./support/isBuffer");var G=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",B(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,f){if(!f||!M(f))return e;for(var n=Object.keys(f),o=n.length;o--;)e[n[o]]=f[n[o]];return e}}).call(this,e("FWaASH"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":168,FWaASH:166,inherits:165}],170:[function(e,f){(function(e){!function(){"use strict";function n(f){var n;return n=f instanceof e?f:new e(f.toString(),"binary"),n.toString("base64")}f.exports=n}()}).call(this,e("buffer").Buffer)},{buffer:147}],171:[function(e,f){"use strict";var n=e("bluebird"),o=n.promisify(e("request")),d=e("jxt").createRegistry();d.use(e("./lib/xrd")),f.exports=function(e,f){"string"==typeof e&&(e={host:e});var i={ssl:!0,json:!0,xrd:!0};for(var t in e)i[t]=e[t];var l=i.ssl?"https://":"http://",u=new n(function(e,f){o(l+i.host+"/.well-known/host-meta.json").spread(function(f,n){e(JSON.parse(n))}).catch(f)}),p=new n(function(e,f){o(l+i.host+"/.well-known/host-meta").spread(function(f,n){var o=d.parse(n);e(o.toJSON())}).catch(f)});return new n(function(e,f){n.some([u,p],1).spread(e).catch(function(){f("no-host-meta")})}).nodeify(f)}},{"./lib/xrd":172,bluebird:112,jxt:210,request:173}],172:[function(e,f){"use strict";var n=e("jxt"),o="http://docs.oasis-open.org/ns/xri/xrd-1.0";f.exports=function(e){var f={get:function(){for(var e={},f=n.find(this.xml,o,"Property"),d=0,i=f.length;i>d;d++){var t=f[d],l=n.getAttribute(t,"type");e[l]=t.textContent}return e}},d=e.define({name:"xrd",namespace:o,element:"XRD",fields:{subject:n.subText(o,"Subject"),expires:n.dateSub(o,"Expires"),aliases:n.multiSubText(o,"Alias"),properties:f}}),i=e.define({name:"_xrdlink",namespace:o,element:"Link",fields:{rel:n.attribute("rel"),href:n.attribute("href"),type:n.attribute("type"),template:n.attribute("template"),titles:n.subLangText(o,"Title","default"),properties:f}});return e.extend(d,i,"links"),d}},{jxt:210}],173:[function(e,f){function n(e,f){if("function"!=typeof f)throw new Error("Bad callback given: "+f);if(!e)throw new Error("No options given");var t=e.onResponse;if(e="string"==typeof e?{uri:e}:JSON.parse(JSON.stringify(e)),e.onResponse=t,e.verbose&&(n.log=i()),e.url&&(e.uri=e.url,delete e.url),!e.uri&&""!==e.uri)throw new Error("options.uri is a required argument");if("string"!=typeof e.uri)throw new Error("options.uri must be a string");for(var l=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],p=0;p<l.length;p++)if(e[l[p]])throw new Error("options."+l[p]+" is not supported");if(e.callback=f,e.method=e.method||"GET",e.headers=e.headers||{},e.body=e.body||null,e.timeout=e.timeout||n.DEFAULT_TIMEOUT,e.headers.host)throw new Error("Options.headers.host is not supported");return e.json&&(e.headers.accept=e.headers.accept||"application/json","GET"!==e.method&&(e.headers["content-type"]="application/json"),"boolean"!=typeof e.json?e.body=JSON.stringify(e.json):"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.onResponse=e.onResponse||d,e.onResponse===!0&&(e.onResponse=f,e.callback=d),!e.headers.authorization&&e.auth&&(e.headers.authorization="Basic "+u(e.auth.username+":"+e.auth.password)),o(e)}function o(e){function f(){s=!0;var f=new Error("ETIMEDOUT");return f.code="ETIMEDOUT",f.duration=e.timeout,n.log.error("Timeout",{id:u._id,milliseconds:e.timeout}),e.callback(f,u)}function o(){if(s)return n.log.debug("Ignoring timed out state change",{state:u.readyState,id:u.id});if(n.log.debug("State change",{state:u.readyState,id:u.id,timed_out:s}),u.readyState===p.OPENED){n.log.debug("Request started",{id:u.id});for(var f in e.headers)u.setRequestHeader(f,e.headers[f])}else u.readyState===p.HEADERS_RECEIVED?d():u.readyState===p.LOADING?(d(),i()):u.readyState===p.DONE&&(d(),i(),t())}function d(){if(!w.response){if(w.response=!0,n.log.debug("Got response",{id:u.id,status:u.status}),clearTimeout(u.timeoutTimer),u.statusCode=u.status,c&&0==u.statusCode){var f=new Error("CORS request rejected: "+e.uri);return f.cors="rejected",w.loading=!0,w.end=!0,e.callback(f,u)}e.onResponse(null,u)}}function i(){w.loading||(w.loading=!0,n.log.debug("Response body loading",{id:u.id}))}function t(){if(!w.end){if(w.end=!0,n.log.debug("Request done",{id:u.id}),u.body=u.responseText,e.json)try{u.body=JSON.parse(u.responseText)}catch(f){return e.callback(f,u)}e.callback(null,u,u.body)}}var u=new p,s=!1,c=l(e.uri),a="withCredentials"in u;if(y+=1,u.seq_id=y,u.id=y+": "+e.method+" "+e.uri,u._id=u.id,c&&!a){var r=new Error("Browser does not support cross-origin request: "+e.uri);return r.cors="unsupported",e.callback(r,u)}u.timeoutTimer=setTimeout(f,e.timeout);var w={response:!1,loading:!1,end:!1};return u.onreadystatechange=o,u.open(e.method,e.uri,!0),c&&(u.withCredentials=!!e.withCredentials),u.send(e.body),u}function d(){}function i(){var e,f,n={},o=["trace","debug","info","warn","error"];for(f=0;f<o.length;f++)e=o[f],n[e]=d,"undefined"!=typeof console&&console&&console[e]&&(n[e]=t(console,e));return n}function t(e,f){function n(n,o){return"object"==typeof o&&(n+=" "+JSON.stringify(o)),e[f].call(e,n)}return n}function l(e){var f,n=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{f=location.href}catch(o){f=document.createElement("a"),f.href="",f=f.href}var d=n.exec(f.toLowerCase())||[],i=n.exec(e.toLowerCase()),t=!(!i||i[1]==d[1]&&i[2]==d[2]&&(i[3]||("http:"===i[1]?80:443))==(d[3]||("http:"===d[1]?80:443)));return t}function u(e){var f,n,o,d,i,t,l,u,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,y=0,c="",a=[];if(!e)return e;do f=e.charCodeAt(s++),n=e.charCodeAt(s++),o=e.charCodeAt(s++),u=f<<16|n<<8|o,d=u>>18&63,i=u>>12&63,t=u>>6&63,l=63&u,a[y++]=p.charAt(d)+p.charAt(i)+p.charAt(t)+p.charAt(l);while(s<e.length);switch(c=a.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}var p=XMLHttpRequest;if(!p)throw new Error("missing XMLHttpRequest");f.exports=n,n.log={trace:d,debug:d,info:d,warn:d,error:d};var s=18e4,y=0;n.withCredentials=!1,n.DEFAULT_TIMEOUT=s,n.defaults=function(e){var f=function(f){var n=function(n,o){n="string"==typeof n?{uri:n}:JSON.parse(JSON.stringify(n));for(var d in e)void 0===n[d]&&(n[d]=e[d]);return f(n,o)};return n},o=f(n);return o.get=f(n.get),o.post=f(n.post),o.put=f(n.put),o.head=f(n.head),o};var c=["get","put","post","head"];c.forEach(function(e){var f=e.toUpperCase(),o=e.toLowerCase();n[o]=function(e){"string"==typeof e?e={method:f,uri:e}:(e=JSON.parse(JSON.stringify(e)),e.method=f);var o=[e].concat(Array.prototype.slice.apply(arguments,[1]));return n.apply(this,o)}}),n.couch=function(e,f){function o(e,n,o){if(e)return f(e,n,o);if((n.statusCode<200||n.statusCode>299)&&o.error){e=new Error("CouchDB error: "+(o.error.reason||o.error.error));for(var d in o)e[d]=o[d];return f(e,n,o)}return f(e,n,o)}"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,f=f||d;var i=n(e,o);return i}},{}],174:[function(e,f,n){var o=e("crypto"),d={md2:"md2",md5:"md5","sha-1":"sha1","sha-224":"sha224","sha-256":"sha256","sha-384":"sha384","sha-512":"sha512"},i=Object.keys(d);n.getHashes=function(){for(var e=[],f=o.getHashes(),n=0,t=i.length;t>n;n++)f.indexOf(d[i[n]])>=0&&e.push(i[n]);return e},n.createHash=function(e){return e=e.toLowerCase(),d[e]&&(e=d[e]),o.createHash(e)},n.createHmac=function(e,f){return e=e.toLowerCase(),d[e]&&(e=d[e]),o.createHmac(e,f)}},{crypto:178}],175:[function(e,f,n){arguments[4][151][0].apply(n,arguments)},{"./md5":179,buffer:147,ripemd160:182,"sha.js":184}],176:[function(e,f){(function(n){function o(e,f){if(!(this instanceof o))return new o(e,f);this._opad=u,this._alg=e;var t="sha512"===e?128:64;f=this._key=n.isBuffer(f)?f:new n(f),f.length>t?f=d(e).update(f).digest():f.length<t&&(f=n.concat([f,i],t));for(var l=this._ipad=new n(t),u=this._opad=new n(t),p=0;t>p;p++)l[p]=54^f[p],u[p]=92^f[p];this._hash=d(e).update(l)}var d=e("./create-hash"),i=new n(128);i.fill(0),f.exports=o,o.prototype.update=function(e,f){return this._hash.update(e,f),this},o.prototype.digest=function(e){var f=this._hash.digest();return d(this._alg).update(this._opad).update(f).digest(e)}}).call(this,e("buffer").Buffer)},{"./create-hash":175,buffer:147}],177:[function(e,f){f.exports=e(153)},{buffer:147}],178:[function(e,f,n){(function(f){function o(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}function d(e,f){for(var n in e)f(e[n],n)}var i=e("./rng");n.createHash=e("./create-hash"),n.createHmac=e("./create-hmac"),n.randomBytes=function(e,n){if(!n||!n.call)return new f(i(e));try{n.call(this,void 0,new f(i(e)))}catch(o){n(o)}},n.getHashes=function(){return["sha1","sha256","sha512","md5","rmd160"]};var t=e("./pbkdf2")(n);n.pbkdf2=t.pbkdf2,n.pbkdf2Sync=t.pbkdf2Sync,d(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman"],function(e){n[e]=function(){o("sorry,",e,"is not implemented yet")}})}).call(this,e("buffer").Buffer)},{"./create-hash":175,"./create-hmac":176,"./pbkdf2":188,"./rng":189,buffer:147}],179:[function(e,f){f.exports=e(155)},{"./helpers":177}],180:[function(e,f){var n=e("crypto"),o=e("./pbkdf2"),d=o(n);f.exports={pbkdf2:d.pbkdf2,pbkdf2Sync:d.pbkdf2Sync,__pbkdf2Export:o}},{"./pbkdf2":181,crypto:154}],181:[function(e,f){(function(e){f.exports=function(f){function n(e,f,n,d,i,t){if("function"==typeof i&&(t=i,i=void 0),"function"!=typeof t)throw new Error("No callback provided to pbkdf2");setTimeout(function(){var l;try{l=o(e,f,n,d,i)}catch(u){return t(u)}t(void 0,l)})}function o(n,o,d,i,t){if("number"!=typeof d)throw new TypeError("Iterations not a number");if(0>d)throw new TypeError("Bad iterations");if("number"!=typeof i)throw new TypeError("Key length not a number");if(0>i)throw new TypeError("Bad key length");t=t||"sha1",e.isBuffer(n)||(n=new e(n)),e.isBuffer(o)||(o=new e(o));var l,u,p,s=1,y=new e(i),c=new e(o.length+4);o.copy(c,0,0,o.length);for(var a=1;s>=a;a++){c.writeUInt32BE(a,o.length);var r=f.createHmac(t,n).update(c).digest();if(!l&&(l=r.length,p=new e(l),s=Math.ceil(i/l),u=i-(s-1)*l,i>(Math.pow(2,32)-1)*l))throw new TypeError("keylen exceeds maximum length");r.copy(p,0,0,l);for(var w=1;d>w;w++){r=f.createHmac(t,n).update(r).digest();for(var b=0;l>b;b++)p[b]^=r[b]}var m=(a-1)*l,g=a==s?u:l;p.copy(y,m,0,g)}return y}return{pbkdf2:n,pbkdf2Sync:o}}}).call(this,e("buffer").Buffer)},{buffer:147}],182:[function(e,f){f.exports=e(156)},{buffer:147}],183:[function(e,f){f.exports=function(e){function f(f,n){this._block=new e(f),this._finalSize=n,this._blockSize=f,this._len=0,this._s=0}return f.prototype.init=function(){this._s=0,this._len=0},f.prototype.update=function(f,n){"string"==typeof f&&(n=n||"utf8",f=new e(f,n));for(var o=this._len+=f.length,d=this._s=this._s||0,i=0,t=this._block;o>d;){for(var l=Math.min(f.length,i+this._blockSize-d%this._blockSize),u=l-i,p=0;u>p;p++)t[d%this._blockSize+p]=f[p+i];d+=u,i+=u,d%this._blockSize===0&&this._update(t)}return this._s=d,this},f.prototype.digest=function(e){var f=8*this._len;this._block[this._len%this._blockSize]=128,this._block.fill(0,this._len%this._blockSize+1),f%(8*this._blockSize)>=8*this._finalSize&&(this._update(this._block),this._block.fill(0)),this._block.writeInt32BE(f,this._blockSize-4);var n=this._update(this._block)||this._hash();return e?n.toString(e):n},f.prototype._update=function(){throw new Error("_update must be implemented by subclass")},f}},{}],184:[function(e,f,n){var n=f.exports=function(e){var f=n[e];if(!f)throw new Error(e+" is not supported (we accept pull requests)");return new f},o=e("buffer").Buffer,d=e("./hash")(o);n.sha1=e("./sha1")(o,d),n.sha256=e("./sha256")(o,d),n.sha512=e("./sha512")(o,d)},{"./hash":183,"./sha1":185,"./sha256":186,"./sha512":187,buffer:147}],185:[function(e,f){var n=e("util").inherits;f.exports=function(e,f){function o(){return r.length?r.pop().init():this instanceof o?(this._w=a,f.call(this,64,56),this._h=null,void this.init()):new o}function d(e,f,n,o){return 20>e?f&n|~f&o:40>e?f^n^o:60>e?f&n|f&o|n&o:f^n^o}function i(e){return 20>e?1518500249:40>e?1859775393:60>e?-1894007588:-899497514}function t(e,f){return e+f|0}function l(e,f){return e<<f|e>>>32-f}var u=0,p=4,s=8,y=12,c=16,a=new("undefined"==typeof Int32Array?Array:Int32Array)(80),r=[];return n(o,f),o.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,f.prototype.init.call(this),this},o.prototype._POOL=r,o.prototype._update=function(e){var f,n,o,u,p,s,y,c,a,r;f=s=this._a,n=y=this._b,o=c=this._c,u=a=this._d,p=r=this._e;for(var w=this._w,b=0;80>b;b++){var m=w[b]=16>b?e.readInt32BE(4*b):l(w[b-3]^w[b-8]^w[b-14]^w[b-16],1),g=t(t(l(f,5),d(b,n,o,u)),t(t(p,m),i(b)));p=u,u=o,o=l(n,30),n=f,f=g}this._a=t(f,s),this._b=t(n,y),this._c=t(o,c),this._d=t(u,a),this._e=t(p,r)},o.prototype._hash=function(){r.length<100&&r.push(this);var f=new e(20);return f.writeInt32BE(0|this._a,u),f.writeInt32BE(0|this._b,p),f.writeInt32BE(0|this._c,s),f.writeInt32BE(0|this._d,y),f.writeInt32BE(0|this._e,c),f},o}},{util:169}],186:[function(e,f){var n=e("util").inherits;f.exports=function(e,f){function o(){this.init(),this._w=a,f.call(this,64,56)}function d(e,f){return e>>>f|e<<32-f}function i(e,f){return e>>>f}function t(e,f,n){return e&f^~e&n}function l(e,f,n){return e&f^e&n^f&n}function u(e){return d(e,2)^d(e,13)^d(e,22)}function p(e){return d(e,6)^d(e,11)^d(e,25)}function s(e){return d(e,7)^d(e,18)^i(e,3)}function y(e){return d(e,17)^d(e,19)^i(e,10)}var c=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=new Array(64);return n(o,f),o.prototype.init=function(){return this._a=1779033703,this._b=-1150833019,this._c=1013904242,this._d=-1521486534,this._e=1359893119,this._f=-1694144372,this._g=528734635,this._h=1541459225,this._len=this._s=0,this},o.prototype._update=function(e){var f,n,o,d,i,a,r,w,b,m,g=this._w;f=0|this._a,n=0|this._b,o=0|this._c,d=0|this._d,i=0|this._e,a=0|this._f,r=0|this._g,w=0|this._h;for(var x=0;64>x;x++){var P=g[x]=16>x?e.readInt32BE(4*x):y(g[x-2])+g[x-7]+s(g[x-15])+g[x-16];b=w+p(i)+t(i,a,r)+c[x]+P,m=u(f)+l(f,n,o),w=r,r=a,a=i,i=d+b,d=o,o=n,n=f,f=b+m}this._a=f+this._a|0,this._b=n+this._b|0,this._c=o+this._c|0,this._d=d+this._d|0,this._e=i+this._e|0,this._f=a+this._f|0,this._g=r+this._g|0,this._h=w+this._h|0},o.prototype._hash=function(){var f=new e(32);return f.writeInt32BE(this._a,0),f.writeInt32BE(this._b,4),f.writeInt32BE(this._c,8),f.writeInt32BE(this._d,12),f.writeInt32BE(this._e,16),f.writeInt32BE(this._f,20),f.writeInt32BE(this._g,24),f.writeInt32BE(this._h,28),f},o}},{util:169}],187:[function(e,f){var n=e("util").inherits;f.exports=function(e,f){function o(){this.init(),this._w=u,f.call(this,128,112)}function d(e,f,n){return e>>>n|f<<32-n}function i(e,f,n){return e&f^~e&n}function t(e,f,n){return e&f^e&n^f&n}var l=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],u=new Array(160);return n(o,f),o.prototype.init=function(){return this._a=1779033703,this._b=-1150833019,this._c=1013904242,this._d=-1521486534,this._e=1359893119,this._f=-1694144372,this._g=528734635,this._h=1541459225,this._al=-205731576,this._bl=-2067093701,this._cl=-23791573,this._dl=1595750129,this._el=-1377402159,this._fl=725511199,this._gl=-79577749,this._hl=327033209,this._len=this._s=0,this},o.prototype._update=function(e){var f,n,o,u,p,s,y,c,a,r,w,b,m,g,x,P,j=this._w;f=0|this._a,n=0|this._b,o=0|this._c,u=0|this._d,p=0|this._e,s=0|this._f,y=0|this._g,c=0|this._h,a=0|this._al,r=0|this._bl,w=0|this._cl,b=0|this._dl,m=0|this._el,g=0|this._fl,x=0|this._gl,P=0|this._hl;for(var v=0;80>v;v++){var M,X,h=2*v;if(16>v)M=j[h]=e.readInt32BE(4*h),X=j[h+1]=e.readInt32BE(4*h+4);else{var k=j[h-30],q=j[h-30+1],z=d(k,q,1)^d(k,q,8)^k>>>7,A=d(q,k,1)^d(q,k,8)^d(q,k,7);k=j[h-4],q=j[h-4+1];var B=d(k,q,19)^d(q,k,29)^k>>>6,C=d(q,k,19)^d(k,q,29)^d(q,k,6),D=j[h-14],E=j[h-14+1],F=j[h-32],G=j[h-32+1];X=A+E,M=z+D+(A>>>0>X>>>0?1:0),X+=C,M=M+B+(C>>>0>X>>>0?1:0),X+=G,M=M+F+(G>>>0>X>>>0?1:0),j[h]=M,j[h+1]=X}var H=t(f,n,o),I=t(a,r,w),J=d(f,a,28)^d(a,f,2)^d(a,f,7),K=d(a,f,28)^d(f,a,2)^d(f,a,7),L=d(p,m,14)^d(p,m,18)^d(m,p,9),N=d(m,p,14)^d(m,p,18)^d(p,m,9),O=l[h],Q=l[h+1],R=i(p,s,y),S=i(m,g,x),T=P+N,U=c+L+(P>>>0>T>>>0?1:0);T+=S,U=U+R+(S>>>0>T>>>0?1:0),T+=Q,U=U+O+(Q>>>0>T>>>0?1:0),T+=X,U=U+M+(X>>>0>T>>>0?1:0);var V=K+I,W=J+H+(K>>>0>V>>>0?1:0);c=y,P=x,y=s,x=g,s=p,g=m,m=b+T|0,p=u+U+(b>>>0>m>>>0?1:0)|0,u=o,b=w,o=n,w=r,n=f,r=a,a=T+V|0,f=U+W+(T>>>0>a>>>0?1:0)|0}this._al=this._al+a|0,this._bl=this._bl+r|0,this._cl=this._cl+w|0,this._dl=this._dl+b|0,this._el=this._el+m|0,this._fl=this._fl+g|0,this._gl=this._gl+x|0,this._hl=this._hl+P|0,this._a=this._a+f+(this._al>>>0<a>>>0?1:0)|0,this._b=this._b+n+(this._bl>>>0<r>>>0?1:0)|0,this._c=this._c+o+(this._cl>>>0<w>>>0?1:0)|0,this._d=this._d+u+(this._dl>>>0<b>>>0?1:0)|0,this._e=this._e+p+(this._el>>>0<m>>>0?1:0)|0,this._f=this._f+s+(this._fl>>>0<g>>>0?1:0)|0,this._g=this._g+y+(this._gl>>>0<x>>>0?1:0)|0,this._h=this._h+c+(this._hl>>>0<P>>>0?1:0)|0},o.prototype._hash=function(){function f(e,f,o){n.writeInt32BE(e,o),n.writeInt32BE(f,o+4)}var n=new e(64);return f(this._a,this._al,0),f(this._b,this._bl,8),f(this._c,this._cl,16),f(this._d,this._dl,24),f(this._e,this._el,32),f(this._f,this._fl,40),f(this._g,this._gl,48),f(this._h,this._hl,56),n},o}},{util:169}],188:[function(e,f){var n=e("pbkdf2-compat").__pbkdf2Export;f.exports=function(e,f){f=f||{};var o=n(e);return f.pbkdf2=o.pbkdf2,f.pbkdf2Sync=o.pbkdf2Sync,f}},{"pbkdf2-compat":180}],189:[function(e,f){(function(n,o){!function(){var d=("undefined"==typeof window?n:window)||{},i=e;_crypto=d.crypto||d.msCrypto||i("crypto"),f.exports=function(e){if(_crypto.getRandomValues){var f=new o(e);return _crypto.getRandomValues(f),f}if(_crypto.randomBytes)return _crypto.randomBytes(e);throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{buffer:147}],190:[function(e,f){f.exports=e("./lib/sessionManager")},{"./lib/sessionManager":194}],191:[function(e,f){function n(e){t.call(this,e);var f=this,n=this.parent.config.peerConnectionConfig,o=this.parent.config.peerConnectionConstraints;n.useJingle=!0,this.pc=new l(n,o),this.pc.on("addChannel",this._onChannelAdded.bind(this)),this.pc.on("ice",this._onIceCandidate.bind(this)),this.pc.on("iceConnectionStateChange",function(){switch(f.pc.iceConnectionState){case"failed":f.pc.isInitiator&&f.parent.emit("iceFailed",f)}}),this.sender=new u.Sender,this.sender.on("progress",function(e,n){p(f.sid+": Send progress "+e+"/"+n)}),this.sender.on("sentFile",function(e){p(f.sid+": Sent file "+e.name);var n=f.pc.localDescription.contents[0];delete n.transport,n.description={descType:"filetransfer",offer:{hash:{algo:e.algo,value:e.hash}}},f.send("description-info",{contents:[n]}),f.parent.emit("sentFile",f,e)}),this.receiver=new u.Receiver,this.receiver.on("receivedFile",function(e){f.receivedFile=e,f.maybeReceivedFile()}),this.receiver.on("progress",function(e,n){p(f.sid+": Receive progress "+e+"/"+n)})}var o=e("underscore"),d=e("util"),i=e("bows"),t=e("./genericSession"),l=e("rtcpeerconnection"),u=e("filetransfer"),p=i("JingleFile");d.inherits(n,t),n.prototype._onChannelAdded=function(e){this.receiver.receive(null,e)},n.prototype=o.extend(n.prototype,{start:function(e){var f=this;this.state="pending",this.pc.isInitiator=!0;var n=this.pc.createDataChannel("filetransfer");n.onopen=function(){f.sender.send(e,n)};var o={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};this.pc.offer(o,function(n,o){o.jingle.contents[0].description={descType:"filetransfer",offer:{date:e.lastModifiedDate,name:e.name,size:e.size,hash:{algo:"sha-1",value:""}}},f.send("session-initiate",o.jingle)})},end:function(e,f){this.pc.close(),t.prototype.end.call(this,e,f)},accept:function(){var e=this;p(this.sid+": Accepted incoming session"),this.state="active",this.pc.answer(function(f,n){return f?(p(e.sid+": Could not create WebRTC answer",f),e.end("failed-application")):(n.jingle.contents[0].name="data",void e.send("session-accept",n.jingle))})},onSessionInitiate:function(e,f){var n=this;p(n.sid+": Initiating incoming session"),this.state="pending",this.pc.isInitiator=!1;var o=e.contents[0].description;this.receiver.metadata=o.offer.toJSON(),this.receiver.metadata.hash&&(this.receiver.config.hash=this.receiver.metadata.hash.algo),e.contents[0].description={descType:"datachannel"},this.pc.handleOffer({type:"offer",jingle:e},function(e){return e?(p(n.sid+": Could not create WebRTC answer",e),f({condition:"general-error"})):void f()})},onSessionAccept:function(e,f){var n=this;p(this.sid+": Activating accepted outbound session"),this.state="active",e.contents[0].description={descType:"datachannel"},this.pc.handleAnswer({type:"answer",jingle:e},function(e){return e?(p(n.sid+": Could not process WebRTC answer",e),f({condition:"general-error"})):(n.parent.emit("accepted",n),void f())})},onSessionTerminate:function(e,f){p(this.sid+": Terminating session"),this.pc.close(),t.prototype.end.call(this,e.reason,!0),f()},onTransportInfo:function(e,f){var n=this;p(this.sid+": Adding ICE candidate"),this.pc.processIce(e,function(e){e&&p(n.sid+": Could not process ICE candidate",e),f()})},onDescriptionInfo:function(e,f){var n=e.contents[0].description.offer.hash;this.receiver.metadata.hash=n,this.receiver.metadata.actualhash&&this.maybeReceivedFile(),f()},_onIceCandidate:function(e){p(this.sid+": Discovered new ICE candidate",e.jingle),e.jingle.contents[0].name="data",this.send("transport-info",e.jingle)},maybeReceivedFile:function(){this.receiver.metadata.hash.value&&(this.receiver.metadata.hash.value===this.receiver.metadata.actualhash?(p(this.sid+": Hash matches"),this.parent.emit("receivedFile",this,this.receivedFile,this.receiver.metadata),this.end("success")):(p(this.sid+": Hash mismatch, terminating"),this.end("media-error")))}}),f.exports=n},{"./genericSession":192,bows:195,filetransfer:197,rtcpeerconnection:203,underscore:234,util:169}],192:[function(e,f){function n(e){var f=e.split("-");
return"on"+f[0][0].toUpperCase()+f[0].substr(1)+f[1][0].toUpperCase()+f[1].substr(1)}function o(e){var f=this;this.sid=e.sid||Date.now().toString(),this.peer=e.peer,this.isInitiator=e.initiator||!1,this.state="starting",this.parent=e.parent,this.processingQueue=i.queue(function(e,o){var d=e.action,i=e.changes,t=e.cb;if(l(f.sid+": "+d),-1===u.indexOf(d))return l(this.sid+": Invalid action "+d),t({condition:"bad-request"}),void o();var p=n(d);f[p](i,function(e){t(e),o()})})}var d=e("bows"),i=e("async"),t=e("wildemitter"),l=d("JingleSession"),u=["content-accept","content-add","content-modify","content-reject","content-remove","description-info","session-accept","session-info","session-initiate","session-terminate","source-add","source-remove","transport-accept","transport-info","transport-reject","transport-replace"];o.prototype=Object.create(t.prototype,{constructor:{value:o}}),o.prototype.process=function(e,f,n){this.processingQueue.push({action:e,changes:f,cb:n})},o.prototype.send=function(e,f){f=f||{},f.sid=this.sid,f.action=e,this.parent.emit("send",{to:this.peer,type:"set",jingle:f})},Object.defineProperty(o.prototype,"state",{get:function(){return this._state},set:function(e){var f={starting:!0,pending:!0,active:!0,ended:!0};if(!f[e])throw new Error("Invalid Jingle Session State: "+e);this._state!==e&&(this._state=e,l(this.sid+": State changed to "+e))}}),Object.defineProperty(o.prototype,"starting",{get:function(){return"starting"===this._state}}),Object.defineProperty(o.prototype,"pending",{get:function(){return"pending"===this._state}}),Object.defineProperty(o.prototype,"active",{get:function(){return"active"===this._state}}),Object.defineProperty(o.prototype,"ended",{get:function(){return"ended"===this._state}}),o.prototype.start=function(){this.state="pending",l(this.sid+": Can not start generic session")},o.prototype.end=function(e,f){this.parent.peers[this.peer].splice(this.parent.peers[this.peer].indexOf(this),1),delete this.parent.sessions[this.sid],this.state="ended",e=e||{},f||this.send("session-terminate",{reason:e}),this.parent.emit("terminated",this,e)},u.forEach(function(e){var f=n(e);o.prototype[f]=function(f,n){l(this.sid+": Unsupported action "+e),n()}}),f.exports=o},{async:108,bows:195,wildemitter:235}],193:[function(e,f){function n(e){t.call(this,e);var f=this,n=this.parent.config.peerConnectionConfig,o=this.parent.config.peerConnectionConstraints;n.useJingle=!0,this.pc=new l(n,o),this.pc.on("ice",this._onIceCandidate.bind(this)),this.pc.on("addStream",this._onStreamAdded.bind(this)),this.pc.on("removeStream",this._onStreamRemoved.bind(this)),this.pc.on("iceConnectionStateChange",function(){switch(f.pc.iceConnectionState){case"failed":f.pc.isInitiator&&f.parent.emit("iceFailed",f)}})}var o=e("underscore"),d=e("util"),i=e("bows"),t=e("./genericSession"),l=e("rtcpeerconnection"),u=i("JingleMedia");d.inherits(n,t),Object.defineProperty(n.prototype,"streams",{get:function(){return this.pc.remoteStreams}}),n.prototype=o.extend(n.prototype,{start:function(e){var f=this;this.state="pending",this.pc.isInitiator=!0,this.pc.offer(e,function(n,o){e&&e.mandatory&&o.jingle.contents.forEach(function(f){f.description&&"rtp"===f.description.descType&&(e.mandatory.OfferToReceiveAudio||"audio"!==f.description.media||(f.senders="initiator"),e.mandatory.OfferToReceiveVideo||"video"!==f.description.media||(f.senders="initiator"))}),f.send("session-initiate",o.jingle)})},end:function(e,f){var n=this;this.pc.close(),o.each(this.streams,function(e){n._onStreamRemoved({stream:e})}),t.prototype.end.call(this,e,f)},accept:function(){var e=this;u(this.sid+": Accepted incoming session"),this.state="active",this.pc.answer(function(f,n){return f?(u(e.sid+": Could not create WebRTC answer",f),e.end("failed-application")):void e.send("session-accept",n.jingle)})},ring:function(){u(this.sid+": Ringing on incoming session"),this.send("session-info",{ringing:!0})},mute:function(e,f){u(this.sid+": Muting"),this.send("session-info",{mute:{creator:e,name:f}})},unmute:function(e,f){u(this.sid+": Unmuting"),this.send("session-info",{unmute:{creator:e,name:f}})},hold:function(){u(this.sid+": Placing on hold"),this.send("session-info",{hold:!0})},resume:function(){u(this.sid+": Resuing from hold"),this.send("session-info",{active:!0})},addStream:function(e){this.pc.addStream(e)},addStream2:function(e){var f=this;this.pc.addStream(e),this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(n){console.log("handleOffer",n),f.pc.answer(function(n,o){console.log("answer",o),o.jingle.contents.forEach(function(f){delete f.transport,delete f.description.payloads,f.description.sources&&(f.description.sources=f.description.sources.filter(function(f){return e.id===f.parameters[1].value.split(" ")[0]}))}),f.send("source-add",o.jingle)})})},removeStream:function(e){this.pc.removeStream(e)},removeStream2:function(e){var f=this,n=this.pc.localDescription;console.log("remove stream id",e.id),n.contents.forEach(function(f){delete f.transport,delete f.description.payloads,f.description.sources&&(f.description.sources=f.description.sources.filter(function(f){return e.id===f.parameters[1].value.split(" ")[0]}))}),this.send("source-remove",n),this.pc.removeStream(e),this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(e){console.log("handleOffer",e),f.pc.answer(function(e,f){console.log("answer",f)})})},onSessionInitiate:function(e,f){var n=this;u(n.sid+": Initiating incoming session"),this.state="pending",this.pc.isInitiator=!1,this.pc.handleOffer({type:"offer",jingle:e},function(e){return e?(u(n.sid+": Could not create WebRTC answer",e),f({condition:"general-error"})):void f()})},onSessionAccept:function(e,f){var n=this;u(this.sid+": Activating accepted outbound session"),this.state="active",this.pc.handleAnswer({type:"answer",jingle:e},function(e){return e?(u(n.sid+": Could not process WebRTC answer",e),f({condition:"general-error"})):(n.parent.emit("accepted",n),void f())})},onSessionTerminate:function(e,f){var n=this;u(this.sid+": Terminating session"),this.pc.close(),o.each(this.streams,function(e){n._onStreamRemoved({stream:e})}),t.prototype.end.call(this,e.reason,!0),f()},onTransportInfo:function(e,f){var n=this;u(this.sid+": Adding ICE candidate"),this.pc.processIce(e,function(e){e&&u(n.sid+": Could not process ICE candidate",e),f()})},onSessionInfo:function(e,f){u(e),e.ringing&&(u(this.sid+": Ringing on remote stream"),this.parent.emit("ringing",this)),e.hold&&(u(this.sid+": On hold"),this.parent.emit("hold",this)),e.active&&(u(this.sid+": Resumed from hold"),this.parent.emit("resumed",this)),e.mute&&(u(this.sid+": Muted",e.mute),this.parent.emit("mute",this,e.mute)),e.unmute&&(u(this.sid+": Unmuted",e.unmute),this.parent.emit("unmute",this,e.unmute)),f()},onSourceAdd:function(e,f){var n=this;if(this.pc&&"closed"!==this.pc.iceConnectionState){if("connected"!==this.pc.iceConnectionState)return this.waitForUpdate=!0,void window.setTimeout(function(){n.onSourceAdd(e,f)},250);if(this.waitForUpdate)return delete this.waitForUpdate,void window.setTimeout(function(){n.onSourceAdd(e,f)},500);u(this.sid+": source-add");var o=this.pc.remoteDescription;this.pc.remoteDescription.contents.forEach(function(f,n){var d=f.description,i=d.sources||[];e.contents.forEach(function(e){if(f.name===e.name){var d=e.description,t=d.sources||[];i=i.concat(t),o.contents[n].description.sources=JSON.parse(JSON.stringify(i))}})}),this.pc.handleOffer({type:"offer",jingle:o},function(e){return e?(u(this.sid+": source-add offer error"),f({condition:"general-error"})):void n.pc.answer(function(e){return e?(u(this.sid+": source-add answer error"),f({condition:"general-error"})):void f()})})}},onSourceRemove:function(e,f){var n=this;if(this.pc&&"closed"!==this.pc.iceConnectionState){if("connected"!==this.pc.iceConnectionState)return this.waitForUpdate=!0,void window.setTimeout(function(){n.onSourceRemove(e,f)},250);if(this.waitForUpdate)return delete this.waitForUpdate,void window.setTimeout(function(){n.onSourceRemove(e,f)},500);u(this.sid+": source-remove");var o=this.pc.remoteDescription;this.pc.remoteDescription.contents.forEach(function(f,n){var d=f.description,i=d.sources||[];e.contents.forEach(function(e){if(f.name===e.name)for(var d=e.description,t=d.sources||[],l=-1,u=0;u<t.length;u++){for(var p=0;p<i.length;p++)if(t[u].ssrc===i[p].ssrc){l=p;break}l>-1&&(i.splice(l,1),o.contents[n].description.sources=JSON.parse(JSON.stringify(i)))}})}),this.pc.handleOffer({type:"offer",jingle:o},function(e){return e?(u(this.sid+": source-remove offer error"),f({condition:"general-error"})):void n.pc.answer(function(e){return e?(u(this.sid+": source-remove answer error"),f({condition:"general-error"})):void f()})})}},switchStream:function(e,f){var n=this,o=this.pc.localDescription;o.contents.forEach(function(e){delete e.transport,delete e.description.payloads}),console.log(JSON.parse(JSON.stringify(o))),this.pc.removeStream(e),this.send("source-remove",o);var d=e.getAudioTracks();d.length&&f.addTrack(d[0]),this.pc.addStream(f),this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(e){console.log("handleOffer",e),n.pc.answer(function(e,f){console.log("answer",f),f.jingle.contents.forEach(function(e){delete e.transport,delete e.description.payloads}),console.log(JSON.parse(JSON.stringify(f.jingle))),n.send("source-add",f.jingle)})})},_onIceCandidate:function(e){u(this.sid+": Discovered new ICE candidate",e.jingle),this.send("transport-info",e.jingle)},_onStreamAdded:function(e){u(this.sid+": Remote media stream added"),this.parent.emit("peerStreamAdded",this,e.stream)},_onStreamRemoved:function(e){u(this.sid+": Remote media stream removed"),this.parent.emit("peerStreamRemoved",this,e.stream)}}),f.exports=n},{"./genericSession":192,bows:195,rtcpeerconnection:203,underscore:234,util:169}],194:[function(e,f){function n(e){e=e||{};var f=this.config={debug:!1,peerConnectionConfig:{iceServers:[{url:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!1}]},autoAdjustMic:!1,media:{audio:!0,video:!0}};this.MediaSession=p,this.jid=e.jid,this.sessions={},this.peers={},this.screenSharingSupport=t.screenSharing;for(var n in e)f[n]=e[n];this.capabilities=["urn:xmpp:jingle:1"],t.support?this.capabilities=["urn:xmpp:jingle:1","urn:xmpp:jingle:apps:rtp:1","urn:xmpp:jingle:apps:rtp:audio","urn:xmpp:jingle:apps:rtp:video","urn:xmpp:jingle:apps:rtp:rtcb-fb:0","urn:xmpp:jingle:apps:rtp:rtp-hdrext:0","urn:xmpp:jingle:apps:rtp:ssma:0","urn:xmpp:jingle:apps:dtls:0","urn:xmpp:jingle:apps:grouping:0","urn:xmpp:jingle:apps:file-transfer:3","urn:xmpp:jingle:transports:ice-udp:1","urn:xmpp:jingle:transports.dtls-sctp:1","urn:ietf:rfc:3264","urn:ietf:rfc:5576","urn:ietf:rfc:5888"]:y("WebRTC not supported"),l.call(this),this.config.debug&&this.on("*",function(e,f,n){y(e,f,n)})}var o=e("underscore"),d=e("bows"),i=e("hark"),t=e("webrtcsupport"),l=e("wildemitter"),u=e("./genericSession"),p=e("./mediaSession"),s=e("./fileSession"),y=d("Jingle");n.prototype=Object.create(l.prototype,{constructor:{value:n}}),n.prototype.addICEServer=function(e){this.config.peerConnectionConfig.iceServers.push(e)},n.prototype.setupAudioMonitor=function(e){y("Setup audio");var f,n=i(e),o=this;n.on("speaking",function(){o.hardMuted||(o.setMicIfEnabled(1),o.emit("speaking"))}),n.on("stopped_speaking",function(){o.hardMuted||(f&&clearTimeout(f),f=setTimeout(function(){o.setMicIfEnabled(.5),o.emit("stoppedSpeaking")},1e3))})},n.prototype.setMicIfEnabled=function(e){this.config.autoAdjustMic&&this.gainController.setGain(e)},n.prototype.sendError=function(e,f,n){n.type="cancel",this.emit("send",{to:e,id:f,type:"error",error:n})},n.prototype.process=function(e){var f=this;if("error"===e.type)return this.emit("error",e);if("result"!==e.type){var n,d,i,t=e.jingle.sid,l=e.jingle.action,c=e.jingle.contents||[],a=o.map(c,function(e){return(e.description||{}).descType}),r=this.sessions[t]||null,w=e.from.full||e.from,b=e.id;if("session-initiate"!==l){if(!r)return y("Unknown session",t),this.sendError(w,b,{condition:"item-not-found",jingleCondition:"unknown-session"});if(r.peer!==w||r.ended)return y("Session has ended, or action has wrong sender"),this.sendError(w,b,{condition:"item-not-found",jingleCondition:"unknown-session"});if("session-accept"===l&&!r.pending)return y("Tried to accept session twice",t),this.sendError(w,b,{condition:"unexpected-request",jingleCondition:"out-of-order"});if("session-terminate"!==l&&r.pendingAction&&(y("Tie break during pending request"),r.isInitiator))return this.sendError(w,b,{condition:"conflict",jingleCondition:"tie-break"})}else{if(r)return r.peer!==w?(y("Duplicate sid from new sender"),this.sendError(w,b,{condition:"service-unavailable"})):r.pending&&this.jid>r.peer?(y("Tie break new session because of duplicate sids"),this.sendError(w,b,{condition:"conflict",jingleCondition:"tie-break"})):(y("Someone is doing this wrong"),this.sendError(w,b,{condition:"unexpected-request",jingleCondition:"out-of-order"}));if(Object.keys(this.peers[w]||{}).length){n=Object.keys(this.peers[w]);for(var m=0;m<n.length;m++)if(d=n[m],i=this.sessions[d],i&&i.pending&&o.intersection(a,i.contentTypes).length&&d>t)return y("Tie break"),this.sendError(w,b,{condition:"conflict",jingleCondition:"tie-break"})}}if("session-initiate"===l){var g={sid:t,peer:w,initiator:!1,parent:this};r=a.indexOf("rtp")>=0?new p(g):a.indexOf("filetransfer")>=0?new s(g):new u(g),this.sessions[t]=r,this.peers[w]||(this.peers[w]=[]),this.peers[w].push(r),this.emit("createdSession",r)}r.process(l,e.jingle,function(n){n?(y("Could not process request",e,n),f.sendError(w,b,n)):(f.emit("send",{to:w,id:b,type:"result",action:l}),"session-initiate"===l&&(y("Incoming session request from ",w,r),f.emit("incoming",r)))})}},n.prototype.createMediaSession=function(e,f,n){var o=new p({sid:f,peer:e,initiator:!0,stream:n,parent:this});return f=o.sid,this.sessions[f]=o,this.peers[e]||(this.peers[e]=[]),this.peers[e].push(o),this.emit("createdSession",o),y("Outgoing session",o.sid,o),this.emit("outgoing",o),o},n.prototype.createFileTransferSession=function(e,f){var n=new s({sid:f,peer:e,initiator:!0,parent:this});return f=n.sid,this.sessions[f]=n,this.peers[e]||(this.peers[e]=[]),this.peers[e].push(n),this.emit("createdSession",n),y("Outgoing session",n.sid,n),this.emit("outgoing",n),n},n.prototype.endPeerSessions=function(e,f){y("Ending all sessions with",e);var n=this.peers[e]||[];n.forEach(function(e){e.end("gone",f)}),delete this.peers[e]},n.prototype.endAllPeerSessions=function(){y("Ending all peer sessions");var e=this;Object.keys(this.peers).forEach(function(f){e.endPeerSessions(f)})},f.exports=n},{"./fileSession":191,"./genericSession":192,"./mediaSession":193,bows:195,hark:199,underscore:234,webrtcsupport:208,wildemitter:235}],195:[function(e,f){(function(){function n(){var e=!!window.chrome,f=/firefox/i.test(navigator.userAgent),n=f&&!!window.console.exception;return e||n}var o,d,i,t="undefined"==typeof window,l=!t&&window.localStorage,u=l.debug,p=e("andlog"),s=0,y=15,c=function(){},a=l.debugColors||n();o=function(){var e=.618033988749895;return s+=e,s%=1,360*s},i=u&&"/"===u[0]&&new RegExp(u.substring(1,u.length-1)),d=function(e){var f,n,d;if(f=e.slice(0,y),f+=Array(y+3-f.length).join(" ")+"|",i&&!e.match(i))return c;if(a){var t=o();f="%c"+f,n="color: hsl("+t+",99%,40%); font-weight: bold",d=p.log.bind(p,f,n),["log","debug","warn","error","info"].forEach(function(e){d[e]=p[e].bind(p,f,n)})}else d=p.log.bind(p,f),["log","debug","warn","error","info"].forEach(function(e){d[e]=p[e].bind(p,f)});return d},d.config=function(e){e.padLength&&(this.padLength=e.padLength)},"undefined"!=typeof f?f.exports=d:window.bows=d}).call()},{andlog:196}],196:[function(e,f,n){!function(){var e="undefined"==typeof window,o=!e&&window.localStorage,d={};if(e)return void(f.exports=console);var i=o.andlogKey||"debug";if(o&&o[i]&&window.console)d=window.console;else for(var t="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),l=t.length,u=function(){};l--;)d[t[l]]=u;"undefined"!=typeof n?f.exports=d:window.console=d}()},{}],197:[function(e,f){function n(e){i.call(this);var f=this,n=e||{};this.config={chunksize:768,pacing:10,hash:"sha-1"};var o;for(o in n)this.config[o]=n[o];this.file=null,this.channel=null,this.hash=null,this.processingQueue=d.queue(function(e,n){if("chunk"==e.type){var o=new window.FileReader;o.onload=function(){return function(o){f.channel.send(o.target.result),f.hash.update(new Uint8Array(o.target.result)),f.emit("progress",e.start,e.file.size),window.setTimeout(n,f.config.pacing)}}(e.file);var d=e.file.slice(e.start,e.start+e.size);o.readAsArrayBuffer(d)}else"complete"==e.type&&(f.emit("sentFile",{hash:f.hash.digest("hex"),algo:f.config.hash}),n())})}function o(e){i.call(this);var f=e||{};this.config={hash:"sha-1"};var n;for(n in f)this.config[n]=f[n];this.receiveBuffer=[],this.received=0,this.metadata={},this.channel=null,this.hash=null}var d=e("async"),i=e("wildemitter"),t=e("util"),l=e("iana-hashes");t.inherits(n,i),n.prototype.send=function(e,f){this.file=e,this.hash=l.createHash(this.config.hash),this.channel=f;for(var n=0;n<this.file.size;n+=this.config.chunksize)this.processingQueue.push({type:"chunk",file:e,start:n,size:this.config.chunksize});this.processingQueue.push({type:"complete"})},t.inherits(o,i),o.prototype.receive=function(e,f){var n=this;e&&(this.metadata=e),this.hash=l.createHash(this.config.hash),this.channel=f,f.binaryType="arraybuffer",this.channel.onmessage=function(e){var f=e.data.byteLength;n.received+=f,n.receiveBuffer.push(e.data),n.hash.update(new Uint8Array(e.data)),n.emit("progress",n.received,n.metadata.size),n.received==n.metadata.size?(n.metadata.actualhash=n.hash.digest("hex"),n.emit("receivedFile",new window.Blob(n.receiveBuffer),n.metadata),n.receiveBuffer=[]):n.received>n.metadata.size&&(console.error("received more than expected, discarding..."),n.receiveBuffer=[])}},f.exports={},f.exports.support=window&&window.File&&window.FileReader&&window.Blob,f.exports.Sender=n,f.exports.Receiver=o},{async:198,"iana-hashes":174,util:169,wildemitter:235}],198:[function(f,n){(function(f){!function(){function o(e){var f=!1;return function(){if(f)throw new Error("Callback was already called.");f=!0,e.apply(d,arguments)}}var d,i,t={};d=this,null!=d&&(i=d.async),t.noConflict=function(){return d.async=i,t};var l=Object.prototype.toString,u=Array.isArray||function(e){return"[object Array]"===l.call(e)},p=function(e,f){if(e.forEach)return e.forEach(f);for(var n=0;n<e.length;n+=1)f(e[n],n,e)},s=function(e,f){if(e.map)return e.map(f);var n=[];return p(e,function(e,o,d){n.push(f(e,o,d))}),n},y=function(e,f,n){return e.reduce?e.reduce(f,n):(p(e,function(e,o,d){n=f(n,e,o,d)}),n)},c=function(e){if(Object.keys)return Object.keys(e);var f=[];for(var n in e)e.hasOwnProperty(n)&&f.push(n);return f};"undefined"!=typeof f&&f.nextTick?(t.nextTick=f.nextTick,t.setImmediate="undefined"!=typeof setImmediate?function(e){setImmediate(e)}:t.nextTick):"function"==typeof setImmediate?(t.nextTick=function(e){setImmediate(e)},t.setImmediate=t.nextTick):(t.nextTick=function(e){setTimeout(e,0)},t.setImmediate=t.nextTick),t.each=function(e,f,n){function d(f){f?(n(f),n=function(){}):(i+=1,i>=e.length&&n())}if(n=n||function(){},!e.length)return n();var i=0;p(e,function(e){f(e,o(d))})},t.forEach=t.each,t.eachSeries=function(e,f,n){if(n=n||function(){},!e.length)return n();var o=0,d=function(){f(e[o],function(f){f?(n(f),n=function(){}):(o+=1,o>=e.length?n():d())})};d()},t.forEachSeries=t.eachSeries,t.eachLimit=function(e,f,n,o){var d=a(f);d.apply(null,[e,n,o])},t.forEachLimit=t.eachLimit;var a=function(e){return function(f,n,o){if(o=o||function(){},!f.length||0>=e)return o();var d=0,i=0,t=0;!function l(){if(d>=f.length)return o();for(;e>t&&i<f.length;)i+=1,t+=1,n(f[i-1],function(e){e?(o(e),o=function(){}):(d+=1,t-=1,d>=f.length?o():l())})}()}},r=function(e){return function(){var f=Array.prototype.slice.call(arguments);return e.apply(null,[t.each].concat(f))}},w=function(e,f){return function(){var n=Array.prototype.slice.call(arguments);return f.apply(null,[a(e)].concat(n))}},b=function(e){return function(){var f=Array.prototype.slice.call(arguments);return e.apply(null,[t.eachSeries].concat(f))}},m=function(e,f,n,o){if(f=s(f,function(e,f){return{index:f,value:e}}),o){var d=[];e(f,function(e,f){n(e.value,function(n,o){d[e.index]=o,f(n)})},function(e){o(e,d)})}else e(f,function(e,f){n(e.value,function(e){f(e)})})};t.map=r(m),t.mapSeries=b(m),t.mapLimit=function(e,f,n,o){return g(f)(e,n,o)};var g=function(e){return w(e,m)};t.reduce=function(e,f,n,o){t.eachSeries(e,function(e,o){n(f,e,function(e,n){f=n,o(e)})},function(e){o(e,f)})},t.inject=t.reduce,t.foldl=t.reduce,t.reduceRight=function(e,f,n,o){var d=s(e,function(e){return e}).reverse();t.reduce(d,f,n,o)},t.foldr=t.reduceRight;var x=function(e,f,n,o){var d=[];f=s(f,function(e,f){return{index:f,value:e}}),e(f,function(e,f){n(e.value,function(n){n&&d.push(e),f()})},function(){o(s(d.sort(function(e,f){return e.index-f.index}),function(e){return e.value}))})};t.filter=r(x),t.filterSeries=b(x),t.select=t.filter,t.selectSeries=t.filterSeries;var P=function(e,f,n,o){var d=[];f=s(f,function(e,f){return{index:f,value:e}}),e(f,function(e,f){n(e.value,function(n){n||d.push(e),f()})},function(){o(s(d.sort(function(e,f){return e.index-f.index}),function(e){return e.value}))})};t.reject=r(P),t.rejectSeries=b(P);var j=function(e,f,n,o){e(f,function(e,f){n(e,function(n){n?(o(e),o=function(){}):f()})},function(){o()})};t.detect=r(j),t.detectSeries=b(j),t.some=function(e,f,n){t.each(e,function(e,o){f(e,function(e){e&&(n(!0),n=function(){}),o()})},function(){n(!1)})},t.any=t.some,t.every=function(e,f,n){t.each(e,function(e,o){f(e,function(e){e||(n(!1),n=function(){}),o()})},function(){n(!0)})},t.all=t.every,t.sortBy=function(e,f,n){t.map(e,function(e,n){f(e,function(f,o){f?n(f):n(null,{value:e,criteria:o})})},function(e,f){if(e)return n(e);var o=function(e,f){var n=e.criteria,o=f.criteria;return o>n?-1:n>o?1:0};n(null,s(f.sort(o),function(e){return e.value}))})},t.auto=function(e,f){f=f||function(){};var n=c(e),o=n.length;if(!o)return f();var d={},i=[],l=function(e){i.unshift(e)},s=function(e){for(var f=0;f<i.length;f+=1)if(i[f]===e)return void i.splice(f,1)},a=function(){o--,p(i.slice(0),function(e){e()})};l(function(){if(!o){var e=f;f=function(){},e(null,d)}}),p(n,function(n){var o=u(e[n])?e[n]:[e[n]],i=function(e){var o=Array.prototype.slice.call(arguments,1);if(o.length<=1&&(o=o[0]),e){var i={};p(c(d),function(e){i[e]=d[e]}),i[n]=o,f(e,i),f=function(){}}else d[n]=o,t.setImmediate(a)},r=o.slice(0,Math.abs(o.length-1))||[],w=function(){return y(r,function(e,f){return e&&d.hasOwnProperty(f)},!0)&&!d.hasOwnProperty(n)};if(w())o[o.length-1](i,d);else{var b=function(){w()&&(s(b),o[o.length-1](i,d))};l(b)}})},t.retry=function(e,f,n){var o=5,d=[];"function"==typeof e&&(n=f,f=e,e=o),e=parseInt(e,10)||o;var i=function(o,i){for(var l=function(e,f){return function(n){e(function(e,o){n(!e||f,{err:e,result:o})},i)}};e;)d.push(l(f,!(e-=1)));t.series(d,function(e,f){f=f[f.length-1],(o||n)(f.err,f.result)})};return n?i():i},t.waterfall=function(e,f){if(f=f||function(){},!u(e)){var n=new Error("First argument to waterfall must be an array of functions");return f(n)}if(!e.length)return f();var o=function(e){return function(n){if(n)f.apply(null,arguments),f=function(){};else{var d=Array.prototype.slice.call(arguments,1),i=e.next();d.push(i?o(i):f),t.setImmediate(function(){e.apply(null,d)})}}};o(t.iterator(e))()};var v=function(e,f,n){if(n=n||function(){},u(f))e.map(f,function(e,f){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),f.call(null,e,n)})},n);else{var o={};e.each(c(f),function(e,n){f[e](function(f){var d=Array.prototype.slice.call(arguments,1);d.length<=1&&(d=d[0]),o[e]=d,n(f)})},function(e){n(e,o)})}};t.parallel=function(e,f){v({map:t.map,each:t.each},e,f)},t.parallelLimit=function(e,f,n){v({map:g(f),each:a(f)},e,n)},t.series=function(e,f){if(f=f||function(){},u(e))t.mapSeries(e,function(e,f){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),f.call(null,e,n)})},f);else{var n={};t.eachSeries(c(e),function(f,o){e[f](function(e){var d=Array.prototype.slice.call(arguments,1);d.length<=1&&(d=d[0]),n[f]=d,o(e)})},function(e){f(e,n)})}},t.iterator=function(e){var f=function(n){var o=function(){return e.length&&e[n].apply(null,arguments),o.next()};return o.next=function(){return n<e.length-1?f(n+1):null},o};return f(0)},t.apply=function(e){var f=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,f.concat(Array.prototype.slice.call(arguments)))}};var M=function(e,f,n,o){var d=[];e(f,function(e,f){n(e,function(e,n){d=d.concat(n||[]),f(e)})},function(e){o(e,d)})};t.concat=r(M),t.concatSeries=b(M),t.whilst=function(e,f,n){e()?f(function(o){return o?n(o):void t.whilst(e,f,n)}):n()},t.doWhilst=function(e,f,n){e(function(o){if(o)return n(o);var d=Array.prototype.slice.call(arguments,1);f.apply(null,d)?t.doWhilst(e,f,n):n()})},t.until=function(e,f,n){e()?n():f(function(o){return o?n(o):void t.until(e,f,n)})},t.doUntil=function(e,f,n){e(function(o){if(o)return n(o);var d=Array.prototype.slice.call(arguments,1);f.apply(null,d)?n():t.doUntil(e,f,n)})},t.queue=function(e,f){function n(e,f,n,o){return e.started||(e.started=!0),u(f)||(f=[f]),0==f.length?t.setImmediate(function(){e.drain&&e.drain()}):void p(f,function(f){var d={data:f,callback:"function"==typeof o?o:null};n?e.tasks.unshift(d):e.tasks.push(d),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),t.setImmediate(e.process)})}void 0===f&&(f=1);var d=0,i={tasks:[],concurrency:f,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,f){n(i,e,!1,f)},kill:function(){i.drain=null,i.tasks=[]},unshift:function(e,f){n(i,e,!0,f)},process:function(){if(!i.paused&&d<i.concurrency&&i.tasks.length){var f=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),d+=1;var n=function(){d-=1,f.callback&&f.callback.apply(f,arguments),i.drain&&i.tasks.length+d===0&&i.drain(),i.process()},t=o(n);e(f.data,t)}},length:function(){return i.tasks.length},running:function(){return d},idle:function(){return i.tasks.length+d===0},pause:function(){i.paused!==!0&&(i.paused=!0,i.process())},resume:function(){i.paused!==!1&&(i.paused=!1,i.process())}};return i},t.cargo=function(e,f){var n=!1,o=[],d={tasks:o,payload:f,saturated:null,empty:null,drain:null,drained:!0,push:function(e,n){u(e)||(e=[e]),p(e,function(e){o.push({data:e,callback:"function"==typeof n?n:null}),d.drained=!1,d.saturated&&o.length===f&&d.saturated()}),t.setImmediate(d.process)},process:function i(){if(!n){if(0===o.length)return d.drain&&!d.drained&&d.drain(),void(d.drained=!0);var t="number"==typeof f?o.splice(0,f):o.splice(0,o.length),l=s(t,function(e){return e.data});d.empty&&d.empty(),n=!0,e(l,function(){n=!1;var e=arguments;p(t,function(f){f.callback&&f.callback.apply(null,e)}),i()})}},length:function(){return o.length},running:function(){return n}};return d};var X=function(e){return function(f){var n=Array.prototype.slice.call(arguments,1);f.apply(null,n.concat([function(f){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(f?console.error&&console.error(f):console[e]&&p(n,function(f){console[e](f)}))}]))}};t.log=X("log"),t.dir=X("dir"),t.memoize=function(e,f){var n={},o={};f=f||function(e){return e};var d=function(){var d=Array.prototype.slice.call(arguments),i=d.pop(),l=f.apply(null,d);l in n?t.nextTick(function(){i.apply(null,n[l])}):l in o?o[l].push(i):(o[l]=[i],e.apply(null,d.concat([function(){n[l]=arguments;var e=o[l];delete o[l];for(var f=0,d=e.length;d>f;f++)e[f].apply(null,arguments)}])))};return d.memo=n,d.unmemoized=e,d},t.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},t.times=function(e,f,n){for(var o=[],d=0;e>d;d++)o.push(d);return t.map(o,f,n)},t.timesSeries=function(e,f,n){for(var o=[],d=0;e>d;d++)o.push(d);return t.mapSeries(o,f,n)},t.seq=function(){var e=arguments;return function(){var f=this,n=Array.prototype.slice.call(arguments),o=n.pop();t.reduce(e,n,function(e,n,o){n.apply(f,e.concat([function(){var e=arguments[0],f=Array.prototype.slice.call(arguments,1);o(e,f)}]))},function(e,n){o.apply(f,[e].concat(n))})}},t.compose=function(){return t.seq.apply(null,Array.prototype.reverse.call(arguments))};var h=function(e,f){var n=function(){var n=this,o=Array.prototype.slice.call(arguments),d=o.pop();return e(f,function(e,f){e.apply(n,o.concat([f]))},d)};if(arguments.length>2){var o=Array.prototype.slice.call(arguments,2);return n.apply(this,o)}return n};t.applyEach=r(h),t.applyEachSeries=b(h),t.forever=function(e,f){function n(o){if(o){if(f)return f(o);throw o}e(n)}n()},"undefined"!=typeof n&&n.exports?n.exports=t:"undefined"!=typeof e&&e.amd?e([],function(){return t}):d.async=t}()}).call(this,f("FWaASH"))},{FWaASH:166}],199:[function(e,f){function n(e,f){var n=-1/0;e.getFloatFrequencyData(f);for(var o=4,d=f.length;d>o;o++)f[o]>n&&f[o]<0&&(n=f[o]);return n}var o=e("wildemitter"),d=window.webkitAudioContext||window.AudioContext,i=null;f.exports=function(e,f){var t=new o;if(!d)return t;var f=f||{},l=f.smoothing||.1,u=f.interval||50,p=f.threshold,s=f.play,y=f.history||10,c=!0;i||(i=new d);var a,r,w;w=i.createAnalyser(),w.fftSize=512,w.smoothingTimeConstant=l,r=new Float32Array(w.fftSize),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(a=i.createMediaElementSource(e),"undefined"==typeof s&&(s=!0),p=p||-50):(a=i.createMediaStreamSource(e),p=p||-50),a.connect(w),s&&w.connect(i.destination),t.speaking=!1,t.setThreshold=function(e){p=e},t.setInterval=function(e){u=e},t.stop=function(){c=!1,t.emit("volume_change",-100,p),t.speaking&&(t.speaking=!1,t.emit("stopped_speaking"))},t.speakingHistory=[];for(var b=0;y>b;b++)t.speakingHistory.push(0);var m=function(){setTimeout(function(){if(c){var e=n(w,r);t.emit("volume_change",e,p);var f=0;if(e>p&&!t.speaking){for(var o=t.speakingHistory.length-3;o<t.speakingHistory.length;o++)f+=t.speakingHistory[o];f>=2&&(t.speaking=!0,t.emit("speaking"))}else if(p>e&&t.speaking){for(var o=0;o<t.speakingHistory.length;o++)f+=t.speakingHistory[o];0==f&&(t.speaking=!1,t.emit("stopped_speaking"))}t.speakingHistory.shift(),t.speakingHistory.push(0+(e>p)),m()}},u)};return m(),t}},{wildemitter:235}],200:[function(e,f){function n(e){return"type: "+e.type+"\r\n"+e.sdp}function o(e,f){var n=this;t.call(this),this.peerconnection=new i.PeerConnection(e,f),this.trace=function(e,f){n.emit("PeerConnectionTrace",{time:new Date,type:e,value:f||""})},this.onicecandidate=null,this.peerconnection.onicecandidate=function(e){n.trace("onicecandidate",JSON.stringify(e.candidate,null," ")),null!==n.onicecandidate&&n.onicecandidate(e)},this.onaddstream=null,this.peerconnection.onaddstream=function(e){n.trace("onaddstream",e.stream.id),null!==n.onaddstream&&n.onaddstream(e)},this.onremovestream=null,this.peerconnection.onremovestream=function(e){n.trace("onremovestream",e.stream.id),null!==n.onremovestream&&n.onremovestream(e)},this.onsignalingstatechange=null,this.peerconnection.onsignalingstatechange=function(e){n.trace("onsignalingstatechange",n.signalingState),null!==n.onsignalingstatechange&&n.onsignalingstatechange(e)},this.oniceconnectionstatechange=null,this.peerconnection.oniceconnectionstatechange=function(e){n.trace("oniceconnectionstatechange",n.iceConnectionState),null!==n.oniceconnectionstatechange&&n.oniceconnectionstatechange(e)},this.onnegotiationneeded=null,this.peerconnection.onnegotiationneeded=function(e){n.trace("onnegotiationneeded"),null!==n.onnegotiationneeded&&n.onnegotiationneeded(e)},n.ondatachannel=null,this.peerconnection.ondatachannel=function(e){n.trace("ondatachannel",e),null!==n.ondatachannel&&n.ondatachannel(e)
},this.getLocalStreams=this.peerconnection.getLocalStreams.bind(this.peerconnection),this.getRemoteStreams=this.peerconnection.getRemoteStreams.bind(this.peerconnection)}var d=e("util"),i=e("webrtcsupport"),t=e("wildemitter");d.inherits(o,t),Object.defineProperty(o.prototype,"signalingState",{get:function(){return this.peerconnection.signalingState}}),Object.defineProperty(o.prototype,"iceConnectionState",{get:function(){return this.peerconnection.iceConnectionState}}),Object.defineProperty(o.prototype,"localDescription",{get:function(){return this.peerconnection.localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{get:function(){return this.peerconnection.remoteDescription}}),o.prototype.addStream=function(e){this.trace("addStream",e.id),this.peerconnection.addStream(e)},o.prototype.removeStream=function(e){this.trace("removeStream",e.id),this.peerconnection.removeStream(e)},o.prototype.createDataChannel=function(e,f){return this.trace("createDataChannel",e,f),this.peerconnection.createDataChannel(e,f)},o.prototype.setLocalDescription=function(e,f,o){var d=this;this.trace("setLocalDescription",n(e)),this.peerconnection.setLocalDescription(e,function(){d.trace("setLocalDescriptionOnSuccess"),f()},function(e){d.trace("setLocalDescriptionOnFailure",e),o(e)})},o.prototype.setRemoteDescription=function(e,f,o){var d=this;this.trace("setRemoteDescription",n(e)),this.peerconnection.setRemoteDescription(e,function(){d.trace("setRemoteDescriptionOnSuccess"),f()},function(e){d.trace("setRemoteDescriptionOnFailure",e),o(e)})},o.prototype.close=function(){this.trace("stop"),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),"closed"!=this.peerconnection.signalingState&&this.peerconnection.close()},o.prototype.createOffer=function(e,f,o){var d=this;this.trace("createOffer",JSON.stringify(o,null," ")),this.peerconnection.createOffer(function(f){d.trace("createOfferOnSuccess",n(f)),e(f)},function(e){d.trace("createOfferOnFailure",e),f(e)},o)},o.prototype.createAnswer=function(e,f,o){var d=this;this.trace("createAnswer",JSON.stringify(o,null," ")),this.peerconnection.createAnswer(function(f){d.trace("createAnswerOnSuccess",n(f)),e(f)},function(e){d.trace("createAnswerOnFailure",e),f(e)},o)},o.prototype.addIceCandidate=function(e){this.trace("addIceCandidate",JSON.stringify(e,null," ")),this.peerconnection.addIceCandidate(e)},o.prototype.getStats=function(e,f){navigator.mozGetUserMedia?this.peerconnection.getStats(null,e,f):this.peerconnection.getStats(e)},f.exports=o},{util:169,webrtcsupport:201,wildemitter:235}],201:[function(e,f){var n,o=!1,d=!1,i=window.navigator.userAgent.toLowerCase();-1!==i.indexOf("firefox")?(n="moz",d=!0):-1!==i.indexOf("chrome")&&(n="webkit",o=!0);var t=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,l=window.mozRTCIceCandidate||window.RTCIceCandidate,u=window.mozRTCSessionDescription||window.RTCSessionDescription,p=window.webkitMediaStream||window.MediaStream,s="https:"===window.location.protocol&&window.navigator.userAgent.match("Chrome")&&parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10)>=26,y=window.webkitAudioContext||window.AudioContext;f.exports={support:!!t,dataChannel:o||d||t&&t.prototype&&t.prototype.createDataChannel,prefix:n,webAudio:!(!y||!y.prototype.createMediaStreamSource),mediaStream:!(!p||!p.prototype.removeTrack),screenSharing:!!s,AudioContext:y,PeerConnection:t,SessionDescription:u,IceCandidate:l}},{}],202:[function(e,f){var n,o=!1,d=!1,i=window.navigator.userAgent.toLowerCase();-1!==i.indexOf("firefox")?(n="moz",d=!0):-1!==i.indexOf("chrome")&&(n="webkit",o=!0);var t=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,l=window.mozRTCIceCandidate||window.RTCIceCandidate,u=window.mozRTCSessionDescription||window.RTCSessionDescription,p=window.webkitMediaStream||window.MediaStream,s="https:"===window.location.protocol&&(window.navigator.userAgent.match("Chrome")&&parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10)>=26||window.navigator.userAgent.match("Firefox")&&parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10)>=33),y=window.webkitAudioContext||window.AudioContext;f.exports={support:!!t,dataChannel:o||d||t&&t.prototype&&t.prototype.createDataChannel,prefix:n,webAudio:!(!y||!y.prototype.createMediaStreamSource),mediaStream:!(!p||!p.prototype.removeTrack),screenSharing:!!s,AudioContext:y,PeerConnection:t,SessionDescription:u,IceCandidate:l,MediaStream:p}},{}],203:[function(e,f){function n(e,f){var n,o=this;l.call(this),e=e||{},e.iceServers=e.iceServers||[],this.pc=new u(e,f),this.getLocalStreams=this.pc.getLocalStreams.bind(this.pc),this.getRemoteStreams=this.pc.getRemoteStreams.bind(this.pc),this.addStream=this.pc.addStream.bind(this.pc),this.removeStream=this.pc.removeStream.bind(this.pc),this.pc.on("*",function(){o.emit.apply(o,arguments)}),this.pc.onremovestream=this.emit.bind(this,"removeStream"),this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded"),this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange"),this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange"),this.pc.onaddstream=this._onAddStream.bind(this),this.pc.onicecandidate=this._onIce.bind(this),this.pc.ondatachannel=this._onDataChannel.bind(this),this.localDescription={contents:[]},this.remoteDescription={contents:[]},this.localStream=null,this.remoteStreams=[],this.config={debug:!1,ice:{},sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};for(n in e)this.config[n]=e[n];this.config.debug&&this.on("*",function(){var f=e.logger||console;f.log("PeerConnection event:",arguments)}),this.hadLocalStunCandidate=!1,this.hadRemoteStunCandidate=!1,this.hadLocalRelayCandidate=!1,this.hadRemoteRelayCandidate=!1,this.hadLocalIPv6Candidate=!1,this.hadRemoteIPv6Candidate=!1,this._remoteDataChannels=[],this._localDataChannels=[]}var o=e("underscore"),d=e("util"),i=e("webrtcsupport"),t=e("sdp-jingle-json"),l=e("wildemitter"),u=e("traceablepeerconnection");d.inherits(n,l),Object.defineProperty(n.prototype,"signalingState",{get:function(){return this.pc.signalingState}}),Object.defineProperty(n.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}}),n.prototype.addStream=function(e){this.localStream=e,this.pc.addStream(e)},n.prototype.processIce=function(e,f){f=f||function(){};var n=this;if(e.contents){var d=o.pluck(this.remoteDescription.contents,"name"),l=e.contents;l.forEach(function(e){var f=e.transport||{},o=f.candidates||[],l=d.indexOf(e.name),u=e.name;o.forEach(function(e){var f=t.toCandidateSDP(e)+"\r\n";n.pc.addIceCandidate(new i.IceCandidate({candidate:f,sdpMLineIndex:l,sdpMid:u})),"srflx"===e.type?n.hadRemoteStunCandidate=!0:"relay"===e.type&&(n.hadRemoteRelayCandidate=!0),-1!=e.ip.indexOf(":")&&(n.hadRemoteIPv6Candidate=!0)})})}else{0!==e.candidate.candidate.indexOf("a=")&&(e.candidate.candidate="a="+e.candidate.candidate),n.pc.addIceCandidate(new i.IceCandidate(e.candidate));var u=t.toCandidateJSON(e.candidate.candidate);"srflx"==u.type?n.hadRemoteStunCandidate=!0:"relay"==u.type&&(n.hadRemoteRelayCandidate=!0),-1!=u.ip.indexOf(":")&&(n.hadRemoteIPv6Candidate=!0)}f()},n.prototype.offer=function(e,f){var n=this,d=2===arguments.length,i=d?e:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};f=d?f:e,f=f||function(){},this.pc.createOffer(function(e){n.pc.setLocalDescription(e,function(){var d,i={type:"offer",sdp:e.sdp};n.config.useJingle&&(d=t.toSessionJSON(e.sdp,n.config.isInitiator?"initiator":"responder"),d.sid=n.config.sid,n.localDescription=d,o.each(d.contents,function(e){var f=e.transport||{};f.ufrag&&(n.config.ice[e.name]={ufrag:f.ufrag,pwd:f.pwd})}),i.jingle=d),n.emit("offer",i),f(null,i)},function(e){n.emit("error",e),f(e)})},function(e){n.emit("error",e),f(e)},i)},n.prototype.handleOffer=function(e,f){f=f||function(){};var n=this;e.type="offer",e.jingle&&(e.sdp=t.toSessionSDP(e.jingle,n.config.sdpSessionID),n.remoteDescription=e.jingle),n.pc.setRemoteDescription(new i.SessionDescription(e),function(){f()},f)},n.prototype.answerAudioOnly=function(e){var f={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}};this._answer(f,e)},n.prototype.answerBroadcastOnly=function(e){var f={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};this._answer(f,e)},n.prototype.answer=function(e,f){var n=2===arguments.length,o=n?f:e,d=n?e:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};this._answer(d,o)},n.prototype.handleAnswer=function(e,f){f=f||function(){};var n=this;e.jingle&&(e.sdp=t.toSessionSDP(e.jingle,n.config.sdpSessionID),n.remoteDescription=e.jingle),n.pc.setRemoteDescription(new i.SessionDescription(e),function(){f(null)},f)},n.prototype.close=function(){this.pc.close(),this._localDataChannels=[],this._remoteDataChannels=[],this.emit("close")},n.prototype._answer=function(e,f){f=f||function(){};var n=this;if(!this.pc.remoteDescription)throw new Error("remoteDescription not set");n.pc.createAnswer(function(e){n.pc.setLocalDescription(e,function(){var o={type:"answer",sdp:e.sdp};if(n.config.useJingle){var d=t.toSessionJSON(e.sdp);d.sid=n.config.sid,n.localDescription=d,o.jingle=d}n.emit("answer",o),f(null,o)},function(e){n.emit("error",e),f(e)})},function(e){n.emit("error",e),f(e)},e)},n.prototype._onIce=function(e){var f=this;if(e.candidate){var n=e.candidate,d={candidate:e.candidate},i=t.toCandidateJSON(n.candidate);if(f.config.useJingle){if(n.sdpMid||(n.sdpMid=f.localDescription.contents[n.sdpMLineIndex].name),!f.config.ice[n.sdpMid]){var l=t.toSessionJSON(f.pc.localDescription.sdp,f.config.isInitiator?"initiator":"responder");o.each(l.contents,function(e){var n=e.transport||{};n.ufrag&&(f.config.ice[e.name]={ufrag:n.ufrag,pwd:n.pwd})})}d.jingle={contents:[{name:n.sdpMid,creator:f.config.isInitiator?"initiator":"responder",transport:{transType:"iceUdp",ufrag:f.config.ice[n.sdpMid].ufrag,pwd:f.config.ice[n.sdpMid].pwd,candidates:[i]}}]}}"srflx"===i.type?this.hadLocalStunCandidate=!0:"relay"==i.type&&(this.hadLocalRelayCandidate=!0),-1!=i.ip.indexOf(":")&&(f.hadLocalIPv6Candidate=!0),this.emit("ice",d)}else this.emit("endOfCandidates")},n.prototype._onDataChannel=function(e){var f=e.channel;this._remoteDataChannels.push(f),this.emit("addChannel",f)},n.prototype._onAddStream=function(e){this.remoteStreams.push(e.stream),this.emit("addStream",e)},n.prototype.createDataChannel=function(e,f){var n=this.pc.createDataChannel(e,f);return this._localDataChannels.push(n),n},n.prototype.getStats=function(e){"moz"===i.prefix?this.pc.getStats(function(f){var n=[];f.forEach(function(e){n.push(e)}),e(null,n)},e):this.pc.getStats(function(f){var n=[];f.result().forEach(function(e){var f={};e.names().forEach(function(n){f[n]=e.stat(n)}),f.id=e.id,f.type=e.type,f.timestamp=e.timestamp,n.push(f)}),e(null,n)})},f.exports=n},{"sdp-jingle-json":204,traceablepeerconnection:200,underscore:234,util:169,webrtcsupport:202,wildemitter:235}],204:[function(e,f,n){var o=e("./lib/tosdp"),d=e("./lib/tojson");n.toSessionSDP=o.toSessionSDP,n.toMediaSDP=o.toMediaSDP,n.toCandidateSDP=o.toCandidateSDP,n.toSessionJSON=d.toSessionJSON,n.toMediaJSON=d.toMediaJSON,n.toCandidateJSON=d.toCandidateJSON},{"./lib/tojson":206,"./lib/tosdp":207}],205:[function(e,f,n){n.lines=function(e){return e.split("\r\n").filter(function(e){return e.length>0})},n.findLine=function(e,f,n){for(var o=e.length,d=0;d<f.length;d++)if(f[d].substr(0,o)===e)return f[d];if(!n)return!1;for(var i=0;i<n.length;i++)if(n[i].substr(0,o)===e)return n[i];return!1},n.findLines=function(e,f,n){for(var o=[],d=e.length,i=0;i<f.length;i++)f[i].substr(0,d)===e&&o.push(f[i]);if(o.length||!n)return o;for(var t=0;t<n.length;t++)n[t].substr(0,d)===e&&o.push(n[t]);return o},n.mline=function(e){for(var f=e.substr(2).split(" "),n={media:f[0],port:f[1],proto:f[2],formats:[]},o=3;o<f.length;o++)f[o]&&n.formats.push(f[o]);return n},n.rtpmap=function(e){var f=e.substr(9).split(" "),n={id:f.shift()};return f=f[0].split("/"),n.name=f[0],n.clockrate=f[1],n.channels=3==f.length?f[2]:"1",n},n.sctpmap=function(e){var f=e.substr(10).split(" "),n={number:f.shift(),protocol:f.shift(),streams:f.shift()};return n},n.fmtp=function(e){for(var f,n,o,d=e.substr(e.indexOf(" ")+1).split(";"),i=[],t=0;t<d.length;t++)f=d[t].split("="),n=f[0].trim(),o=f[1],n&&o?i.push({key:n,value:o}):n&&i.push({key:"",value:n});return i},n.crypto=function(e){var f=e.substr(9).split(" "),n={tag:f[0],cipherSuite:f[1],keyParams:f[2],sessionParams:f.slice(3).join(" ")};return n},n.fingerprint=function(e){var f=e.substr(14).split(" ");return{hash:f[0],value:f[1]}},n.extmap=function(e){var f=e.substr(9).split(" "),n={},o=f.shift(),d=o.indexOf("/");return d>=0?(n.id=o.substr(0,d),n.senders=o.substr(d+1)):(n.id=o,n.senders="sendrecv"),n.uri=f.shift()||"",n},n.rtcpfb=function(e){var f=e.substr(10).split(" "),n={};return n.id=f.shift(),n.type=f.shift(),"trr-int"===n.type?n.value=f.shift():n.subtype=f.shift()||"",n.parameters=f,n},n.candidate=function(e){var f;f=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:f[0],component:f[1],protocol:f[2].toLowerCase(),priority:f[3],ip:f[4],port:f[5],type:f[7],generation:"0"},o=8;o<f.length;o+=2)"raddr"===f[o]?n.relAddr=f[o+1]:"rport"===f[o]?n.relPort=f[o+1]:"generation"===f[o]?n.generation=f[o+1]:"tcptype"===f[o]&&(n.tcpType=f[o+1]);return n.network="1",n},n.sourceGroups=function(e){for(var f=[],n=0;n<e.length;n++){var o=e[n].substr(13).split(" ");f.push({semantics:o.shift(),sources:o})}return f},n.sources=function(e){for(var f=[],n={},o=0;o<e.length;o++){var d=e[o].substr(7).split(" "),i=d.shift();if(!n[i]){var t={ssrc:i,parameters:[]};f.push(t),n[i]=t}d=d.join(" ").split(":");var l=d.shift(),u=d.join(":")||null;n[i].parameters.push({key:l,value:u})}return f},n.groups=function(e){for(var f,n=[],o=0;o<e.length;o++)f=e[o].substr(8).split(" "),n.push({semantics:f.shift(),contents:f});return n},n.bandwidth=function(e){var f=e.substr(2).split(":"),n={};return n.type=f.shift(),n.bandwidth=f.shift(),n}},{}],206:[function(e,f,n){var o=e("./parsers"),d=Math.random();n._setIdCounter=function(e){d=e},n.toSessionJSON=function(e,f){for(var d=e.split("\r\nm="),i=1;i<d.length;i++)d[i]="m="+d[i],i!==d.length-1&&(d[i]+="\r\n");var t=d.shift()+"\r\n",l=o.lines(t),u={},p=[];d.forEach(function(e){p.push(n.toMediaJSON(e,t,f))}),u.contents=p;var s=o.findLines("a=group:",l);return s.length&&(u.groups=o.groups(s)),u},n.toMediaJSON=function(e,f,d){var i=o.lines(e),t=o.lines(f),l=o.mline(i[0]),u={creator:d,name:l.media,description:{descType:"rtp",media:l.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}};"application"==l.media&&(u.description={descType:"datachannel"},u.transport.sctp=[]);var p=u.description,s=u.transport,y=o.findLine("a=mid:",i);if(y&&(u.name=y.substr(6)),o.findLine("a=sendrecv",i,t)?u.senders="both":o.findLine("a=sendonly",i,t)?u.senders="initiator":o.findLine("a=recvonly",i,t)?u.senders="responder":o.findLine("a=inactive",i,t)&&(u.senders="none"),"rtp"==p.descType){var c=o.findLine("b=",i);c&&(p.bandwidth=o.bandwidth(c));var a=o.findLine("a=ssrc:",i);a&&(p.ssrc=a.substr(7).split(" ")[0]);var r=o.findLines("a=rtpmap:",i);r.forEach(function(e){var f=o.rtpmap(e);f.feedback=[];var n=o.findLines("a=fmtp:"+f.id,i);n.forEach(function(e){f.parameters=o.fmtp(e)});var d=o.findLines("a=rtcp-fb:"+f.id,i);d.forEach(function(e){f.feedback.push(o.rtcpfb(e))}),p.payloads.push(f)});var w=o.findLines("a=crypto:",i,t);w.forEach(function(e){p.encryption.push(o.crypto(e))}),o.findLine("a=rtcp-mux",i)&&(p.mux=!0);var b=o.findLines("a=rtcp-fb:*",i);b.forEach(function(e){p.feedback.push(o.rtcpfb(e))});var m=o.findLines("a=extmap:",i);m.forEach(function(e){var f=o.extmap(e),n={sendonly:"responder",recvonly:"initiator",sendrecv:"both",inactive:"none"};f.senders=n[f.senders],p.headerExtensions.push(f)});var g=o.findLines("a=ssrc-group:",i);p.sourceGroups=o.sourceGroups(g||[]);var x=o.findLines("a=ssrc:",i);p.sources=o.sources(x||[])}var P=o.findLines("a=fingerprint:",i,t),j=o.findLine("a=setup:",i,t);P.forEach(function(e){var f=o.fingerprint(e);j&&(f.setup=j.substr(8)),s.fingerprints.push(f)});var v=o.findLine("a=ice-ufrag:",i,t),M=o.findLine("a=ice-pwd:",i,t);if(v&&M){s.ufrag=v.substr(12),s.pwd=M.substr(10),s.candidates=[];var X=o.findLines("a=candidate:",i,t);X.forEach(function(e){s.candidates.push(n.toCandidateJSON(e))})}if("datachannel"==p.descType){var h=o.findLines("a=sctpmap:",i);h.forEach(function(e){var f=o.sctpmap(e);s.sctp.push(f)})}return u},n.toCandidateJSON=function(e){var f=o.candidate(e.split("\r\n")[0]);return f.id=(d++).toString(36).substr(0,12),f}},{"./parsers":205}],207:[function(e,f,n){var o={initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",sendonly:"initator",recvonly:"responder",sendrecv:"both",inactive:"none"};n.toSessionSDP=function(e,f,o){var d=["v=0","o=- "+(f||e.sid||Date.now())+" "+(o||Date.now())+" IN IP4 0.0.0.0","s=-","t=0 0"],i=e.groups||[];i.forEach(function(e){d.push("a=group:"+e.semantics+" "+e.contents.join(" "))});var t=e.contents||[];return t.forEach(function(e){d.push(n.toMediaSDP(e))}),d.join("\r\n")+"\r\n"},n.toMediaSDP=function(e){var f=[],d=e.description,i=e.transport,t=d.payloads||[],l=i&&i.fingerprints||[],u=[];if("datachannel"==d.descType?(u.push("application"),u.push("1"),u.push("DTLS/SCTP"),i.sctp&&i.sctp.forEach(function(e){u.push(e.number)})):(u.push(d.media),u.push("1"),u.push(d.encryption&&d.encryption.length>0||l.length>0?"RTP/SAVPF":"RTP/AVPF"),t.forEach(function(e){u.push(e.id)})),f.push("m="+u.join(" ")),f.push("c=IN IP4 0.0.0.0"),d.bandwidth&&d.bandwidth.type&&d.bandwidth.bandwidth&&f.push("b="+d.bandwidth.type+":"+d.bandwidth.bandwidth),"rtp"==d.descType&&f.push("a=rtcp:1 IN IP4 0.0.0.0"),i){i.ufrag&&f.push("a=ice-ufrag:"+i.ufrag),i.pwd&&f.push("a=ice-pwd:"+i.pwd);var p=!1;l.forEach(function(e){f.push("a=fingerprint:"+e.hash+" "+e.value),e.setup&&!p&&f.push("a=setup:"+e.setup)}),i.sctp&&i.sctp.forEach(function(e){f.push("a=sctpmap:"+e.number+" "+e.protocol+" "+e.streams)})}"rtp"==d.descType&&f.push("a="+(o[e.senders]||"sendrecv")),f.push("a=mid:"+e.name),d.mux&&f.push("a=rtcp-mux");var s=d.encryption||[];s.forEach(function(e){f.push("a=crypto:"+e.tag+" "+e.cipherSuite+" "+e.keyParams+(e.sessionParams?" "+e.sessionParams:""))}),t.forEach(function(e){var n="a=rtpmap:"+e.id+" "+e.name+"/"+e.clockrate;if(e.channels&&"1"!=e.channels&&(n+="/"+e.channels),f.push(n),e.parameters&&e.parameters.length){var o=["a=fmtp:"+e.id],d=[];e.parameters.forEach(function(e){d.push((e.key?e.key+"=":"")+e.value)}),o.push(d.join(";")),f.push(o.join(" "))}e.feedback&&e.feedback.forEach(function(n){f.push("trr-int"===n.type?"a=rtcp-fb:"+e.id+" trr-int "+n.value?n.value:"0":"a=rtcp-fb:"+e.id+" "+n.type+(n.subtype?" "+n.subtype:""))})}),d.feedback&&d.feedback.forEach(function(e){f.push("trr-int"===e.type?e.value:"a=rtcp-fb:* "+e.type+(e.subtype?" "+e.subtype:""))});var y=d.headerExtensions||[];y.forEach(function(e){f.push("a=extmap:"+e.id+(e.senders?"/"+o[e.senders]:"")+" "+e.uri)});var c=d.sourceGroups||[];c.forEach(function(e){f.push("a=ssrc-group:"+e.semantics+" "+e.sources.join(" "))});var a=d.sources||[];a.forEach(function(e){for(var n=0;n<e.parameters.length;n++){var o=e.parameters[n];f.push("a=ssrc:"+(e.ssrc||d.ssrc)+" "+o.key+(o.value?":"+o.value:""))}});var r=i.candidates||[];return r.forEach(function(e){f.push(n.toCandidateSDP(e))}),f.join("\r\n")},n.toCandidateSDP=function(e){var f=[];f.push(e.foundation),f.push(e.component),f.push(e.protocol.toUpperCase()),f.push(e.priority),f.push(e.ip),f.push(e.port);var n=e.type;return f.push("typ"),f.push(n),("srflx"===n||"prflx"===n||"relay"===n)&&e.relAddr&&e.relPort&&(f.push("raddr"),f.push(e.relAddr),f.push("rport"),f.push(e.relPort)),e.tcpType&&(f.push("tcptype"),f.push(e.tcpType)),f.push("generation"),f.push(e.generation||"0"),"a=candidate:"+f.join(" ")}},{}],208:[function(e,f){f.exports=e(201)},{}],209:[function(e,f,n){"use strict";var o=e("jxt"),d=e("xmpp-jid").JID;n.jidAttribute=function(e,f){return{get:function(){var n=new d(o.getAttribute(this.xml,e));return f&&(n.prepped=!0),n},set:function(f){o.setAttribute(this.xml,e,(f||"").toString())}}},n.jidSub=function(e,f,n){return{get:function(){var i=new d(o.getSubText(this.xml,e,f));return n&&(i.prepped=!0),i},set:function(n){o.setSubText(this.xml,e,f,(n||"").toString())}}},n.tzoSub=o.field(function(e,f,n,d){var i,t,l,u=-1,p=o.getSubText(e,f,n);return p?("-"===p.charAt(0)&&(u=1,p=p.slice(1)),i=p.split(":"),t=parseInt(i[0],10),l=parseInt(i[1],10),(60*t+l)*u):d},function(e,f,n,d){var i,t,l="-";"number"==typeof d?(0>d&&(d=-d,l="+"),i=d/60,t=d%60,l+=(10>i?"0":"")+i+":"+(10>t?"0":"")+t):l=d,o.setSubText(e,f,n,l)})},{jxt:210,"xmpp-jid":236}],210:[function(e,f){"use strict";function n(){this._LOOKUP={},this._LOOKUP_EXT={},this._TAGS={},this._CB_DEFINITION={},this._CB_TAG={},this._ID=i.v4(),this.utils=d({},t,l)}var o=e("ltx"),d=e("extend-object"),i=e("node-uuid"),t=e("./lib/types"),l=e("./lib/helpers"),u=e("./lib/stanza");n.prototype.use=function(e){return e["__JXT_LOADED_"+this._ID]||e(this),e["__JXT_LOADED_"+this._ID]=!0,this},n.prototype.getDefinition=function(e,f,n){var o=this._LOOKUP[f+"|"+e];if(n&&!o)throw new Error("Could not find definition for <"+e+' xmlns="'+f+'" />');return o},n.prototype.getExtensions=function(e,f){return this._LOOKUP_EXT[f+"|"+e]||{}},n.prototype.withDefinition=function(e,f,n){var o=f+"|"+e;this._CB_DEFINITION[o]||(this._CB_DEFINITION[o]=[]),this._CB_DEFINITION[o].push(n),this._LOOKUP[o]&&n(this._LOOKUP[o])},n.prototype.withTag=function(e,f){this._CB_TAG[e]||(this._CB_TAG[e]=[]),this._CB_TAG[e].push(f),this.tagged(e).forEach(function(e){f(e)})},n.prototype.tagged=function(e){return this._TAGS[e]||[]},n.prototype.build=function(e){var f=this._LOOKUP[e.namespaceURI+"|"+e.localName];return f?new f(null,e):void 0},n.prototype.parse=function(e){var f=o.parse(e);if(1===f.nodeType){var n=this.getDefinition(f.localName,f.namespaceURI);return n?new n(null,f):void 0}},n.prototype.extend=function(e,f,n){var o=e.prototype._NS+"|"+e.prototype._EL,d=f.prototype._name,i=f.prototype._NS+"|"+f.prototype._EL;this._LOOKUP[i]=f,this._LOOKUP_EXT[i]||(this._LOOKUP_EXT[i]={}),this._LOOKUP_EXT[o]||(this._LOOKUP_EXT[o]={}),this._LOOKUP_EXT[o][d]=f,this.add(e,d,t.extension(f)),n&&this.add(e,n,t.multiExtension(f))},n.prototype.add=function(e,f,n){n.enumerable=!0,Object.defineProperty(e.prototype,f,n)},n.prototype.define=function(e){var f=this,n=u(this,e),o=n.prototype._NS,d=n.prototype._EL,i=n.prototype._TAGS,t=o+"|"+d;this._LOOKUP[t]=n,i.forEach(function(e){f._TAGS[e]||(f._TAGS[e]=[]),f._TAGS[e].push(n)});var l=Object.keys(e.fields||{});return l.forEach(function(o){f.add(n,o,e.fields[o])}),this._CB_DEFINITION[t]&&this._CB_DEFINITION[t].forEach(function(e){e(n)}),i.forEach(function(e){f._CB_TAG[e]&&f._CB_TAG[e].forEach(function(e){e(n)})}),n},n.createRegistry=function(){return new n},d(n,l),d(n,t);var p=new n;n.define=p.define.bind(p),n.extend=p.extend.bind(p),n.add=p.add.bind(p),n.parse=p.parse.bind(p),n.build=p.build.bind(p),n.getExtensions=p.getExtensions.bind(p),n.getDefinition=p.getDefinition.bind(p),n.withDefinition=p.withDefinition.bind(p),n.withTag=p.withTag.bind(p),n.tagged=p.tagged.bind(p),n.getGlobalJXT=function(){return p},f.exports=n},{"./lib/helpers":211,"./lib/stanza":212,"./lib/types":213,"extend-object":214,ltx:217,"node-uuid":221}],211:[function(e,f,n){"use strict";var o=e("ltx"),d=n.XML_NS="http://www.w3.org/XML/1998/namespace";n.createElement=function(e,f,d){var i=new o.Element(f);return d&&d===e||n.setAttribute(i,"xmlns",e),i};var i=n.find=function(e,f,n){for(var o=[],d=e.getElementsByTagName(n),i=0,t=d.length;t>i;i++){var l=d[i];l.namespaceURI===f&&l.parentNode===e&&o.push(l)}return o};n.findOrCreate=function(e,f,o){var d=n.find(e,f,o);if(d.length)return d[0];var i=n.createElement(f,o,e.namespaceURI);return e.appendChild(i),i},n.getAttribute=function(e,f,n){return e.getAttribute(f)||n||""},n.getAttributeNS=function(e,f,n,o){return e.getAttributeNS(f,n)||o||""},n.setAttribute=function(e,f,n,o){n||o?e.setAttribute(f,n):e.removeAttribute(f)},n.setAttributeNS=function(e,f,n,o,d){o||d?e.setAttributeNS(f,n,o):e.removeAttributeNS(f,n)},n.getBoolAttribute=function(e,f,n){var o=e.getAttribute(f)||n||"";return"true"===o||"1"===o},n.setBoolAttribute=function(e,f,n){n?e.setAttribute(f,"1"):e.removeAttribute(f)},n.getSubAttribute=function(e,f,n,o,d){var t=i(e,f,n);if(!t)return"";for(var l=0;l<t.length;l++)return t[l].getAttribute(o)||d||"";return""},n.setSubAttribute=function(e,f,o,d,t){var l=i(e,f,o);if(l.length)for(var u=0;u<l.length;u++){if(t)return void l[u].setAttribute(d,t);l[u].removeAttribute(d)}else t&&(o=n.createElement(f,o,e.namespaceURI),o.setAttribute(d,t),e.appendChild(o))},n.getBoolSubAttribute=function(e,f,n,o,d){var i=e.getSubAttribute(f,n,o)||d||"";return"true"===i||"1"===i},n.setBoolSubAttribute=function(e,f,o,d,i){i=i?"1":"",n.setSubAttribute(e,f,o,d,i)},n.getText=function(e){return e.textContent},n.setText=function(e,f){e.textContent=f},n.getSubText=n.getTextSub=function(e,f,n,o){var d=i(e,f,n);return o=o||"",d.length?d[0].textContent||o:o},n.setSubText=n.setTextSub=function(e,f,o,d){var t=i(e,f,o);if(t.length)for(var l=0;l<t.length;l++)e.removeChild(t[l]);if(d){var u=n.createElement(f,o,e.namespaceURI);d!==!0&&(u.textContent=d),e.appendChild(u)}},n.getMultiSubText=function(e,f,n,o){var d=i(e,f,n),t=[];o=o||function(e){return e.textContent||""};for(var l=0;l<d.length;l++)t.push(o(d[l]));return t},n.setMultiSubText=function(e,f,o,d,t){var l=i(e,f,o),u=[];t=t||function(d){var i=n.createElement(f,o,e.namespaceURI);i.textContent=d,e.appendChild(i)},u="string"==typeof d?(d||"").split("\n"):d;var p,s;for(p=0,s=l.length;s>p;p++)e.removeChild(l[p]);for(p=0,s=u.length;s>p;p++)u[p]&&t(u[p])},n.getMultiSubAttribute=function(e,f,o,d){return n.getMultiSubText(e,f,o,function(e){return n.getAttribute(e,d)})},n.setMultiSubAttribute=function(e,f,o,d,i){n.setMultiSubText(e,f,o,i,function(i){var t=n.createElement(f,o,e.namespaceURI);n.setAttribute(t,d,i),e.appendChild(t)})},n.getSubLangText=function(e,f,n,o){var t=i(e,f,n);if(!t.length)return{};for(var l,u,p={},s=[],y=0;y<t.length;y++)u=t[y],l=u.getAttributeNS(d,"lang")||o,s.push(l),p[l]=u.textContent||"";return p},n.setSubLangText=function(e,f,o,t,l){var u,p,s=i(e,f,o);if(s.length)for(var y=0;y<s.length;y++)e.removeChild(s[y]);if("string"==typeof t)u=n.createElement(f,o,e.namespaceURI),u.textContent=t,e.appendChild(u);else if("object"==typeof t)for(p in t)t.hasOwnProperty(p)&&(u=n.createElement(f,o,e.namespaceURI),p!==l&&u.setAttributeNS(d,"lang",p),u.textContent=t[p],e.appendChild(u))},n.getBoolSub=function(e,f,n){var o=i(e,f,n);return!!o.length},n.setBoolSub=function(e,f,o,d){var t=i(e,f,o);if(t.length)for(var l=0;l<t.length;l++){if(d)return;e.removeChild(t[l])}else if(d){var u=n.createElement(f,o,e.namespaceURI);e.appendChild(u)}}},{ltx:217}],212:[function(e,f){"use strict";var n=e("./helpers"),o=e("extend-object"),d={constructor:!0,parent:!0,prototype:!0,toJSON:!0,toString:!0,xml:!0};f.exports=function(e,f){function i(d,i,t){var l=this,u=(i||{}).parentNode||(t||{}).xml,p=(u||{}).namespaceURI;l.xml=i||n.createElement(l._NS,l._EL,p),Object.keys(f.prefixes||{}).forEach(function(e){var n=f.prefixes[e];l.xml.setAttribute("xmlns:"+e,n)}),l._extensions={};for(var s=0,y=l.xml.childNodes.length;y>s;s++){var c=l.xml.childNodes[s],a=e.getDefinition(c.localName,c.namespaceURI);if(void 0!==a){var r=a.prototype._name;l._extensions[r]=new a(null,c),l._extensions[r].parent=l}}return o(l,d),f.init&&f.init.apply(l,[d]),l}return i.prototype._name=f.name,i.prototype._eventname=f.eventName,i.prototype._NS=f.namespace,i.prototype._EL=f.element||f.name,i.prototype._TAGS=f.tags||[],i.prototype.toString=function(){return this.xml.toString()},i.prototype.toJSON=function(){var f,n={};for(f in this._extensions)this._extensions[f].toJSON&&"_"!==f[0]&&(n[f]=this._extensions[f].toJSON());for(f in this){var o=!d[f]&&"_"!==f[0],i=e.getExtensions(this._EL,this._NS)[f];if(o&&!i){var t=this[f];if("function"==typeof t)continue;var l=Object.prototype.toString.call(t);if(l.indexOf("Object")>=0)Object.keys(t).length>0&&(n[f]=t);else if(l.indexOf("Array")>=0){if(t.length>0){var u=[];for(var p in t){var s=t[p];u.push(void 0!==s.toJSON?s.toJSON():s)}n[f]=u}}else void 0!==t&&t!==!1&&""!==t&&(n[f]=t)}}return n},i}},{"./helpers":211,"extend-object":214}],213:[function(e,f,n){"use strict";var o=e("atob"),d=e("btoa"),i=e("./helpers"),t=e("extend-object"),l=i.find,u=i.createElement,p=n.field=function(e,f){return function(){var n=Array.prototype.slice.call(arguments);return{get:function(){return e.apply(null,[this.xml].concat(n))},set:function(e){f.apply(null,[this.xml].concat(n).concat([e]))}}}};n.boolAttribute=p(i.getBoolAttribute,i.setBoolAttribute),n.subAttribute=p(i.getSubAttribute,i.setSubAttribute),n.boolSubAttribute=p(i.getSubBoolAttribute,i.setSubBoolAttribute),n.text=p(i.getText,i.setText),n.subText=p(i.getSubText,i.setSubText),n.multiSubText=p(i.getMultiSubText,i.setMultiSubText),n.multiSubAttribute=p(i.getMultiSubAttribute,i.setMultiSubAttribute),n.subLangText=p(i.getSubLangText,i.setSubLangText),n.boolSub=p(i.getBoolSub,i.setBoolSub),n.langAttribute=p(function(e){return e.getAttributeNS(i.XML_NS,"lang")||""},function(e,f){e.setAttributeNS(i.XML_NS,"lang",f)}),n.b64Text=p(function(e){return e.textContent&&"="!==e.textContent?o(e.textContent):""},function(e,f){e.textContent="string"==typeof f?d(f)||"=":""}),n.dateAttribute=function(e,f){return{get:function(){var n=i.getAttribute(this.xml,e);return n?new Date(n):f?new Date(Date.now()):void 0},set:function(f){f&&("string"!=typeof f&&(f=f.toISOString()),i.setAttribute(this.xml,e,f))}}},n.dateSub=function(e,f,n){return{get:function(){var o=i.getSubText(this.xml,e,f);return o?new Date(o):n?new Date(Date.now()):void 0},set:function(n){n&&("string"!=typeof n&&(n=n.toISOString()),i.setSubText(this.xml,e,f,n))}}},n.dateSubAttribute=function(e,f,n,o){return{get:function(){var d=i.getSubAttribute(this.xml,e,f,n);return d?new Date(d):o?new Date(Date.now()):void 0},set:function(o){o&&("string"!=typeof o&&(o=o.toISOString()),i.setSubAttribute(this.xml,e,f,n,o))}}},n.numberAttribute=function(e,f,n){return{get:function(){var o=f?parseFloat:parseInt,d=i.getAttribute(this.xml,e,"");if(!d)return n;var t=o(d,10);return isNaN(t)?n:t},set:function(f){i.setAttribute(this.xml,e,f.toString())}}},n.numberSub=function(e,f,n,o){return{get:function(){var d=n?parseFloat:parseInt,t=i.getSubText(this.xml,e,f,"");if(!t)return o;var l=d(t,10);return isNaN(l)?o:l},set:function(n){i.setSubText(this.xml,e,f,n.toString())}}},n.attribute=function(e,f){return{get:function(){return i.getAttribute(this.xml,e,f)},set:function(f){i.setAttribute(this.xml,e,f)}}},n.attributeNS=function(e,f,n){return{get:function(){return i.getAttributeNS(this.xml,e,f,n)},set:function(n){i.setAttributeNS(this.xml,e,f,n)}}},n.extension=function(e){return{get:function(){var f=this,n=e.prototype._name;if(!this._extensions[n]){var o=l(this.xml,e.prototype._NS,e.prototype._EL);o.length?this._extensions[n]=new e(null,o[0],f):(this._extensions[n]=new e({},null,f),this.xml.appendChild(this._extensions[n].xml)),this._extensions[n].parent=this}return this._extensions[n]},set:function(f){if(f){var n=this[e.prototype._name];f===!0&&(f={}),t(n,f)}}}},n.multiExtension=function(e){return{get:function(){for(var f=this,n=l(this.xml,e.prototype._NS,e.prototype._EL),o=[],d=0,i=n.length;i>d;d++)o.push(new e({},n[d],f));return o},set:function(f){f=f||[];var n,o,d=this,i=l(this.xml,e.prototype._NS,e.prototype._EL);for(n=0,o=i.length;o>n;n++)d.xml.removeChild(i[n]);for(n=0,o=f.length;o>n;n++){var t=new e(f[n],null,d);d.xml.appendChild(t.xml)}}}},n.enumSub=function(e,f){return{get:function(){var n=this,o=[];return f.forEach(function(f){var d=l(n.xml,e,f);d.length&&o.push(d[0].nodeName)}),o[0]||""},set:function(n){var o=this;
if(f.forEach(function(f){var n=l(o.xml,e,f);n.length&&o.xml.removeChild(n[0])}),n){var d=u(e,n);this.xml.appendChild(d)}}}},n.subExtension=function(e,f,n,o){return{get:function(){if(!this._extensions[e]){var d=l(this.xml,f,n);d.length?d=d[0]:(d=u(f,n,this._NS),this.xml.appendChild(d));var i=l(d,o.prototype._NS,o.prototype._EL);i.length?this._extensions[e]=new o(null,i[0],{xml:d}):(this._extensions[e]=new o({},null,{xml:d}),d.appendChild(this._extensions[e].xml)),this._extensions[e].parent=this}return this._extensions[e]},set:function(o){var d=l(this.xml,f,n);if(d.length&&!o&&this.xml.removeChild(d[0]),o){var i=this[e];o===!0&&(o={}),t(i,o)}}}},n.subMultiExtension=function(e,f,n){return{get:function(){var o=this,d=[],i=l(this.xml,e,f);if(!i.length)return d;i=i[0];var t=l(i,n.prototype._NS,n.prototype._EL);return t.forEach(function(e){d.push(new n({},e,o))}),d},set:function(o){var d=this,i=l(this.xml,e,f);i.length&&d.xml.removeChild(i[0]),o.length&&(i=u(e,f,this._NS),o.forEach(function(e){var f=new n(e,null,d);i.appendChild(f.xml)}),d.xml.appendChild(i))}}}},{"./helpers":211,atob:109,btoa:170,"extend-object":214}],214:[function(e,f){var n=[],o=n.forEach,d=n.slice;f.exports=function(e){return o.call(d.call(arguments,1),function(f){if(f)for(var n in f)e[n]=f[n]}),e}},{}],215:[function(e,f){"use strict";function n(e,f){d.call(this,e,f),this.nodeType=1,this.nodeName=this.localName}var o=e("util"),d=e("./element").Element;o.inherits(n,d),n.prototype._getElement=function(e,f){var o=new n(e,f);return o},Object.defineProperty(n.prototype,"localName",{get:function(){return this.getName()}}),Object.defineProperty(n.prototype,"namespaceURI",{get:function(){return this.getNS()}}),Object.defineProperty(n.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(n.prototype,"childNodes",{get:function(){return this.children}}),Object.defineProperty(n.prototype,"textContent",{get:function(){return this.getText()},set:function(e){this.children.push(e)}}),n.prototype.getElementsByTagName=function(e){return this.getChildren(e)},n.prototype.getAttribute=function(e){return this.getAttr(e)},n.prototype.setAttribute=function(e,f){this.attr(e,f)},n.prototype.getAttributeNS=function(e,f){return"http://www.w3.org/XML/1998/namespace"===e?this.getAttr(["xml",f].join(":")):this.getAttr(f,e)},n.prototype.setAttributeNS=function(e,f,n){var o;if("http://www.w3.org/XML/1998/namespace"===e)o="xml";else{var d=this.getXmlns();o=d[e]||""}o&&this.attr([o,f].join(":"),n)},n.prototype.removeAttribute=function(e){this.attr(e,null)},n.prototype.appendChild=function(e){this.cnode(e)},n.prototype.removeChild=function(e){this.remove(e)},f.exports=n},{"./element":216,util:169}],216:[function(e,f,n){"use strict";function o(e,f){this.name=e,this.parent=null,this.attrs=f||{},this.children=[]}function d(e){return e.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/"/g,"&apos;")}function i(e){return e.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}o.prototype.is=function(e,f){return this.getName()===e&&(!f||this.getNS()===f)},o.prototype.getName=function(){return this.name.indexOf(":")>=0?this.name.substr(this.name.indexOf(":")+1):this.name},o.prototype.getNS=function(){if(this.name.indexOf(":")>=0){var e=this.name.substr(0,this.name.indexOf(":"));return this.findNS(e)}return this.findNS()},o.prototype.findNS=function(e){if(e){var f="xmlns:"+e;if(this.attrs[f])return this.attrs[f];if(this.parent)return this.parent.findNS(e)}else{if(this.attrs.xmlns)return this.attrs.xmlns;if(this.parent)return this.parent.findNS()}},o.prototype.getXmlns=function(){var e={};this.parent&&(e=this.parent.getXmlns());for(var f in this.attrs){var n=f.match("xmlns:?(.*)");this.attrs.hasOwnProperty(f)&&n&&(e[this.attrs[f]]=n[1])}return e},o.prototype.getAttr=function(e,f){if(!f)return this.attrs[e];var n=this.getXmlns();return n[f]?this.attrs[[n[f],e].join(":")]:null},o.prototype.getChild=function(e,f){return this.getChildren(e,f)[0]},o.prototype.getChildren=function(e,f){for(var n=[],o=0;o<this.children.length;o++){var d=this.children[o];!d.getName||d.getName()!==e||f&&d.getNS()!==f||n.push(d)}return n},o.prototype.getChildByAttr=function(e,f,n,o){return this.getChildrenByAttr(e,f,n,o)[0]},o.prototype.getChildrenByAttr=function(e,f,n,o){for(var d=[],i=0;i<this.children.length;i++){var t=this.children[i];!t.attrs||t.attrs[e]!==f||n&&t.getNS()!==n||d.push(t),o&&t.getChildrenByAttr&&d.push(t.getChildrenByAttr(e,f,n,!0))}return o&&(d=[].concat.apply([],d)),d},o.prototype.getChildrenByFilter=function(e,f){for(var n=[],o=0;o<this.children.length;o++){var d=this.children[o];e(d)&&n.push(d),f&&d.getChildrenByFilter&&n.push(d.getChildrenByFilter(e,!0))}return f&&(n=[].concat.apply([],n)),n},o.prototype.getText=function(){for(var e="",f=0;f<this.children.length;f++){var n=this.children[f];("string"==typeof n||"number"==typeof n)&&(e+=n)}return e},o.prototype.getChildText=function(e,f){var n=this.getChild(e,f);return n?n.getText():null},o.prototype.getChildElements=function(){return this.getChildrenByFilter(function(e){return e instanceof o})},o.prototype.root=function(){return this.parent?this.parent.root():this},o.prototype.tree=o.prototype.root,o.prototype.up=function(){return this.parent?this.parent:this},o.prototype._getElement=function(e,f){var n=new o(e,f);return n},o.prototype.c=function(e,f){return this.cnode(this._getElement(e,f))},o.prototype.cnode=function(e){return this.children.push(e),e.parent=this,e},o.prototype.t=function(e){return this.children.push(e),this},o.prototype.remove=function(e,f){var n;return n="string"==typeof e?function(n){return!(n.is&&n.is(e,f))}:function(f){return f!==e},this.children=this.children.filter(n),this},o.prototype.clone=function(){var e=this._getElement(this.name,{});for(var f in this.attrs)this.attrs.hasOwnProperty(f)&&(e.attrs[f]=this.attrs[f]);for(var n=0;n<this.children.length;n++){var o=this.children[n];e.cnode(o.clone?o.clone():o)}return e},o.prototype.text=function(e){return e&&1===this.children.length?(this.children[0]=e,this):this.getText()},o.prototype.attr=function(e,f){return"undefined"!=typeof f||null===f?(this.attrs||(this.attrs={}),this.attrs[e]=f,this):this.attrs[e]},o.prototype.toString=function(){var e="";return this.write(function(f){e+=f}),e},o.prototype._addChildren=function(e){e(">");for(var f=0;f<this.children.length;f++){var n=this.children[f];(n||0===n)&&(n.write?n.write(e):"string"==typeof n?e(i(n)):n.toString&&e(i(n.toString(10))))}e("</"),e(this.name),e(">")},o.prototype.write=function(e){e("<"),e(this.name);for(var f in this.attrs){var n=this.attrs[f];(n||""===n||0===n)&&(e(" "),e(f),e('="'),"string"!=typeof n&&(n=n.toString(10)),e(d(n)),e('"'))}0===this.children.length?e("/>"):this._addChildren(e)},n.Element=o,n.escapeXml=d},{}],217:[function(e,f){"use strict";var n=e("./parse");n.availableSaxParsers.push(n.bestSaxParser=e("./sax/sax_ltx")),f.exports=e("./index")},{"./index":218,"./parse":219,"./sax/sax_ltx":220}],218:[function(e,f,n){"use strict";var o=e("./parse");n.Element=e("./dom-element"),n.escapeXml=e("./element").escapeXml,n.parse=o.parse,n.Parser=o.Parser,n.availableSaxParsers=o.availableSaxParsers,n.bestSaxParser=o.bestSaxParser},{"./dom-element":215,"./element":216,"./parse":219}],219:[function(e,f,n){"use strict";var o=e("events"),d=e("util"),i=e("./dom-element");n.availableSaxParsers=[],n.bestSaxParser=null;var t=["./sax/sax_expat.js","./sax/sax_ltx.js","./sax/sax_saxjs.js"];t.forEach(function(f){var o;try{o=e(f)}catch(d){}o&&(n.availableSaxParsers.push(o),n.bestSaxParser||(n.bestSaxParser=o))}),n.Parser=function(e){o.EventEmitter.call(this);var f=this,d=e||n.bestSaxParser;if(!d)throw new Error("No SAX parser available");this.parser=new d;var t;this.parser.addListener("startElement",function(e,f){var n=new i(e,f);t=t?t.cnode(n):n}),this.parser.addListener("endElement",function(e){t&&e===t.name&&(t.parent?t=t.parent:f.tree||(f.tree=t,t=void 0))}),this.parser.addListener("text",function(e){t&&t.t(e)}),this.parser.addListener("error",function(e){f.error=e,f.emit("error",e)})},d.inherits(n.Parser,o.EventEmitter),n.Parser.prototype.write=function(e){this.parser.write(e)},n.Parser.prototype.end=function(e){this.parser.end(e),this.error||(this.tree?this.emit("tree",this.tree):this.emit("error",new Error("Incomplete document")))},n.parse=function(e,f){var o=new n.Parser(f),d=null,i=null;if(o.on("tree",function(e){d=e}),o.on("error",function(e){i=e}),o.write(e),o.end(),i)throw i;return d}},{"./dom-element":215,events:164,util:169}],220:[function(e,f){"use strict";function n(e){return e.replace(/\&amp;/g,"&").replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&quot;/g,'"').replace(/\&apos;/g,"'")}var o=e("util"),d=e("events"),i=0,t=1,l=2,u=3,p=4,s=5,y=6,c=7,a=f.exports=function(){d.EventEmitter.call(this);var e,f,o,a,r,w,b,m=i,g=0;this._handleTagOpening=function(e,f,n){e?this.emit("endElement",f):(this.emit("startElement",f,n),r&&this.emit("endElement",f))},this.write=function(d){function x(){if("number"==typeof g){var e=d.slice(g,P);return g=void 0,e}}"string"!=typeof d&&(d=d.toString());var P=0;for(e&&(d=e+d,P+=e.length,e=null);P<d.length;P++){var j=d.charCodeAt(P);switch(m){case i:if(60===j){var v=x();v&&this.emit("text",n(v)),m=l,g=P+1,o={}}break;case l:47===j&&g===P?(g=P+1,a=!0):33===j||63===j?(g=void 0,m=t):(32>=j||47===j||62===j)&&(f=x(),P--,m=u);break;case t:62===j&&(m=i);break;case u:62===j?(this._handleTagOpening(a,f,o),f=void 0,o=void 0,a=void 0,r=void 0,m=i,g=P+1):47===j?r=!0:j>32&&(g=P,m=p);break;case p:(32>=j||61===j)&&(b=x(),P--,m=s);break;case s:61===j&&(m=y);break;case y:(34===j||39===j)&&(w=j,m=c,g=P+1);break;case c:if(j===w){var M=n(x());o[b]=M,b=void 0,m=u}}}"number"==typeof g&&g<=d.length&&(e=d.slice(g),g=0)}};o.inherits(a,d.EventEmitter),a.prototype.end=function(e){e&&this.write(e),this.write=function(){}}},{events:164,util:169}],221:[function(f,n){(function(o){(function(){function d(e,f,n){var o=f&&n||0,d=0;for(f=f||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>d&&(f[o+d++]=b[e])});16>d;)f[o+d++]=0;return f}function i(e,f){var n=f||0,o=w;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]}function t(e,f,n){var o=f&&n||0,d=f||[];e=e||{};var t=null!=e.clockseq?e.clockseq:P,l=null!=e.msecs?e.msecs:(new Date).getTime(),u=null!=e.nsecs?e.nsecs:v+1,p=l-j+(u-v)/1e4;if(0>p&&null==e.clockseq&&(t=t+1&16383),(0>p||l>j)&&null==e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");j=l,v=u,P=t,l+=122192928e5;var s=(1e4*(268435455&l)+u)%4294967296;d[o++]=s>>>24&255,d[o++]=s>>>16&255,d[o++]=s>>>8&255,d[o++]=255&s;var y=l/4294967296*1e4&268435455;d[o++]=y>>>8&255,d[o++]=255&y,d[o++]=y>>>24&15|16,d[o++]=y>>>16&255,d[o++]=t>>>8|128,d[o++]=255&t;for(var c=e.node||x,a=0;6>a;a++)d[o+a]=c[a];return f?f:i(d)}function l(e,f,n){var o=f&&n||0;"string"==typeof e&&(f="binary"==e?new r(16):null,e=null),e=e||{};var d=e.random||(e.rng||u)();if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,f)for(var t=0;16>t;t++)f[o+t]=d[t];return f||i(d)}var u,p=this;if("function"==typeof f)try{var s=f("crypto").randomBytes;u=s&&function(){return s(16)}}catch(y){}if(!u&&p.crypto&&crypto.getRandomValues){var c=new Uint8Array(16);u=function(){return crypto.getRandomValues(c),c}}if(!u){var a=new Array(16);u=function(){for(var e,f=0;16>f;f++)0===(3&f)&&(e=4294967296*Math.random()),a[f]=e>>>((3&f)<<3)&255;return a}}for(var r="function"==typeof o?o:Array,w=[],b={},m=0;256>m;m++)w[m]=(m+256).toString(16).substr(1),b[w[m]]=m;var g=u(),x=[1|g[0],g[1],g[2],g[3],g[4],g[5]],P=16383&(g[6]<<8|g[7]),j=0,v=0,M=l;if(M.v1=t,M.v4=l,M.parse=d,M.unparse=i,M.BufferClass=r,"function"==typeof e&&e.amd)e(function(){return M});else if("undefined"!=typeof n&&n.exports)n.exports=M;else{var X=p.uuid;M.noConflict=function(){return p.uuid=X,M},p.uuid=M}}).call(this)}).call(this,f("buffer").Buffer)},{buffer:147,crypto:154}],222:[function(f,n,o){!function(f,d){"object"==typeof o?d(o,n):"function"==typeof e&&e.amd&&e(["exports","module"],d)}(this,function(e,f){function n(){}n.prototype.name="ANONYMOUS",n.prototype.clientFirst=!0,n.prototype.response=function(e){return e.trace||""},n.prototype.challenge=function(){},e=f.exports=n})},{}],223:[function(f,n,o){!function(d,i){"object"==typeof o?i(o,n,f("./lib/mechanism")):"function"==typeof e&&e.amd&&e(["exports","module","./lib/mechanism"],i)}(this,function(e,f,n){e=f.exports=n,e.Mechanism=n})},{"./lib/mechanism":222}],224:[function(f,n,o){!function(f,d){"object"==typeof o?d(o,n):"function"==typeof e&&e.amd&&e(["exports","module"],d)}(this,function(e,f){function n(){}n.prototype.name="EXTERNAL",n.prototype.clientFirst=!0,n.prototype.response=function(e){return e.authzid||""},n.prototype.challenge=function(){},e=f.exports=n})},{}],225:[function(e,f,n){arguments[4][223][0].apply(n,arguments)},{"./lib/mechanism":224}],226:[function(f,n,o){!function(f,d){"object"==typeof o?d(o,n):"function"==typeof e&&e.amd&&e(["exports","module"],d)}(this,function(e,f){function n(){}n.prototype.name="PLAIN",n.prototype.clientFirst=!0,n.prototype.response=function(e){var f="";return f+=e.authzid||"",f+="\x00",f+=e.username,f+="\x00",f+=e.password},n.prototype.challenge=function(){return this},e=f.exports=n})},{}],227:[function(e,f,n){arguments[4][223][0].apply(n,arguments)},{"./lib/mechanism":226}],228:[function(e,f){(function(n){function o(e){e=e||{},this._genNonce=e.genNonce||i.genNonce,this._stage="initial"}var d=e("./lib/bitops"),i=e("./lib/utils"),t={};o.Mechanism=o,o.prototype.name="SCRAM-SHA-1",o.prototype.clientFirst=!0,o.prototype.response=function(e){return t[this._stage](this,e)},o.prototype.challenge=function(e){var f=i.parse(e);return this._salt=new n(f.s||"","base64").toString("binary"),this._iterationCount=parseInt(f.i,10),this._nonce=f.r,this._verifier=f.v,this._error=f.e,this._challenge=e,this},t.initial=function(e,f){e._cnonce=e._genNonce();var n="";f.authzid&&(n="a="+i.saslname(f.authzid)),e._gs2Header="n,"+n+",";var o="r="+e._cnonce,d="n="+i.saslname(f.username);e._clientFirstMessageBare=d+","+o;var t=e._gs2Header+e._clientFirstMessageBare;return e._stage="challenge",t},t.challenge=function(e,f){var o=new n(e._gs2Header).toString("base64");e._clientFinalMessageWithoutProof="c="+o+",r="+e._nonce;var i,t,l;f.clientKey&&f.serverKey?(t=f.clientKey,l=f.serverKey):(i=f.saltedPassword||d.Hi(f.password,e._salt,e._iterationCount),t=d.HMAC(i,"Client Key"),l=d.HMAC(i,"Server Key"));var u=d.H(t),p=e._clientFirstMessageBare+","+e._challenge+","+e._clientFinalMessageWithoutProof,s=d.HMAC(u,p),y=d.XOR(t,s),c=new n(y,"binary").toString("base64");e._serverSignature=d.HMAC(l,p);var a=e._clientFinalMessageWithoutProof+",p="+c;return e._stage="final",e.cache={saltedPassword:i,clientKey:t,serverKey:l},a},t.final=function(){return""},f.exports=o}).call(this,e("buffer").Buffer)},{"./lib/bitops":229,"./lib/utils":230,buffer:147}],229:[function(e,f,n){(function(f){var o=e("crypto"),d=e("bitwise-xor");n.XOR=d,n.H=function(e){return o.createHash("sha1").update(e).digest()},n.HMAC=function(e,f){return o.createHmac("sha1",e).update(f).digest()},n.Hi=function(e,o,d){for(var i=n.HMAC(e,o+new f([0,0,0,1]).toString("binary")),t=i,l=0;d-1>l;l++)i=n.HMAC(e,i),t=n.XOR(t,i);return t}}).call(this,e("buffer").Buffer)},{"bitwise-xor":231,buffer:147,crypto:154}],230:[function(e,f,n){var o=e("crypto");n.parse=function(e){for(var f={},n=e.split(/,(?=(?:[^"]|"[^"]*")*$)/),o=0,d=n.length;d>o;o++){var i=/(\w+)=["]?([^"]+)["]?$/.exec(n[o]);i&&(f[i[1]]=i[2])}return f},n.saslname=function(e){for(var f=[],n="",o=0;o<e.length;o++)n=e[o],f.push(","===n?"=2C":"="===n?"=3D":n);return f.join("")},n.genNonce=function(e){return o.randomBytes((e||32)/2).toString("hex")}},{crypto:154}],231:[function(e,f){(function(e){function n(f,n){e.isBuffer(f)||(f=new e(f)),e.isBuffer(n)||(n=new e(n));var o=[];if(f.length>n.length)for(var d=0;d<n.length;d++)o.push(f[d]^n[d]);else for(var d=0;d<f.length;d++)o.push(f[d]^n[d]);return new e(o)}f.exports=n}).call(this,e("buffer").Buffer)},{buffer:147}],232:[function(f,n,o){!function(f,d){"object"==typeof o?d(o,n):"function"==typeof e&&e.amd&&e(["exports","module"],d)}(this,function(e,f){function n(){this._mechs=[]}n.prototype.use=function(e,f){return f||(f=e,e=f.prototype.name),this._mechs.push({name:e,mech:f}),this},n.prototype.create=function(e){for(var f=0,n=this._mechs.length;n>f;f++)for(var o=0,d=e.length;d>o;o++){var i=this._mechs[f];if(i.name==e[o])return new i.mech}return null},e=f.exports=n})},{}],233:[function(f,n,o){!function(d,i){"object"==typeof o?i(o,n,f("./lib/factory")):"function"==typeof e&&e.amd&&e(["exports","module","./lib/factory"],i)}(this,function(e,f,n){e=f.exports=n,e.Factory=n})},{"./lib/factory":232}],234:[function(f,n,o){(function(){var f=this,d=f._,i={},t=Array.prototype,l=Object.prototype,u=Function.prototype,p=t.push,s=t.slice,y=t.concat,c=l.toString,a=l.hasOwnProperty,r=t.forEach,w=t.map,b=t.reduce,m=t.reduceRight,g=t.filter,x=t.every,P=t.some,j=t.indexOf,v=t.lastIndexOf,M=Array.isArray,X=Object.keys,h=u.bind,k=function(e){return e instanceof k?e:this instanceof k?void(this._wrapped=e):new k(e)};"undefined"!=typeof o?("undefined"!=typeof n&&n.exports&&(o=n.exports=k),o._=k):f._=k,k.VERSION="1.6.0";var q=k.each=k.forEach=function(e,f,n){if(null==e)return e;if(r&&e.forEach===r)e.forEach(f,n);else if(e.length===+e.length){for(var o=0,d=e.length;d>o;o++)if(f.call(n,e[o],o,e)===i)return}else for(var t=k.keys(e),o=0,d=t.length;d>o;o++)if(f.call(n,e[t[o]],t[o],e)===i)return;return e};k.map=k.collect=function(e,f,n){var o=[];return null==e?o:w&&e.map===w?e.map(f,n):(q(e,function(e,d,i){o.push(f.call(n,e,d,i))}),o)};var z="Reduce of empty array with no initial value";k.reduce=k.foldl=k.inject=function(e,f,n,o){var d=arguments.length>2;if(null==e&&(e=[]),b&&e.reduce===b)return o&&(f=k.bind(f,o)),d?e.reduce(f,n):e.reduce(f);if(q(e,function(e,i,t){d?n=f.call(o,n,e,i,t):(n=e,d=!0)}),!d)throw new TypeError(z);return n},k.reduceRight=k.foldr=function(e,f,n,o){var d=arguments.length>2;if(null==e&&(e=[]),m&&e.reduceRight===m)return o&&(f=k.bind(f,o)),d?e.reduceRight(f,n):e.reduceRight(f);var i=e.length;if(i!==+i){var t=k.keys(e);i=t.length}if(q(e,function(l,u,p){u=t?t[--i]:--i,d?n=f.call(o,n,e[u],u,p):(n=e[u],d=!0)}),!d)throw new TypeError(z);return n},k.find=k.detect=function(e,f,n){var o;return A(e,function(e,d,i){return f.call(n,e,d,i)?(o=e,!0):void 0}),o},k.filter=k.select=function(e,f,n){var o=[];return null==e?o:g&&e.filter===g?e.filter(f,n):(q(e,function(e,d,i){f.call(n,e,d,i)&&o.push(e)}),o)},k.reject=function(e,f,n){return k.filter(e,function(e,o,d){return!f.call(n,e,o,d)},n)},k.every=k.all=function(e,f,n){f||(f=k.identity);var o=!0;return null==e?o:x&&e.every===x?e.every(f,n):(q(e,function(e,d,t){return(o=o&&f.call(n,e,d,t))?void 0:i}),!!o)};var A=k.some=k.any=function(e,f,n){f||(f=k.identity);var o=!1;return null==e?o:P&&e.some===P?e.some(f,n):(q(e,function(e,d,t){return o||(o=f.call(n,e,d,t))?i:void 0}),!!o)};k.contains=k.include=function(e,f){return null==e?!1:j&&e.indexOf===j?-1!=e.indexOf(f):A(e,function(e){return e===f})},k.invoke=function(e,f){var n=s.call(arguments,2),o=k.isFunction(f);return k.map(e,function(e){return(o?f:e[f]).apply(e,n)})},k.pluck=function(e,f){return k.map(e,k.property(f))},k.where=function(e,f){return k.filter(e,k.matches(f))},k.findWhere=function(e,f){return k.find(e,k.matches(f))},k.max=function(e,f,n){if(!f&&k.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var o=-1/0,d=-1/0;return q(e,function(e,i,t){var l=f?f.call(n,e,i,t):e;l>d&&(o=e,d=l)}),o},k.min=function(e,f,n){if(!f&&k.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var o=1/0,d=1/0;return q(e,function(e,i,t){var l=f?f.call(n,e,i,t):e;d>l&&(o=e,d=l)}),o},k.shuffle=function(e){var f,n=0,o=[];return q(e,function(e){f=k.random(n++),o[n-1]=o[f],o[f]=e}),o},k.sample=function(e,f,n){return null==f||n?(e.length!==+e.length&&(e=k.values(e)),e[k.random(e.length-1)]):k.shuffle(e).slice(0,Math.max(0,f))};var B=function(e){return null==e?k.identity:k.isFunction(e)?e:k.property(e)};k.sortBy=function(e,f,n){return f=B(f),k.pluck(k.map(e,function(e,o,d){return{value:e,index:o,criteria:f.call(n,e,o,d)}}).sort(function(e,f){var n=e.criteria,o=f.criteria;if(n!==o){if(n>o||void 0===n)return 1;if(o>n||void 0===o)return-1}return e.index-f.index}),"value")};var C=function(e){return function(f,n,o){var d={};return n=B(n),q(f,function(i,t){var l=n.call(o,i,t,f);e(d,l,i)}),d}};k.groupBy=C(function(e,f,n){k.has(e,f)?e[f].push(n):e[f]=[n]}),k.indexBy=C(function(e,f,n){e[f]=n}),k.countBy=C(function(e,f){k.has(e,f)?e[f]++:e[f]=1}),k.sortedIndex=function(e,f,n,o){n=B(n);for(var d=n.call(o,f),i=0,t=e.length;t>i;){var l=i+t>>>1;n.call(o,e[l])<d?i=l+1:t=l}return i},k.toArray=function(e){return e?k.isArray(e)?s.call(e):e.length===+e.length?k.map(e,k.identity):k.values(e):[]},k.size=function(e){return null==e?0:e.length===+e.length?e.length:k.keys(e).length},k.first=k.head=k.take=function(e,f,n){return null==e?void 0:null==f||n?e[0]:0>f?[]:s.call(e,0,f)},k.initial=function(e,f,n){return s.call(e,0,e.length-(null==f||n?1:f))},k.last=function(e,f,n){return null==e?void 0:null==f||n?e[e.length-1]:s.call(e,Math.max(e.length-f,0))},k.rest=k.tail=k.drop=function(e,f,n){return s.call(e,null==f||n?1:f)},k.compact=function(e){return k.filter(e,k.identity)};var D=function(e,f,n){return f&&k.every(e,k.isArray)?y.apply(n,e):(q(e,function(e){k.isArray(e)||k.isArguments(e)?f?p.apply(n,e):D(e,f,n):n.push(e)}),n)};k.flatten=function(e,f){return D(e,f,[])},k.without=function(e){return k.difference(e,s.call(arguments,1))},k.partition=function(e,f){var n=[],o=[];return q(e,function(e){(f(e)?n:o).push(e)}),[n,o]},k.uniq=k.unique=function(e,f,n,o){k.isFunction(f)&&(o=n,n=f,f=!1);var d=n?k.map(e,n,o):e,i=[],t=[];return q(d,function(n,o){(f?o&&t[t.length-1]===n:k.contains(t,n))||(t.push(n),i.push(e[o]))}),i},k.union=function(){return k.uniq(k.flatten(arguments,!0))},k.intersection=function(e){var f=s.call(arguments,1);return k.filter(k.uniq(e),function(e){return k.every(f,function(f){return k.contains(f,e)})})},k.difference=function(e){var f=y.apply(t,s.call(arguments,1));return k.filter(e,function(e){return!k.contains(f,e)})},k.zip=function(){for(var e=k.max(k.pluck(arguments,"length").concat(0)),f=new Array(e),n=0;e>n;n++)f[n]=k.pluck(arguments,""+n);return f},k.object=function(e,f){if(null==e)return{};for(var n={},o=0,d=e.length;d>o;o++)f?n[e[o]]=f[o]:n[e[o][0]]=e[o][1];return n},k.indexOf=function(e,f,n){if(null==e)return-1;var o=0,d=e.length;if(n){if("number"!=typeof n)return o=k.sortedIndex(e,f),e[o]===f?o:-1;o=0>n?Math.max(0,d+n):n}if(j&&e.indexOf===j)return e.indexOf(f,n);for(;d>o;o++)if(e[o]===f)return o;return-1},k.lastIndexOf=function(e,f,n){if(null==e)return-1;var o=null!=n;if(v&&e.lastIndexOf===v)return o?e.lastIndexOf(f,n):e.lastIndexOf(f);for(var d=o?n:e.length;d--;)if(e[d]===f)return d;return-1},k.range=function(e,f,n){arguments.length<=1&&(f=e||0,e=0),n=arguments[2]||1;for(var o=Math.max(Math.ceil((f-e)/n),0),d=0,i=new Array(o);o>d;)i[d++]=e,e+=n;return i};var E=function(){};k.bind=function(e,f){var n,o;if(h&&e.bind===h)return h.apply(e,s.call(arguments,1));if(!k.isFunction(e))throw new TypeError;return n=s.call(arguments,2),o=function(){if(!(this instanceof o))return e.apply(f,n.concat(s.call(arguments)));E.prototype=e.prototype;var d=new E;E.prototype=null;var i=e.apply(d,n.concat(s.call(arguments)));return Object(i)===i?i:d}},k.partial=function(e){var f=s.call(arguments,1);return function(){for(var n=0,o=f.slice(),d=0,i=o.length;i>d;d++)o[d]===k&&(o[d]=arguments[n++]);for(;n<arguments.length;)o.push(arguments[n++]);return e.apply(this,o)}},k.bindAll=function(e){var f=s.call(arguments,1);if(0===f.length)throw new Error("bindAll must be passed function names");return q(f,function(f){e[f]=k.bind(e[f],e)}),e},k.memoize=function(e,f){var n={};return f||(f=k.identity),function(){var o=f.apply(this,arguments);return k.has(n,o)?n[o]:n[o]=e.apply(this,arguments)}},k.delay=function(e,f){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},f)},k.defer=function(e){return k.delay.apply(k,[e,1].concat(s.call(arguments,1)))},k.throttle=function(e,f,n){var o,d,i,t=null,l=0;n||(n={});var u=function(){l=n.leading===!1?0:k.now(),t=null,i=e.apply(o,d),o=d=null};return function(){var p=k.now();l||n.leading!==!1||(l=p);var s=f-(p-l);return o=this,d=arguments,0>=s?(clearTimeout(t),t=null,l=p,i=e.apply(o,d),o=d=null):t||n.trailing===!1||(t=setTimeout(u,s)),i}},k.debounce=function(e,f,n){var o,d,i,t,l,u=function(){var p=k.now()-t;f>p?o=setTimeout(u,f-p):(o=null,n||(l=e.apply(i,d),i=d=null))};return function(){i=this,d=arguments,t=k.now();var p=n&&!o;return o||(o=setTimeout(u,f)),p&&(l=e.apply(i,d),i=d=null),l}},k.once=function(e){var f,n=!1;return function(){return n?f:(n=!0,f=e.apply(this,arguments),e=null,f)}},k.wrap=function(e,f){return k.partial(f,e)},k.compose=function(){var e=arguments;return function(){for(var f=arguments,n=e.length-1;n>=0;n--)f=[e[n].apply(this,f)];return f[0]}},k.after=function(e,f){return function(){return--e<1?f.apply(this,arguments):void 0}},k.keys=function(e){if(!k.isObject(e))return[];if(X)return X(e);var f=[];for(var n in e)k.has(e,n)&&f.push(n);return f},k.values=function(e){for(var f=k.keys(e),n=f.length,o=new Array(n),d=0;n>d;d++)o[d]=e[f[d]];return o},k.pairs=function(e){for(var f=k.keys(e),n=f.length,o=new Array(n),d=0;n>d;d++)o[d]=[f[d],e[f[d]]];return o},k.invert=function(e){for(var f={},n=k.keys(e),o=0,d=n.length;d>o;o++)f[e[n[o]]]=n[o];return f},k.functions=k.methods=function(e){var f=[];for(var n in e)k.isFunction(e[n])&&f.push(n);return f.sort()},k.extend=function(e){return q(s.call(arguments,1),function(f){if(f)for(var n in f)e[n]=f[n]}),e},k.pick=function(e){var f={},n=y.apply(t,s.call(arguments,1));return q(n,function(n){n in e&&(f[n]=e[n])}),f},k.omit=function(e){var f={},n=y.apply(t,s.call(arguments,1));for(var o in e)k.contains(n,o)||(f[o]=e[o]);return f},k.defaults=function(e){return q(s.call(arguments,1),function(f){if(f)for(var n in f)void 0===e[n]&&(e[n]=f[n])}),e},k.clone=function(e){return k.isObject(e)?k.isArray(e)?e.slice():k.extend({},e):e},k.tap=function(e,f){return f(e),e};var F=function(e,f,n,o){if(e===f)return 0!==e||1/e==1/f;if(null==e||null==f)return e===f;e instanceof k&&(e=e._wrapped),f instanceof k&&(f=f._wrapped);var d=c.call(e);if(d!=c.call(f))return!1;switch(d){case"[object String]":return e==String(f);case"[object Number]":return e!=+e?f!=+f:0==e?1/e==1/f:e==+f;case"[object Date]":case"[object Boolean]":return+e==+f;case"[object RegExp]":return e.source==f.source&&e.global==f.global&&e.multiline==f.multiline&&e.ignoreCase==f.ignoreCase}if("object"!=typeof e||"object"!=typeof f)return!1;for(var i=n.length;i--;)if(n[i]==e)return o[i]==f;var t=e.constructor,l=f.constructor;if(t!==l&&!(k.isFunction(t)&&t instanceof t&&k.isFunction(l)&&l instanceof l)&&"constructor"in e&&"constructor"in f)return!1;n.push(e),o.push(f);var u=0,p=!0;if("[object Array]"==d){if(u=e.length,p=u==f.length)for(;u--&&(p=F(e[u],f[u],n,o)););}else{for(var s in e)if(k.has(e,s)&&(u++,!(p=k.has(f,s)&&F(e[s],f[s],n,o))))break;if(p){for(s in f)if(k.has(f,s)&&!u--)break;p=!u}}return n.pop(),o.pop(),p};k.isEqual=function(e,f){return F(e,f,[],[])},k.isEmpty=function(e){if(null==e)return!0;if(k.isArray(e)||k.isString(e))return 0===e.length;for(var f in e)if(k.has(e,f))return!1;return!0},k.isElement=function(e){return!(!e||1!==e.nodeType)},k.isArray=M||function(e){return"[object Array]"==c.call(e)},k.isObject=function(e){return e===Object(e)},q(["Arguments","Function","String","Number","Date","RegExp"],function(e){k["is"+e]=function(f){return c.call(f)=="[object "+e+"]"}}),k.isArguments(arguments)||(k.isArguments=function(e){return!(!e||!k.has(e,"callee"))}),"function"!=typeof/./&&(k.isFunction=function(e){return"function"==typeof e}),k.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},k.isNaN=function(e){return k.isNumber(e)&&e!=+e},k.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},k.isNull=function(e){return null===e},k.isUndefined=function(e){return void 0===e},k.has=function(e,f){return a.call(e,f)},k.noConflict=function(){return f._=d,this},k.identity=function(e){return e},k.constant=function(e){return function(){return e}},k.property=function(e){return function(f){return f[e]}},k.matches=function(e){return function(f){if(f===e)return!0;for(var n in e)if(e[n]!==f[n])return!1;return!0}},k.times=function(e,f,n){for(var o=Array(Math.max(0,e)),d=0;e>d;d++)o[d]=f.call(n,d);return o},k.random=function(e,f){return null==f&&(f=e,e=0),e+Math.floor(Math.random()*(f-e+1))},k.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=k.invert(G.escape);var H={escape:new RegExp("["+k.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+k.keys(G.unescape).join("|")+")","g")};k.each(["escape","unescape"],function(e){k[e]=function(f){return null==f?"":(""+f).replace(H[e],function(f){return G[e][f]})}}),k.result=function(e,f){if(null==e)return void 0;var n=e[f];return k.isFunction(n)?n.call(e):n},k.mixin=function(e){q(k.functions(e),function(f){var n=k[f]=e[f];k.prototype[f]=function(){var e=[this._wrapped];return p.apply(e,arguments),N.call(this,n.apply(k,e))}})};var I=0;k.uniqueId=function(e){var f=++I+"";return e?e+f:f},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;k.template=function(e,f,n){var o;n=k.defaults({},n,k.templateSettings);var d=new RegExp([(n.escape||J).source,(n.interpolate||J).source,(n.evaluate||J).source].join("|")+"|$","g"),i=0,t="__p+='";e.replace(d,function(f,n,o,d,l){return t+=e.slice(i,l).replace(L,function(e){return"\\"+K[e]}),n&&(t+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),o&&(t+="'+\n((__t=("+o+"))==null?'':__t)+\n'"),d&&(t+="';\n"+d+"\n__p+='"),i=l+f.length,f}),t+="';\n",n.variable||(t="with(obj||{}){\n"+t+"}\n"),t="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+t+"return __p;\n";try{o=new Function(n.variable||"obj","_",t)}catch(l){throw l.source=t,l}if(f)return o(f,k);var u=function(e){return o.call(this,e,k)};return u.source="function("+(n.variable||"obj")+"){\n"+t+"}",u},k.chain=function(e){return k(e).chain()};var N=function(e){return this._chain?k(e).chain():e};k.mixin(k),q(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var f=t[e];k.prototype[e]=function(){var n=this._wrapped;return f.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],N.call(this,n)}}),q(["concat","join","slice"],function(e){var f=t[e];k.prototype[e]=function(){return N.call(this,f.apply(this._wrapped,arguments))}}),k.extend(k.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof e&&e.amd&&e("underscore",[],function(){return k})}).call(this)},{}],235:[function(e,f){function n(){this.callbacks={}}f.exports=n,n.prototype.on=function(e){var f=3===arguments.length,n=f?arguments[1]:void 0,o=f?arguments[2]:arguments[1];return o._groupName=n,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},n.prototype.once=function(e){function f(){n.off(e,f),i.apply(this,arguments)}var n=this,o=3===arguments.length,d=o?arguments[1]:void 0,i=o?arguments[2]:arguments[1];return this.on(e,d,f),this},n.prototype.releaseGroup=function(e){var f,n,o,d;for(f in this.callbacks)for(d=this.callbacks[f],n=0,o=d.length;o>n;n++)d[n]._groupName===e&&(d.splice(n,1),n--,o--);return this},n.prototype.off=function(e,f){var n,o=this.callbacks[e];return o?1===arguments.length?(delete this.callbacks[e],this):(n=o.indexOf(f),o.splice(n,1),this):this
},n.prototype.emit=function(e){var f,n,o,d=[].slice.call(arguments,1),i=this.callbacks[e],t=this.getWildcardCallbacks(e);if(i)for(o=i.slice(),f=0,n=o.length;n>f&&o[f];++f)o[f].apply(this,d);if(t)for(n=t.length,o=t.slice(),f=0,n=o.length;n>f&&o[f];++f)o[f].apply(this,[e].concat(d));return this},n.prototype.getWildcardCallbacks=function(e){var f,n,o=[];for(f in this.callbacks)n=f.split("*"),("*"===f||2===n.length&&e.slice(0,n[0].length)===n[0])&&(o=o.concat(this.callbacks[f]));return o}},{}],236:[function(e,f,n){"use strict";function o(e,f){return e?e+"@"+f:f}function d(e,f,n){return n?o(e,f)+"/"+n:o(e,f)}var i=e("./lib/stringprep");n.prep=function(e){var f=e.local,t=e.domain,l=e.resource,u=f;return f&&(f=i.nodeprep(f),u=n.unescape(f)),l&&(l=i.resourceprep(l)),"."===t[t.length-1]&&(t=t.slice(0,t.length-1)),t=i.nameprep(t.split(".").map(i.toUnicode).join(".")),{prepped:e.prepped||i.available,local:f,domain:t,resource:l,bare:o(f,t),full:d(f,t,l),unescapedLocal:u,unescapedBare:o(u,t),unescapedFull:d(u,t,l)}},n.parse=function(e,f){var o="",d="",i="";f=/^[\x00-\x7F]*$/.test(e);var t=e.indexOf("/");t>0&&(i=e.slice(t+1),e=e.slice(0,t));var l=e.indexOf("@");l>0&&(o=e.slice(0,l),e=e.slice(l+1)),d=e;var u=n.prep({local:o,domain:d,resource:i});return u.prepped=u.prepped||f,u},n.equal=function(e,f,o){return e=new n.JID(e),f=new n.JID(f),2===arguments.length&&(o=!0),e.local===f.local&&e.domain===f.domain&&e.resource===f.resource&&(o?e.prepped&&f.prepped:!0)},n.equalBare=function(e,f,o){return e=new n.JID(e),f=new n.JID(f),2===arguments.length&&(o=!0),e.local===f.local&&e.domain===f.domain&&(o?e.prepped&&f.prepped:!0)},n.escape=function(e){return e.replace(/^\s+|\s+$/g,"").replace(/\\5c/g,"\\5c5c").replace(/\\20/g,"\\5c20").replace(/\\22/g,"\\5c22").replace(/\\26/g,"\\5c26").replace(/\\27/g,"\\5c27").replace(/\\2f/g,"\\5c2f").replace(/\\3a/g,"\\5c3a").replace(/\\3c/g,"\\5c3c").replace(/\\3e/g,"\\5c3e").replace(/\\40/g,"\\5c40").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},n.unescape=function(e){return e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},n.create=function(e,f,o){return new n.JID(e,f,o)},n.JID=function(e,f,o){var d={};if(!e||f||o)d=f?n.prep({local:n.escape(e),domain:f,resource:o}):{};else if("string"==typeof e)d=n.parse(e);else{if(!(e instanceof n.JID))throw new Error("Invalid argument type");d=e}this.local=d.local||"",this.domain=d.domain||"",this.resource=d.resource||"",this.bare=d.bare||"",this.full=d.full||"",this.unescapedLocal=d.unescapedLocal||"",this.unescapedBare=d.unescapedBare||"",this.unescapedFull=d.unescapedFull||"",this.prepped=d.prepped},n.JID.prototype.toString=function(){return this.full},n.JID.prototype.toJSON=function(){return this.full}},{"./lib/stringprep":237}],237:[function(e,f,n){"use strict";var o=e("punycode");n.available=!1,n.toUnicode=o.toUnicode,n.nameprep=function(e){return e.toLowerCase()},n.nodeprep=function(e){return e.toLowerCase()},n.resourceprep=function(e){return e}},{punycode:167}]},{},[1])(1)});